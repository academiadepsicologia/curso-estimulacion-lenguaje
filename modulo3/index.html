<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥dulo 3: Actividades y Juegos - Estimulaci√≥n del Lenguaje</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.8;
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 2rem 2rem;
        }

        .progress-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e9ecef;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .module-header {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .module-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Nuevo estilo para el contexto educativo */
        .educational-context {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border-left: 5px solid #28a745;
        }

        .educational-context h3 {
            color: #155724;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .educational-context p {
            color: #155724;
            font-size: 1.1rem;
            margin-bottom: 0.8rem;
        }

        .educational-context ul {
            color: #155724;
            margin-left: 1.5rem;
        }

        .educational-context li {
            margin-bottom: 0.5rem;
        }

        .age-selector {
            background: linear-gradient(135deg, #f093fb20 0%, #f5576c20 100%);
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 2px solid #f093fb;
        }

        .age-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .age-btn {
            background: white;
            color: #764ba2;
            padding: 1rem 2rem;
            border: 2px solid #764ba2;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .age-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .age-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .content-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Nuevo estilo para instrucciones de actividades */
        .activity-instructions {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid #667eea;
        }

        .activity-instructions h4 {
            color: #667eea;
            margin-bottom: 1rem;
        }

        .activity-instructions .steps {
            counter-reset: step-counter;
        }

        .activity-instructions .step {
            counter-increment: step-counter;
            margin-bottom: 1rem;
            padding: 0.8rem;
            background: white;
            border-radius: 8px;
            position: relative;
            padding-left: 3rem;
        }

        .activity-instructions .step::before {
            content: counter(step-counter);
            position: absolute;
            left: 0.8rem;
            top: 0.8rem;
            background: #667eea;
            color: white;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .activity-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(118, 75, 162, 0.4);
        }

        .activity-card.completed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .activity-card.completed::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
            opacity: 0.5;
        }

        .activity-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .activity-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .activity-description {
            font-size: 0.95rem;
            opacity: 0.95;
            margin-bottom: 1rem;
        }

        /* Nuevo: Etiqueta de "PARA HACER EN CASA" */
        .home-activity-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .game-container {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 3px solid #667eea;
        }

        .demo-label {
            background: #ffc107;
            color: #212529;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-weight: bold;
            margin-bottom: 1rem;
            display: inline-block;
        }

        .game-area {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            margin: 1rem 0;
            min-height: 300px;
            position: relative;
        }

        .interactive-element {
            display: inline-block;
            padding: 1rem;
            margin: 0.5rem;
            background: linear-gradient(135deg, #ffd93d 0%, #ffb300 100%);
            color: #333;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .interactive-element:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 183, 0, 0.4);
        }

        .btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 1rem 0.5rem 1rem 0;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        /* Nuevo: Estilos para l√≠mites de selecci√≥n */
        .selection-counter {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 1rem 0;
            text-align: center;
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .food-item {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .food-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .food-item.selected {
            border-color: #28a745;
            background: #d4edda;
        }

        .food-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .food-emoji {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .quantity-selector {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .quiz-container {
            background: #f0f8ff;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 2px solid #4a90e2;
        }

        .quiz-question {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .quiz-options {
            display: grid;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .quiz-option {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: #e9ecef;
            border-color: #4a90e2;
        }

        .quiz-option.selected {
            background: #d1ecf1;
            border-color: #0c5460;
        }

        .quiz-option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .quiz-option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .feedback-box {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }

        .feedback-box.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .feedback-correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback-incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .achievement-badge {
            display: inline-block;
            background: #ffd700;
            color: #333;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin: 0.5rem;
            font-weight: 600;
            opacity: 0.3;
            transition: all 0.3s ease;
        }

        .achievement-badge.unlocked {
            opacity: 1;
            animation: bounce 0.5s ease;
        }

        .timer {
            background: #fff;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin: 1rem 0;
        }

        .score-display {
            background: linear-gradient(135deg, #ffd93d 0%, #ffb300 100%);
            color: #333;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        .drag-item {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            margin: 0.5rem;
            background: #fff;
            border: 2px solid #667eea;
            border-radius: 25px;
            cursor: move;
            transition: all 0.3s ease;
        }

        .drag-item.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            min-height: 100px;
            padding: 1rem;
            border: 3px dashed #667eea;
            border-radius: 10px;
            margin: 1rem 0;
            background: #f8f9fa;
            text-align: center;
        }

        .drop-zone.drag-over {
            background: #e8f4f8;
            border-color: #28a745;
        }

        .module-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .hidden {
            display: none;
        }

        .age-specific-content {
            display: none;
        }

        .age-specific-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .module-header h1 {
                font-size: 2rem;
            }
            
            .age-buttons {
                flex-direction: column;
            }
            
            .activity-grid {
                grid-template-columns: 1fr;
            }
            
            .module-navigation {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <span>üéÆ</span>
                <span>M√≥dulo 3: Actividades y Juegos</span>
            </div>
            <div class="nav-links">
                <a href="../index.html">‚Üê Dashboard</a>
                <a href="../modulo2/index.html">M√≥dulo 2</a>
                <a href="#" onclick="showProgress()">Mi Progreso</a>
                <a href="#" onclick="showHelp()">Ayuda</a>
                <a href="#" onclick="logout()">Salir</a>
            </div>
        </div>
    </header>

    <div class="main-content">
        <div class="progress-section">
            <h3>Tu Progreso en el M√≥dulo 3</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p><span id="progressText">0% completado</span> ‚Ä¢ <span id="activitiesCompleted">0 de 12 actividades</span></p>
            <div id="achievementsList" style="margin-top: 1rem;">
                <span class="achievement-badge" id="badge1">üéØ Primera Actividad</span>
                <span class="achievement-badge" id="badge2">üéÆ 5 Juegos</span>
                <span class="achievement-badge" id="badge3">üéµ Maestro Musical</span>
                <span class="achievement-badge" id="badge4">üìö Contador de Cuentos</span>
                <span class="achievement-badge" id="badge5">üèÜ M√≥dulo Completo</span>
            </div>
        </div>

        <div class="module-header">
            <h1>üéÆ Actividades y Juegos para Estimular el Lenguaje</h1>
            <p>Aprende t√©cnicas profesionales para desarrollar el lenguaje de tu hijo en casa</p>
        </div>

        <!-- NUEVO: Contexto Educativo Principal -->
        <div class="educational-context">
            <h3>
                <span>üè†</span>
                ¬øC√≥mo usar este m√≥dulo?
            </h3>
            <p><strong>Este m√≥dulo te ense√±a actividades para recrear en casa con tu hijo.</strong></p>
            <p>Los juegos interactivos que ver√°s aqu√≠ son <strong>ejemplos demostrativos</strong> para que:</p>
            <ul>
                <li><strong>Aprendas la metodolog√≠a:</strong> C√≥mo estructurar cada actividad paso a paso</li>
                <li><strong>Veas el objetivo:</strong> Qu√© habilidades espec√≠ficas desarrolla cada juego</li>
                <li><strong>Entiendas la adaptaci√≥n:</strong> C√≥mo ajustar la dificultad seg√∫n la edad</li>
                <li><strong>Practiques la t√©cnica:</strong> Qu√© decir y c√≥mo interactuar con tu hijo</li>
            </ul>
            <p><strong>üí° Tu objetivo:</strong> Convertirte en el mejor estimulador del lenguaje de tu hijo, usando estas t√©cnicas cient√≠ficamente respaldadas en la vida diaria.</p>
        </div>

        <div class="module-header" style="padding: 2rem; margin-bottom: 1rem;">
            <div class="age-selector">
                <h3>üìå Selecciona la edad de tu hijo para ver actividades personalizadas:</h3>
                <div class="age-buttons">
                    <button class="age-btn" onclick="selectAge(3)">3 a√±os</button>
                    <button class="age-btn" onclick="selectAge(4)">4 a√±os</button>
                    <button class="age-btn" onclick="selectAge(5)">5 a√±os</button>
                </div>
                <p id="ageMessage" style="margin-top: 1rem; display: none; text-align: center; font-weight: bold; color: #667eea;">
                    ‚ú® Actividades adaptadas para <span id="selectedAge"></span> a√±os
                </p>
            </div>
        </div>

        <!-- Contenido para 3 a√±os -->
        <div id="content-age-3" class="age-specific-content">
            
            <!-- Secci√≥n 1: Juegos de Vocabulario -->
            <div class="content-section" data-section="vocab-3">
                <h2 class="section-title">
                    <span>üéØ</span>
                    Juegos de Vocabulario (3 a√±os)
                </h2>
                
                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> A los 3 a√±os, los ni√±os aprenden mejor a trav√©s de la repetici√≥n y asociaci√≥n visual. Pueden aprender 5-10 palabras nuevas por d√≠a a trav√©s del juego estructurado.
                </div>

                <div class="educational-context">
                    <h3>
                        <span>üë®‚Äçüè´</span>
                        Lo que aprender√°s en esta secci√≥n:
                    </h3>
                    <ul>
                        <li><strong>T√©cnica del "Veo-Veo":</strong> C√≥mo usar colores y objetos para expandir vocabulario</li>
                        <li><strong>M√©todo onomatop√©yico:</strong> Usar sonidos de animales para mejorar pronunciaci√≥n</li>
                        <li><strong>Aprendizaje corporal:</strong> Incorporar movimiento para fijar vocabulario</li>
                        <li><strong>Rutinas diarias:</strong> Convertir momentos cotidianos en oportunidades de aprendizaje</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <!-- Actividad 1 -->
                    <div class="activity-card" onclick="startVocabGame3()" data-activity="vocab-game-3">
                        <div class="activity-icon">üñºÔ∏è</div>
                        <div class="activity-title">Veo-Veo de Colores</div>
                        <div class="activity-description">Aprende la t√©cnica para ense√±ar vocabulario usando colores y objetos cotidianos</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>C√≥mo hacer esta actividad en casa:</h4>
                            <div class="steps">
                                <div class="step">Re√∫ne 6-8 objetos de diferentes colores que tu hijo conozca</div>
                                <div class="step">Di: "Veo, veo... algo de color [nombre del color]"</div>
                                <div class="step">Espera que tu hijo se√±ale o nombre el objeto correcto</div>
                                <div class="step">Celebra cada acierto y repite el nombre del objeto</div>
                                <div class="step">Aumenta la dificultad agregando caracter√≠sticas: "algo rojo y redondo"</div>
                            </div>
                        </div>
                    </div>

                    <!-- Actividad 2 -->
                    <div class="activity-card" onclick="startAnimalSounds3()" data-activity="animal-sounds-3">
                        <div class="activity-icon">üê∂</div>
                        <div class="activity-title">Sonidos de Animales</div>
                        <div class="activity-description">Domina la t√©cnica de onomatopeyas para mejorar pronunciaci√≥n y vocabulario</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>C√≥mo producir sonidos en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Prepara im√°genes o juguetes</strong> de animales comunes (perro, gato, vaca, pato)</div>
                                <div class="step"><strong>Modela el sonido claramente:</strong> "El perro hace GUAU-GUAU" (exagera la pronunciaci√≥n)</div>
                                <div class="step"><strong>Pide imitaci√≥n:</strong> "¬øC√≥mo hace el perro?" y espera la respuesta</div>
                                <div class="step"><strong>Asocia sonido con nombre:</strong> "¬°Correcto! GUAU-GUAU dice el PERRO"</div>
                                <div class="step"><strong>Juega adivinanzas:</strong> Haz el sonido y que adivine el animal</div>
                            </div>
                            <p><strong>üîä Sonidos a practicar:</strong> GUAU-GUAU (perro), MIAU (gato), MUU (vaca), CUAC-CUAC (pato), P√çO-P√çO (pollito)</p>
                        </div>
                    </div>

                    <!-- Actividad 3 -->
                    <div class="activity-card" onclick="startBodyParts3()" data-activity="body-parts-3">
                        <div class="activity-title">Mi Cuerpo</div>
                        <div class="activity-description">Aprende a usar el juego "Sim√≥n dice" para ense√±ar partes del cuerpo</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>Metodolog√≠a "Sim√≥n dice" en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Posici√≥nate frente a tu hijo</strong> para que pueda imitarte</div>
                                <div class="step"><strong>Usa el comando:</strong> "Sim√≥n dice: toca tu [parte del cuerpo]"</div>
                                <div class="step"><strong>Demuestra primero:</strong> Toca tu propia nariz mientras dices "nariz"</div>
                                <div class="step"><strong>Gu√≠a f√≠sicamente si es necesario:</strong> Ayuda a tocar la parte correcta</div>
                                <div class="step"><strong>Repite el nombre:</strong> "¬°Muy bien! Esa es tu NARIZ"</div>
                                <div class="step"><strong>Var√≠a la velocidad:</strong> Lento al principio, m√°s r√°pido cuando domine</div>
                            </div>
                            <p><strong>üìù Partes a ense√±ar:</strong> cabeza, ojos, nariz, boca, orejas, manos, pies, barriga</p>
                        </div>
                    </div>
                </div>

                <!-- Juego Interactivo: Veo-Veo -->
                <div id="veoVeoGame3" class="game-container hidden">
                    <div class="demo-label">üéØ DEMOSTRACI√ìN: Aprende la t√©cnica</div>
                    <h3>üéÆ Ejemplo: Veo-Veo de Colores</h3>
                    <div class="score-display">Objetos identificados: <span id="veoVeoScore">0</span></div>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa har√°s esto con:</h3>
                        <p>Objetos reales de tu hogar: manzana roja, pelota azul, pl√°tano amarillo, hoja verde, etc.</p>
                    </div>
                    
                    <div class="game-area">
                        <p id="veoVeoInstruction" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 1rem;">
                            Veo, veo... algo de color <span id="targetColor" style="color: red;">ROJO</span>
                        </p>
                        <div id="veoVeoObjects" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;">
                            <!-- Se llenar√°n din√°micamente -->
                        </div>
                    </div>
                    
                    <div class="feedback-box" id="veoVeoFeedback"></div>
                    <button class="btn btn-warning" onclick="nextVeoVeoRound()">Siguiente Ronda</button>
                    <button class="btn" onclick="closeVeoVeoGame()">Entend√≠ la T√©cnica</button>
                </div>

                <!-- Juego de Sonidos de Animales -->
                <div id="animalSoundsGame3" class="game-container hidden">
                    <div class="demo-label">üîä DEMOSTRACI√ìN: T√©cnica de sonidos</div>
                    <h3>üêæ Ejemplo: ¬øQu√© Animal Soy?</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa necesitar√°s:</h3>
                        <ul>
                            <li>Im√°genes de animales o libros ilustrados</li>
                            <li>Juguetes de animales (opcional)</li>
                            <li>Tu voz para hacer los sonidos claramente</li>
                        </ul>
                        <p><strong>Tip profesional:</strong> Exagera los sonidos y usa expresiones faciales para hacerlo m√°s divertido.</p>
                    </div>
                    
                    <div class="game-area">
                        <div style="text-align: center;">
                            <div id="animalImage" style="font-size: 5rem; margin: 1rem;">üêÆ</div>
                            <p style="font-size: 1.2rem; margin: 1rem;">Escucha el sonido y adivina el animal</p>
                            <button class="btn btn-info" onclick="playAnimalSound()">üîä Hacer Sonido (simula tu voz)</button>
                        </div>
                        <div id="animalOptions" style="display: flex; justify-content: center; gap: 1rem; margin: 2rem 0;">
                            <!-- Se llenar√°n din√°micamente -->
                        </div>
                    </div>
                    <div class="feedback-box" id="animalFeedback"></div>
                    <button class="btn" onclick="closeAnimalSoundsGame()">Entend√≠ la T√©cnica</button>
                </div>
            </div>

            <!-- Secci√≥n 2: Cuentos Interactivos -->
            <div class="content-section" data-section="stories-3">
                <h2 class="section-title">
                    <span>üìö</span>
                    Cuentos Interactivos (3 a√±os)
                </h2>

                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> Los cuentos con repetici√≥n y sonidos onomatop√©yicos mejoran la memoria auditiva y la comprensi√≥n narrativa. La participaci√≥n activa aumenta la retenci√≥n en un 70%.
                </div>

                <div class="educational-context">
                    <h3>
                        <span>üìñ</span>
                        T√©cnicas de narraci√≥n interactiva que aprender√°s:
                    </h3>
                    <ul>
                        <li><strong>Pausas estrat√©gicas:</strong> D√≥nde parar para que tu hijo complete la frase</li>
                        <li><strong>Incorporaci√≥n de movimientos:</strong> C√≥mo usar el cuerpo para contar</li>
                        <li><strong>Repetici√≥n estructurada:</strong> Frases que se repiten para fijar vocabulario</li>
                        <li><strong>Preguntas gu√≠a:</strong> Qu√© preguntar durante el cuento para mantener atenci√≥n</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startStory3_1()" data-activity="story-3-1">
                        <div class="activity-icon">üê∞</div>
                        <div class="activity-title">El Conejito Saltar√≠n</div>
                        <div class="activity-description">Aprende a contar cuentos con movimientos y sonidos que tu hijo puede imitar</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>C√≥mo narrar este cuento en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Prepara el ambiente:</strong> Si√©ntense en un lugar c√≥modo, frente a frente</div>
                                <div class="step"><strong>Usa tu voz:</strong> Cambia el tono para diferentes personajes</div>
                                <div class="step"><strong>Incorpora movimientos:</strong> Salta cuando el conejo salta, haz sonidos de comer</div>
                                <div class="step"><strong>Pausa para participaci√≥n:</strong> "¬øC√≥mo hace el conejo?" "¬°HOP!"</div>
                                <div class="step"><strong>Repite frases clave:</strong> "Saltaba por aqu√≠... HOP! Saltaba por all√°... HOP!"</div>
                            </div>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startStory3_2()" data-activity="story-3-2">
                        <div class="activity-icon">üåô</div>
                        <div class="activity-title">La Luna y las Estrellas</div>
                        <div class="activity-description">T√©cnica de "completar frases" para desarrollar predicci√≥n y vocabulario</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnica de completar frases:</h4>
                            <div class="steps">
                                <div class="step"><strong>Lee despacio:</strong> "La luna brillaba en el..." (pausa)</div>
                                <div class="step"><strong>Espera la respuesta:</strong> Deja que complete con "cielo"</div>
                                <div class="step"><strong>Refuerza:</strong> "¬°S√≠! En el CIELO. Muy bien"</div>
                                <div class="step"><strong>Si no responde:</strong> Da la primera letra "ci..." y espera</div>
                                <div class="step"><strong>Celebra intentos:</strong> Aunque no sea perfecta la respuesta</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cuento Interactivo -->
                <div id="interactiveStory3" class="game-container hidden">
                    <div class="demo-label">üìö DEMOSTRACI√ìN: T√©cnica de cuento interactivo</div>
                    <h3>üìñ El Conejito Saltar√≠n</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa necesitar√°s:</h3>
                        <ul>
                            <li>Tu voz expresiva (diferentes tonos)</li>
                            <li>Espacio para hacer movimientos</li>
                            <li>Paciencia para repetir las partes favoritas</li>
                        </ul>
                        <p><strong>Tip:</strong> Deja que tu hijo "ayude" al conejo a saltar contigo.</p>
                    </div>
                    
                    <div class="game-area">
                        <div id="storyContent" style="font-size: 1.1rem; line-height: 1.8;">
                            <!-- Contenido del cuento -->
                        </div>
                        <div id="storyInteraction" style="margin-top: 2rem;">
                            <!-- Elementos interactivos -->
                        </div>
                    </div>
                    <button class="btn btn-warning" onclick="nextStoryPage()">Siguiente P√°gina ‚Üí</button>
                    <button class="btn" onclick="closeStory()">Entend√≠ la T√©cnica</button>
                </div>
            </div>

            <!-- Secci√≥n 3: Canciones Educativas -->
            <div class="content-section" data-section="songs-3">
                <h2 class="section-title">
                    <span>üéµ</span>
                    Canciones Educativas (3 a√±os)
                </h2>

                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> El ritmo y la melod√≠a facilitan la memorizaci√≥n de palabras y mejoran la pronunciaci√≥n. Las canciones activan m√∫ltiples √°reas cerebrales simult√°neamente.
                </div>

                <div class="educational-context">
                    <h3>
                        <span>üéº</span>
                        T√©cnicas musicales que dominar√°s:
                    </h3>
                    <ul>
                        <li><strong>Creaci√≥n de melod√≠as simples:</strong> C√≥mo inventar tonadas pegajosas para cualquier tema</li>
                        <li><strong>Ritmo corporal:</strong> Usar palmadas y movimientos para marcar el comp√°s</li>
                        <li><strong>Repetici√≥n musical:</strong> Estructura de estrofas que facilitan memorizaci√≥n</li>
                        <li><strong>Adaptaci√≥n instant√°nea:</strong> Cambiar letras seg√∫n situaciones cotidianas</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startSong3_1()" data-activity="song-3-1">
                        <div class="activity-icon">üé∂</div>
                        <div class="activity-title">Los N√∫meros Bailarines</div>
                        <div class="activity-description">Aprende a crear canciones de n√∫meros con movimientos que tu hijo recordar√°</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>C√≥mo crear canciones de n√∫meros en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Inventa melod√≠a simple:</strong> Usa tonos que suben y bajan gradualmente</div>
                                <div class="step"><strong>Agrega movimientos:</strong> Un movimiento espec√≠fico para cada n√∫mero</div>
                                <div class="step"><strong>Canta despacio primero:</strong> Que pueda seguir el ritmo</div>
                                <div class="step"><strong>Repite muchas veces:</strong> La repetici√≥n crea memoria musical</div>
                                <div class="step"><strong>Var√≠a las actividades:</strong> "saltar", "aplaudir", "marchar" con cada n√∫mero</div>
                            </div>
                            <p><strong>üéµ Ejemplo de letra:</strong> "Uno saltito, dos saltitos, tres pataditas al suelo..."</p>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startSong3_2()" data-activity="song-3-2">
                        <div class="activity-icon">üåà</div>
                        <div class="activity-title">El Arco√≠ris Musical</div>
                        <div class="activity-description">T√©cnica para ense√±ar colores a trav√©s de canciones que puedes crear sobre cualquier tema</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>Metodolog√≠a de canciones de colores:</h4>
                            <div class="steps">
                                <div class="step"><strong>Busca objetos de cada color</strong> en tu casa mientras cantas</div>
                                <div class="step"><strong>Crea rimas simples:</strong> "Rojo como el tomate, rojo como el coraz√≥n"</div>
                                <div class="step"><strong>Usa gestos descriptivos:</strong> Se√±ala cosas del color mencionado</div>
                                <div class="step"><strong>Cambia la velocidad:</strong> Lento para aprender, r√°pido para divertir</div>
                                <div class="step"><strong>Deja espacios:</strong> "Verde como la..." (que complete "hierba")</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 4: Actividades Diarias -->
            <div class="content-section" data-section="daily-3">
                <h2 class="section-title">
                    <span>üè†</span>
                    Actividades de la Vida Diaria (3 a√±os)
                </h2>

                <div class="educational-context">
                    <h3>
                        <span>‚è∞</span>
                        Convierte rutinas diarias en oportunidades de lenguaje:
                    </h3>
                    <ul>
                        <li><strong>Hora de comer:</strong> Nombrar alimentos, texturas, sabores</li>
                        <li><strong>Vestirse:</strong> Vocabulario de ropa, acciones (ponerse, quitarse)</li>
                        <li><strong>Ba√±o:</strong> Partes del cuerpo, acciones de higiene</li>
                        <li><strong>Juego libre:</strong> Narrar lo que hace, expandir vocabulario</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startDailyActivity3()" data-activity="daily-3">
                        <div class="activity-icon">üçé</div>
                        <div class="activity-title">Hora de la Merienda</div>
                        <div class="activity-description">Aprende a maximizar el vocabulario durante las comidas con t√©cnicas espec√≠ficas</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnicas para la hora de comer:</h4>
                            <div class="steps">
                                <div class="step"><strong>Nombra antes de dar:</strong> "Aqu√≠ tienes tu MANZANA roja"</div>
                                <div class="step"><strong>Describe sabores:</strong> "¬øEst√° dulce? ¬øEst√° sabroso?"</div>
                                <div class="step"><strong>Ense√±a acciones:</strong> "Vamos a MASTICAR la manzana"</div>
                                <div class="step"><strong>Usa cantidades:</strong> "Dos pedazos de pl√°tano"</div>
                                <div class="step"><strong>Haz preguntas simples:</strong> "¬øQuieres M√ÅS agua?"</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actividad de la Merienda -->
                <div id="snackActivity3" class="game-container hidden">
                    <div class="demo-label">üçé DEMOSTRACI√ìN: T√©cnica de merienda</div>
                    <h3>üçé Planificador de Merienda</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa aplicar√°s esto:</h3>
                        <p>Durante las comidas reales con tu hijo, nombrando cada alimento y practicando el vocabulario de manera natural.</p>
                        <p><strong>Objetivo:</strong> Que asocie palabras con objetos, sabores y acciones relacionadas con la comida.</p>
                    </div>
                    
                    <div class="game-area">
                        <div class="selection-counter">
                            Selecciona m√°ximo 3 alimentos para tu merienda: <span id="selectedCount">0/3</span>
                        </div>
                        
                        <p style="font-size: 1.2rem; text-align: center; margin: 1rem 0;">¬øQu√© quieres comer hoy?</p>
                        
                        <div class="food-grid" id="foodGrid">
                            <!-- Se llenar√° din√°micamente con l√≠mite de selecci√≥n -->
                        </div>
                        
                        <div id="mealPlan" style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <p><strong>Mi merienda:</strong></p>
                            <div id="selectedFoods">Selecciona hasta 3 alimentos</div>
                        </div>
                        
                        <button class="btn btn-success" onclick="finalizeMeal()" id="finalizeMealBtn" style="display: none;">
                            ‚úÖ Terminar Merienda
                        </button>
                    </div>
                    <button class="btn" onclick="closeSnackActivity()">Entend√≠ la T√©cnica</button>
                </div>
            </div>
        </div>
        <!-- Contenido para 4 a√±os -->
        <div id="content-age-4" class="age-specific-content">
            
            <!-- Secci√≥n 1: Juegos de Construcci√≥n de Frases -->
            <div class="content-section" data-section="sentences-4">
                <h2 class="section-title">
                    <span>üèóÔ∏è</span>
                    Construcci√≥n de Frases (4 a√±os)
                </h2>
                
                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> A los 4 a√±os, los ni√±os pueden formar frases de 4-5 palabras y comprenden estructuras gramaticales b√°sicas. Es el momento ideal para trabajar sintaxis simple.
                </div>

                <div class="educational-context">
                    <h3>
                        <span>üîß</span>
                        T√©cnicas de construcci√≥n de oraciones que dominar√°s:
                    </h3>
                    <ul>
                        <li><strong>M√©todo de expansi√≥n:</strong> C√≥mo tomar una palabra y convertirla en oraci√≥n completa</li>
                        <li><strong>Estructura sujeto-verbo-objeto:</strong> Plantillas para crear oraciones correctas</li>
                        <li><strong>Preguntas gu√≠a:</strong> Qu√©, qui√©n, d√≥nde, cu√°ndo para desarrollar comprensi√≥n</li>
                        <li><strong>Secuencias temporales:</strong> Primero, despu√©s, luego para organizar ideas</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startSentenceBuilder4()" data-activity="sentence-4">
                        <div class="activity-icon">üß©</div>
                        <div class="activity-title">Constructor de Oraciones</div>
                        <div class="activity-description">Aprende la t√©cnica de "palabras m√≥viles" para ense√±ar estructura de oraciones</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnica de palabras m√≥viles en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Prepara tarjetas de palabras:</strong> Escritas en papel o cart√≥n con letra grande</div>
                                <div class="step"><strong>Empieza con 3 palabras:</strong> "Ni√±o come manzana"</div>
                                <div class="step"><strong>Deja que las mueva:</strong> F√≠sicamente reorganice las tarjetas</div>
                                <div class="step"><strong>Lee juntos el resultado:</strong> "¬øQu√© dice aqu√≠?"</div>
                                <div class="step"><strong>Corrige con modelo:</strong> Si est√° mal, muestra la forma correcta</div>
                                <div class="step"><strong>Agrega complejidad gradual:</strong> "El ni√±o come la manzana roja"</div>
                            </div>
                            <p><strong>üí° Materiales necesarios:</strong> Tarjetas, marcadores, mesa para organizar</p>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startQuestionGame4()" data-activity="questions-4">
                        <div class="activity-icon">‚ùì</div>
                        <div class="activity-title">¬øQu√©? ¬øD√≥nde? ¬øCu√°ndo?</div>
                        <div class="activity-description">Domina el arte de hacer preguntas que desarrollen comprensi√≥n y expresi√≥n</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnica de preguntas estructuradas:</h4>
                            <div class="steps">
                                <div class="step"><strong>Usa situaciones reales:</strong> "Pap√° fue al trabajo en auto"</div>
                                <div class="step"><strong>Pregunta gradualmente:</strong> "¬øQUI√âN fue al trabajo?"</div>
                                <div class="step"><strong>Espera respuesta completa:</strong> No aceptes solo "pap√°", busca "Pap√° fue"</div>
                                <div class="step"><strong>Sigue la secuencia:</strong> ¬øD√≥nde? ¬øC√≥mo? ¬øCu√°ndo?</div>
                                <div class="step"><strong>Refuerza con repetici√≥n:</strong> "S√≠, PAP√Å fue al TRABAJO en AUTO"</div>
                            </div>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startSequenceGame4()" data-activity="sequence-4">
                        <div class="activity-icon">üìÖ</div>
                        <div class="activity-title">Primero, Luego, Despu√©s</div>
                        <div class="activity-description">Ense√±a secuencias temporales para organizar el pensamiento y la expresi√≥n</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>Metodolog√≠a de secuencias temporales:</h4>
                            <div class="steps">
                                <div class="step"><strong>Usa rutinas conocidas:</strong> Lavarse los dientes, vestirse, desayunar</div>
                                <div class="step"><strong>Introduce palabras clave:</strong> "PRIMERO me levanto"</div>
                                <div class="step"><strong>Pide que continue:</strong> "¬øQu√© haces DESPU√âS?"</div>
                                <div class="step"><strong>Act√∫en la secuencia:</strong> Hagan los movimientos mientras narran</div>
                                <div class="step"><strong>Cambia el orden a prop√≥sito:</strong> "¬øPuedo desayunar antes de levantarme?"</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Juego Constructor de Oraciones -->
                <div id="sentenceBuilder4" class="game-container hidden">
                    <div class="demo-label">üß© DEMOSTRACI√ìN: T√©cnica de construcci√≥n</div>
                    <h3>üß© Constructor de Oraciones</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa necesitar√°s:</h3>
                        <ul>
                            <li>Tarjetas de palabras (puedes hacerlas con papel)</li>
                            <li>Superficie plana para organizar</li>
                            <li>Paciencia para dejar que experimente</li>
                        </ul>
                        <p><strong>Objetivo:</strong> Que entienda que las oraciones tienen un orden l√≥gico y significado.</p>
                    </div>
                    
                    <div class="game-area">
                        <p style="font-size: 1.2rem; font-weight: bold;">Arrastra las palabras para formar una oraci√≥n:</p>
                        
                        <div id="wordBank" style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <p>Banco de palabras:</p>
                            <div id="availableWords" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <!-- Palabras draggables -->
                            </div>
                        </div>

                        <div class="drop-zone" id="sentenceZone">
                            <p style="color: #999;">Arrastra las palabras aqu√≠ para formar una oraci√≥n</p>
                        </div>

                        <button class="btn btn-success" onclick="checkSentence()">Verificar Oraci√≥n</button>
                    </div>
                    <div class="feedback-box" id="sentenceFeedback"></div>
                    <button class="btn" onclick="closeSentenceBuilder()">Entend√≠ la T√©cnica</button>
                </div>
            </div>

            <!-- Secci√≥n 2: Cuentos con Comprensi√≥n -->
            <div class="content-section" data-section="comprehension-4">
                <h2 class="section-title">
                    <span>üìñ</span>
                    Cuentos con Comprensi√≥n (4 a√±os)
                </h2>

                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> Los ni√±os de 4 a√±os pueden seguir historias con 3-4 eventos y responder preguntas simples sobre causa-efecto. La comprensi√≥n narrativa es fundamental para el desarrollo cognitivo.
                </div>

                <div class="educational-context">
                    <h3>
                        <span>üéØ</span>
                        T√©cnicas de comprensi√≥n lectora que aprender√°s:
                    </h3>
                    <ul>
                        <li><strong>Preguntas durante la lectura:</strong> Cu√°ndo parar y qu√© preguntar</li>
                        <li><strong>Predicci√≥n guiada:</strong> "¬øQu√© crees que pasar√° despu√©s?"</li>
                        <li><strong>Conexi√≥n con experiencias:</strong> "¬øTe pas√≥ algo parecido?"</li>
                        <li><strong>Retelling (re-narraci√≥n):</strong> Que cuente la historia con sus palabras</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startComprehensionStory4()" data-activity="comp-story-4">
                        <div class="activity-icon">ü¶Å</div>
                        <div class="activity-title">El Le√≥n y el Rat√≥n</div>
                       <div class="activity-description">Aprende t√©cnicas profesionales de lectura con comprensi√≥n y preguntas estrat√©gicas</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnica de lectura con comprensi√≥n:</h4>
                            <div class="steps">
                                <div class="step"><strong>Lee despacio y con expresi√≥n:</strong> Cambia voces para personajes</div>
                                <div class="step"><strong>Pausa estrat√©gicamente:</strong> Al final de cada p√°rrafo importante</div>
                                <div class="step"><strong>Haz preguntas espec√≠ficas:</strong> "¬øQui√©n era peque√±o?" "¬øQui√©n era grande?"</div>
                                <div class="step"><strong>Espera respuestas completas:</strong> "El rat√≥n era peque√±o" (no solo "rat√≥n")</div>
                                <div class="step"><strong>Conecta con la vida real:</strong> "¬øHas visto un rat√≥n? ¬øEra peque√±o?"</div>
                                <div class="step"><strong>Pide que re-cuente:</strong> "Ahora cu√©ntame t√∫ la historia"</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quiz de Comprensi√≥n -->
                <div id="comprehensionQuiz4" class="quiz-container hidden">
                    <div class="demo-label">üìö DEMOSTRACI√ìN: T√©cnica de comprensi√≥n</div>
                    <h3>üìñ Comprensi√≥n del Cuento</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa adaptar√°s esto:</h3>
                        <p>Con cualquier cuento que leas, haciendo pausas para preguntas y verificando que entienda la secuencia de eventos.</p>
                        <p><strong>Objetivo:</strong> Desarrollar comprensi√≥n, memoria secuencial y capacidad de respuesta.</p>
                    </div>
                    
                    <div class="quiz-question">
                        <p id="quizQuestion">Pregunta aparecer√° aqu√≠</p>
                        <div class="quiz-options" id="quizOptions">
                            <!-- Opciones -->
                        </div>
                    </div>
                    <div class="feedback-box" id="quizFeedback"></div>
                    <button class="btn btn-warning" onclick="nextQuizQuestion()">Siguiente Pregunta</button>
                    <button class="btn" onclick="closeQuiz()">Entend√≠ la T√©cnica</button>
                </div>
            </div>

            <!-- Secci√≥n 3: Rimas y Trabalenguas -->
            <div class="content-section" data-section="rhymes-4">
                <h2 class="section-title">
                    <span>üé≠</span>
                    Rimas y Trabalenguas (4 a√±os)
                </h2>

                <div class="educational-context">
                    <h3>
                        <span>üéµ</span>
                        T√©cnicas de conciencia fonol√≥gica que dominar√°s:
                    </h3>
                    <ul>
                        <li><strong>Identificaci√≥n de rimas:</strong> C√≥mo hacer que escuche sonidos finales iguales</li>
                        <li><strong>Creaci√≥n de rimas:</strong> Inventar palabras que suenen parecido</li>
                        <li><strong>Trabalenguas graduales:</strong> De f√°cil a dif√≠cil para mejorar articulaci√≥n</li>
                        <li><strong>Juegos de sonidos:</strong> Actividades que hagan consciente la pronunciaci√≥n</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startRhymeGame4()" data-activity="rhyme-4">
                        <div class="activity-icon">üé™</div>
                        <div class="activity-title">Encuentra la Rima</div>
                        <div class="activity-description">Aprende t√©cnicas para desarrollar conciencia fonol√≥gica a trav√©s de rimas</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>Metodolog√≠a de ense√±anza de rimas:</h4>
                            <div class="steps">
                                <div class="step"><strong>Empieza con palabras conocidas:</strong> "casa" - busca que termine igual</div>
                                <div class="step"><strong>Exagera el sonido final:</strong> "ca-SA, pa-SA" (enfatiza el final)</div>
                                <div class="step"><strong>Usa objetos reales:</strong> Muestra una casa, una masa, una tasa</div>
                                <div class="step"><strong>Crea rimas inventadas:</strong> "¬øQu√© rima con gato? ¬°Zapato!"</div>
                                <div class="step"><strong>Haz rimas corporales:</strong> "Cabeza rima con... ¬°cerveza!" (aunque sea absurdo)</div>
                            </div>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startTongueTwister4()" data-activity="tongue-4">
                        <div class="activity-icon">üëÖ</div>
                        <div class="activity-title">Trabalenguas F√°ciles</div>
                        <div class="activity-description">T√©cnicas para mejorar articulaci√≥n y fluidez del habla con ejercicios progresivos</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>Progresi√≥n de trabalenguas en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Empieza s√∫per lento:</strong> "Tres-tres-tres tri-stes ti-gres"</div>
                                <div class="step"><strong>Separa por s√≠labas:</strong> Aplaude en cada s√≠laba</div>
                                <div class="step"><strong>Modela claramente:</strong> Exagera los movimientos de tu boca</div>
                                <div class="step"><strong>Acepta intentos:</strong> No importa si no sale perfecto al principio</div>
                                <div class="step"><strong>Aumenta velocidad gradualmente:</strong> Solo cuando domine el lento</div>
                                <div class="step"><strong>Hazlo divertido:</strong> R√≠anse juntos de los errores</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido para 5 a√±os -->
        <div id="content-age-5" class="age-specific-content">
            
            <!-- Secci√≥n 1: Narraci√≥n y Creatividad -->
            <div class="content-section" data-section="narration-5">
                <h2 class="section-title">
                    <span>üé®</span>
                    Narraci√≥n y Creatividad (5 a√±os)
                </h2>
                
                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> A los 5 a√±os, los ni√±os pueden crear historias simples con inicio, desarrollo y final, usando frases de 6-8 palabras. La creatividad narrativa potencia todas las √°reas del lenguaje.
                </div>

                <div class="educational-context">
                    <h3>
                        <span>‚ú®</span>
                        T√©cnicas de estimulaci√≥n creativa que dominar√°s:
                    </h3>
                    <ul>
                        <li><strong>Estructura narrativa b√°sica:</strong> Inicio-problema-soluci√≥n-final</li>
                        <li><strong>Generaci√≥n de ideas:</strong> T√©cnicas para que invente historias originales</li>
                        <li><strong>Descripci√≥n detallada:</strong> C√≥mo hacer que use adjetivos y detalles</li>
                        <li><strong>Di√°logos y roles:</strong> T√©cnicas teatrales para expresi√≥n oral</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startStoryCreator5()" data-activity="create-story-5">
                        <div class="activity-icon">‚úçÔ∏è</div>
                        <div class="activity-title">Crea tu Cuento</div>
                        <div class="activity-description">Aprende el m√©todo profesional para que tu hijo invente historias completas y coherentes</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>M√©todo de creaci√≥n de historias en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Prepara elementos visuales:</strong> Im√°genes de revistas, juguetes, dibujos</div>
                                <div class="step"><strong>Establece estructura:</strong> "Primero vamos a elegir el personaje"</div>
                                <div class="step"><strong>Haz preguntas gu√≠a:</strong> "¬øD√≥nde vive? ¬øQu√© problema tiene?"</div>
                                <div class="step"><strong>Anima a describir:</strong> "¬øC√≥mo es? ¬øGrande o peque√±o? ¬øDe qu√© color?"</div>
                                <div class="step"><strong>Graba o escribe:</strong> Registra su historia para que la vuelva a contar</div>
                                <div class="step"><strong>Celebra la creatividad:</strong> "¬°Qu√© historia tan interesante!"</div>
                            </div>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startDescriptionGame5()" data-activity="describe-5">
                        <div class="activity-icon">üîç</div>
                        <div class="activity-title">Describe y Adivina</div>
                        <div class="activity-description">T√©cnicas para desarrollar vocabulario descriptivo y expresi√≥n detallada</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnica de descripci√≥n detallada:</h4>
                            <div class="steps">
                                <div class="step"><strong>Elige objetos familiares:</strong> Cosas de la casa que conoce bien</div>
                                <div class="step"><strong>Ense√±a categor√≠as descriptivas:</strong> Color, tama√±o, forma, textura, uso</div>
                                <div class="step"><strong>Modela primero:</strong> "Es redondo, rojo, dulce y lo comemos"</div>
                                <div class="step"><strong>Pide que complete:</strong> "Dime algo m√°s sobre esto"</div>
                                <div class="step"><strong>Acepta todas las descripciones:</strong> Incluso las creativas o inusuales</div>
                                <div class="step"><strong>Expande sus ideas:</strong> "S√≠, es rojo. ¬øQu√© m√°s cosas son rojas?"</div>
                            </div>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startDialogGame5()" data-activity="dialog-5">
                        <div class="activity-icon">üí¨</div>
                        <div class="activity-title">Conversaciones</div>
                        <div class="activity-description">Domina t√©cnicas de role-play para desarrollar habilidades conversacionales avanzadas</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>Metodolog√≠a de conversaciones estructuradas:</h4>
                            <div class="steps">
                                <div class="step"><strong>Elige situaciones reales:</strong> Ir al doctor, comprar en la tienda</div>
                                <div class="step"><strong>Asigna roles claros:</strong> "T√∫ eres el vendedor, yo soy el cliente"</div>
                                <div class="step"><strong>Provee frases modelo:</strong> "Puedes decir: ¬øEn qu√© le puedo ayudar?"</div>
                                <div class="step"><strong>Practica cortes√≠a:</strong> "Por favor", "gracias", "de nada"</div>
                                <div class="step"><strong>Cambia roles:</strong> Que experimente ambas perspectivas</div>
                                <div class="step"><strong>Conecta con la vida real:</strong> Usa estas conversaciones cuando salgan</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Creador de Historias -->
                <div id="storyCreator5" class="game-container hidden">
                    <div class="demo-label">‚úçÔ∏è DEMOSTRACI√ìN: M√©todo de creaci√≥n</div>
                    <h3>‚úçÔ∏è Crea tu Propia Historia</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa necesitar√°s:</h3>
                        <ul>
                            <li>Im√°genes variadas (revistas, fotos, dibujos)</li>
                            <li>Papel para escribir o dibujar la historia</li>
                            <li>Tiempo sin interrupciones (15-20 minutos)</li>
                        </ul>
                        <p><strong>Objetivo:</strong> Que desarrolle estructura narrativa y confianza para expresar ideas complejas.</p>
                    </div>
                    
                    <div class="game-area">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 1rem 0;">
                            <div style="text-align: center;">
                                <p><strong>Inicio</strong></p>
                                <div id="storyBeginning" class="drop-zone" style="min-height: 150px;">
                                    Arrastra una imagen aqu√≠
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <p><strong>Desarrollo</strong></p>
                                <div id="storyMiddle" class="drop-zone" style="min-height: 150px;">
                                    Arrastra una imagen aqu√≠
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <p><strong>Final</strong></p>
                                <div id="storyEnd" class="drop-zone" style="min-height: 150px;">
                                    Arrastra una imagen aqu√≠
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <p><strong>Banco de im√°genes:</strong></p>
                            <div id="imageBank" style="display: flex; flex-wrap: wrap; gap: 1rem;">
                                <!-- Im√°genes draggables -->
                            </div>
                        </div>

                        <button class="btn btn-success" onclick="tellStory()">Contar la Historia</button>
                    </div>
                    <div class="feedback-box" id="storyFeedback"></div>
                    <button class="btn" onclick="closeStoryCreator()">Entend√≠ la T√©cnica</button>
                </div>
            </div>

            <!-- Secci√≥n 2: Juegos de L√≥gica Verbal -->
            <div class="content-section" data-section="logic-5">
                <h2 class="section-title">
                    <span>üß†</span>
                    L√≥gica Verbal (5 a√±os)
                </h2>

                <div class="educational-context">
                    <h3>
                        <span>üîó</span>
                        T√©cnicas de pensamiento l√≥gico verbal que aprender√°s:
                    </h3>
                    <ul>
                        <li><strong>Clasificaci√≥n por categor√≠as:</strong> C√≥mo ense√±ar agrupaci√≥n l√≥gica</li>
                        <li><strong>Relaciones de oposici√≥n:</strong> T√©cnica de contrastes para vocabulario</li>
                        <li><strong>Analog√≠as simples:</strong> "Es como... pero diferente en..."</li>
                        <li><strong>Causa y efecto:</strong> "¬øQu√© pasa si...?" para pensamiento cr√≠tico</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startCategoryGame5()" data-activity="category-5">
                        <div class="activity-icon">üì¶</div>
                        <div class="activity-title">Categor√≠as</div>
                        <div class="activity-description">Aprende m√©todos profesionales para ense√±ar clasificaci√≥n y organizaci√≥n del pensamiento</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnica de categorizaci√≥n en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Usa objetos reales:</strong> Juguetes, ropa, comida de la casa</div>
                                <div class="step"><strong>Empieza con 2 categor√≠as:</strong> "Animales" y "no animales"</div>
                                <div class="step"><strong>Explica el criterio:</strong> "Esto va aqu√≠ porque es un animal"</div>
                                <div class="step"><strong>Deja que clasifique:</strong> Que ponga cada objeto en su lugar</div>
                                <div class="step"><strong>Pregunta el por qu√©:</strong> "¬øPor qu√© pusiste eso ah√≠?"</div>
                                <div class="step"><strong>Aumenta complejidad:</strong> "Animales que vuelan" vs "animales que caminan"</div>
                            </div>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startOppositeGame5()" data-activity="opposite-5">
                        <div class="activity-icon">‚ÜîÔ∏è</div>
                        <div class="activity-title">Opuestos</div>
                        <div class="activity-description">T√©cnicas para desarrollar vocabulario contrastivo y pensamiento comparativo</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>Metodolog√≠a de opuestos en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Usa experiencias f√≠sicas:</strong> Agua caliente vs fr√≠a, sonido alto vs bajo</div>
                                <div class="step"><strong>Compara objetos reales:</strong> "Esta caja es grande, esta es..."</div>
                                <div class="step"><strong>Act√∫a los opuestos:</strong> Caminar r√°pido vs lento</div>
                                <div class="step"><strong>Crea juegos de contraste:</strong> "Yo digo alto, t√∫ dices..."</div>
                                <div class="step"><strong>Conecta con emociones:</strong> "Cuando estoy feliz, lo opuesto es..."</div>
                            </div>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startAnalogiesGame5()" data-activity="analogies-5">
                        <div class="activity-icon">üîó</div>
                        <div class="activity-title">Analog√≠as Simples</div>
                        <div class="activity-description">T√©cnicas avanzadas para desarrollar pensamiento relacional y l√≥gico</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnica de analog√≠as para ni√±os:</h4>
                            <div class="steps">
                                <div class="step"><strong>Empieza con relaciones obvias:</strong> "Perro es a ladrar como gato es a..."</div>
                                <div class="step"><strong>Usa gestos y sonidos:</strong> Acompa√±a con movimientos</div>
                                <div class="step"><strong>Explica la relaci√≥n:</strong> "Los dos son sonidos que hacen"</div>
                                <div class="step"><strong>Permite respuestas creativas:</strong> Acepta variaciones l√≥gicas</div>
                                <div class="step"><strong>Conecta con conocimiento previo:</strong> "¬øRecuerdas cu√°ndo vimos un gato?"</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 3: Teatro y Expresi√≥n -->
            <div class="content-section" data-section="theater-5">
                <h2 class="section-title">
                    <span>üé≠</span>
                    Teatro y Expresi√≥n (5 a√±os)
                </h2>

                <div class="educational-context">
                    <h3>
                        <span>üé™</span>
                        T√©cnicas teatrales para desarrollo del lenguaje:
                    </h3>
                    <ul>
                        <li><strong>Interpretaci√≥n de roles:</strong> C√≥mo usar personajes para expandir vocabulario</li>
                        <li><strong>Expresi√≥n emocional:</strong> T√©cnicas para identificar y verbalizar sentimientos</li>
                        <li><strong>Improvisaci√≥n guiada:</strong> Estructurar juegos de actuaci√≥n educativos</li>
                        <li><strong>Proyecci√≥n de voz:</strong> T√©cnicas para mejorar claridad y confianza</li>
                    </ul>
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startRolePlay5()" data-activity="roleplay-5">
                        <div class="activity-icon">üë®‚Äçüë©‚Äçüëß</div>
                        <div class="activity-title">Juego de Roles</div>
                        <div class="activity-description">Domina el uso del role-play como herramienta de desarrollo ling√º√≠stico</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>T√©cnica de juego de roles en casa:</h4>
                            <div class="steps">
                                <div class="step"><strong>Elige roles familiares:</strong> Doctor, maestro, chef, pap√°/mam√°</div>
                                <div class="step"><strong>Provee "herramientas":</strong> Objetos que representen cada rol</div>
                                <div class="step"><strong>Establece el escenario:</strong> "Estamos en el hospital"</div>
                                <div class="step"><strong>Gu√≠a el di√°logo inicial:</strong> "¬øQu√© dice un doctor?"</div>
                                <div class="step"><strong>Deja fluir la creatividad:</strong> Permite improvisaci√≥n</div>
                                <div class="step"><strong>Introduce vocabulario espec√≠fico:</strong> Palabras propias de cada profesi√≥n</div>
                            </div>
                        </div>
                    </div>

                    <div class="activity-card" onclick="startEmotionsGame5()" data-activity="emotions-5">
                        <div class="activity-icon">üòä</div>
                        <div class="activity-title">Expresando Emociones</div>
                        <div class="activity-description">T√©cnicas especializadas para desarrollar inteligencia emocional a trav√©s del lenguaje</div>
                        <div class="home-activity-badge">üè† PARA RECREAR EN CASA</div>
                        
                        <div class="activity-instructions">
                            <h4>Metodolog√≠a de expresi√≥n emocional:</h4>
                            <div class="steps">
                                <div class="step"><strong>Usa tu propio rostro:</strong> Modela expresiones faciales claras</div>
                                <div class="step"><strong>Conecta con situaciones reales:</strong> "¬øC√≥mo te sientes cuando llueve?"</div>
                                <div class="step"><strong>Ense√±a grados de emoci√≥n:</strong> "Un poco triste" vs "muy triste"</div>
                                <div class="step"><strong>Valida sus emociones:</strong> "Es normal sentirse as√≠"</div>
                                <div class="step"><strong>Ense√±a vocabulario emocional:</strong> M√°s all√° de "bien" o "mal"</div>
                                <div class="step"><strong>Practica soluciones:</strong> "¬øQu√© puedes hacer cuando te sientes as√≠?"</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Quiz Final del M√≥dulo -->
        <div class="content-section">
            <h2 class="section-title">
                <span>üèÜ</span>
                Evaluaci√≥n Final del M√≥dulo
            </h2>
            
            <div class="alert alert-warning">
                <strong>üìù Importante:</strong> Completa al menos 8 actividades antes de realizar la evaluaci√≥n final.
            </div>

            <button class="btn btn-success" onclick="startFinalQuiz()" id="finalQuizBtn" disabled>
                Comenzar Evaluaci√≥n Final
            </button>

            <div id="finalQuizContainer" class="quiz-container hidden">
                <h3>üèÜ Evaluaci√≥n Final</h3>
                <div class="timer">Tiempo: <span id="quizTimer">05:00</span></div>
                <div class="quiz-question" id="finalQuestion">
                    <!-- Preguntas din√°micas seg√∫n edad -->
                </div>
                <div class="feedback-box" id="finalFeedback"></div>
                <button class="btn btn-warning" onclick="submitFinalQuiz()">Enviar Respuestas</button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="module-navigation">
            <a href="../modulo2/index.html" class="btn btn-secondary">‚Üê M√≥dulo 2</a>
            <div>
                <button class="btn" onclick="generateCertificate()" id="certificateBtn" style="display: none;">üèÜ Certificado</button>
                <button class="btn" onclick="printActivities()" style="margin: 0 0.5rem;">üìÑ Imprimir Plan</button>
                <a href="../modulo4/index.html" class="btn" id="nextModuleBtn" style="display: none;">M√≥dulo 4 ‚Üí</a>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let selectedAge = null;
        let completedActivities = new Set();
        let totalActivities = 12;
        let currentScore = 0;
        let currentQuizQuestion = 0;
        let quizTimer = null;
        let storyPage = 0;
        let achievements = new Set();
        let selectedFoodCount = 0;
        let maxFoodSelection = 3;

        // Base de datos de contenido por edad - MEJORADA
        const contentDatabase = {
            3: {
                vocabulary: {
                    colors: [
                        {name: 'rojo', items: ['üçé manzana', 'üçì fresa', '‚ù§Ô∏è coraz√≥n', 'üåπ rosa', 'üöó auto']},
                        {name: 'azul', items: ['üåä agua', 'üêü pez', 'üëï camisa', 'üåå cielo', 'üìò libro']},
                        {name: 'amarillo', items: ['‚òÄÔ∏è sol', 'üåª girasol', 'üçå pl√°tano', '‚≠ê estrella', 'üöï taxi']},
                        {name: 'verde', items: ['üå≥ √°rbol', 'ü•¶ br√≥coli', 'üê∏ rana', 'üåø hoja', 'üçè manzana']}
                    ],
                    animals: [
                        {emoji: 'üêÆ', name: 'vaca', sound: 'MUU', soundDesc: 'Haz un sonido grave y largo: "MUUUUU"'},
                        {emoji: 'üê∂', name: 'perro', sound: 'GUAU-GUAU', soundDesc: 'Ladra fuerte y claro: "GUAU GUAU"'},
                        {emoji: 'üê±', name: 'gato', sound: 'MIAU', soundDesc: 'Sonido suave y melodioso: "MIAAAU"'},
                        {emoji: 'üê∑', name: 'cerdo', sound: 'OINK-OINK', soundDesc: 'Sonido nasal divertido: "OINK OINK"'},
                        {emoji: 'üêî', name: 'pollo', sound: 'P√çO-P√çO', soundDesc: 'Sonido agudo y r√°pido: "P√çO P√çO P√çO"'},
                        {emoji: 'ü¶Ü', name: 'pato', sound: 'CUAC-CUAC', soundDesc: 'Sonido nasal: "CUAC CUAC"'}
                    ],
                    bodyParts: ['cabeza', 'ojos', 'nariz', 'boca', 'orejas', 'manos', 'pies', 'barriga'],
                    foods: [
                        {name: 'manzana', emoji: 'üçé', category: 'fruta'},
                        {name: 'pl√°tano', emoji: 'üçå', category: 'fruta'},
                        {name: 'leche', emoji: 'ü•õ', category: 'bebida'},
                        {name: 'pan', emoji: 'üçû', category: 'cereal'},
                        {name: 'agua', emoji: 'üíß', category: 'bebida'},
                        {name: 'galleta', emoji: 'üç™', category: 'dulce'},
                        {name: 'queso', emoji: 'üßÄ', category: 'l√°cteo'},
                        {name: 'huevo', emoji: 'ü•ö', category: 'prote√≠na'}
                    ],
                    actions: ['comer', 'dormir', 'jugar', 'correr', 'saltar', 'cantar']
                },
                stories: [
                    {
                        title: "El Conejito Saltar√≠n",
                        pages: [
                            "Hab√≠a una vez un conejito üê∞ que le gustaba saltar.",
                            "Saltaba por aqu√≠... ¬°HOP! Saltaba por all√°... ¬°HOP!",
                            "Un d√≠a encontr√≥ una zanahoria ü•ï muy grande.",
                            "¬°√ëam, √±am! Qu√© rica estaba la zanahoria.",
                            "Y color√≠n colorado, este cuento se ha acabado."
                        ],
                        interactions: [null, 'jump', null, 'eat', null]
                    }
                ],
                songs: [
                    {
                        title: "Los N√∫meros Bailarines",
                        lyrics: "Uno, dos, tres - mueve los pies\nCuatro, cinco, seis - salta otra vez\nSiete, ocho, nueve - el cuerpo se mueve\nDiez, diez, diez - ¬°baila con los pies!",
                        instructions: "Canta lentamente y haz los movimientos. Repite hasta que memorice los n√∫meros del 1 al 10."
                    },
                    {
                        title: "El Arco√≠ris Musical",
                        lyrics: "Rojo como el tomate, rojo como el coraz√≥n\nAzul como el cielo, azul como el mar\nVerde como la hierba, verde como el lim√≥n\nAmarillo como el sol que nos viene a despertar",
                        instructions: "Se√±ala objetos de cada color mientras cantas. Inventa nuevas estrofas con otros colores."
                    }
                ]
            },
            4: {
                sentences: {
                    subjects: ['El ni√±o', 'La ni√±a', 'El perro', 'Mi mam√°', 'Mi pap√°', 'La maestra'],
                    verbs: ['come', 'juega', 'corre', 'lee', 'canta', 'dibuja'],
                    objects: ['la pelota', 'una manzana', 'el libro', 'una canci√≥n', 'el juguete', 'un dibujo'],
                    places: ['en el parque', 'en casa', 'en la escuela', 'en el jard√≠n'],
                    examples: [
                        'El ni√±o come la manzana',
                        'Mi mam√° lee el libro',
                        'La ni√±a juega en el parque'
                    ]
                },
                comprehension: {
                    story: "Un d√≠a, un rat√≥n peque√±o üê≠ pas√≥ cerca de un le√≥n dormido ü¶Å. El le√≥n se despert√≥ y atrap√≥ al rat√≥n. '¬°Por favor, no me comas!', dijo el rat√≥n. 'Un d√≠a te ayudar√©'. El le√≥n se ri√≥ pero lo dej√≥ ir. D√≠as despu√©s, el le√≥n qued√≥ atrapado en una red. El rat√≥n vino y mordi√≥ la red hasta liberarlo. 'Gracias, peque√±o amigo', dijo el le√≥n.",
                    questions: [
                        {
                            question: "¬øQui√©n qued√≥ atrapado primero?",
                            options: ["El rat√≥n", "El le√≥n", "Nadie"],
                            correct: 0,
                            explanation: "El le√≥n atrap√≥ al rat√≥n al principio de la historia."
                        },
                        {
                            question: "¬øC√≥mo ayud√≥ el rat√≥n al le√≥n?",
                            options: ["Le trajo comida", "Mordi√≥ la red", "Llam√≥ ayuda"],
                            correct: 1,
                            explanation: "El rat√≥n mordi√≥ la red hasta liberar al le√≥n."
                        },
                        {
                            question: "¬øQu√© aprendemos del cuento?",
                            options: ["Los peque√±os pueden ayudar", "Los leones son malos", "Los ratones son r√°pidos"],
                            correct: 0,
                            explanation: "La historia ense√±a que hasta los m√°s peque√±os pueden ayudar a los grandes."
                        }
                    ]
                },
                rhymes: {
                    words: [
                        {word: 'gato', rhymes: ['pato', 'zapato', 'plato'], nonRhymes: ['perro', 'casa']},
                        {word: 'casa', rhymes: ['pasa', 'masa', 'taza'], nonRhymes: ['auto', 'libro']},
                        {word: 'pelota', rhymes: ['bota', 'flota', 'gota'], nonRhymes: ['mesa', 'silla']}
                    ]
                },
                tongueTwisters: [
                    {text: "Tres tristes tigres", instruction: "Repite muy lentamente, separando cada palabra"},
                    {text: "Pepe pica papas", instruction: "Enfatiza el sonido 'P' en cada palabra"},
                    {text: "El perro de Rita", instruction: "Practica el sonido 'RR' fuerte"}
                ]
            },
            5: {
                storyElements: {
                    characters: [
                        {emoji: 'üë∏', name: 'princesa', description: 'valiente y amable'},
                        {emoji: 'ü¶∏', name: 'superh√©roe', description: 'fuerte y protector'},
                        {emoji: 'üßô', name: 'mago', description: 'sabio y misterioso'},
                        {emoji: 'üêâ', name: 'drag√≥n', description: 'grande pero amigable'},
                        {emoji: 'ü§ñ', name: 'robot', description: 'inteligente y √∫til'}
                    ],
                    settings: [
                        {emoji: 'üè∞', name: 'castillo', description: 'lugar m√°gico'},
                        {emoji: 'üå≥', name: 'bosque', description: 'lleno de aventuras'},
                        {emoji: 'üèñÔ∏è', name: 'playa', description: 'junto al mar'},
                        {emoji: 'üåô', name: 'espacio', description: 'entre las estrellas'},
                        {emoji: 'üèîÔ∏è', name: 'monta√±a', description: 'muy alta'}
                    ],
                    problems: [
                        'perdi√≥ algo importante',
                        'necesita encontrar el camino a casa',
                        'est√° atrapado en un lugar',
                        'busca un tesoro escondido',
                        'quiere hacer nuevos amigos'
                    ],
                    solutions: [
                        'encuentra amigos que lo ayudan',
                        'usa magia especial',
                        'resuelve un acertijo dif√≠cil',
                        'trabaja en equipo',
                        'descubre algo sorprendente'
                    ]
                },
                categories: {
                    animals: ['le√≥n', 'tigre', 'elefante', 'jirafa', 'mono', 'ping√ºino'],
                    transport: ['auto', 'avi√≥n', 'barco', 'tren', 'bicicleta', 'helic√≥ptero'],
                    clothes: ['camisa', 'pantal√≥n', 'zapatos', 'gorro', 'vestido', 'medias'],
                    tools: ['martillo', 'tijeras', 'cuchara', 'l√°piz', 'pincel', 'llave']
                },
                opposites: [
                    {word: 'grande', opposite: 'peque√±o', example: 'Un elefante es grande, un rat√≥n es peque√±o'},
                    {word: 'alto', opposite: 'bajo', example: 'Un adulto es alto, un beb√© es bajo'},
                    {word: 'r√°pido', opposite: 'lento', example: 'Un auto es r√°pido, una tortuga es lenta'},
                    {word: 'caliente', opposite: 'fr√≠o', example: 'El fuego es caliente, el hielo es fr√≠o'},
                    {word: 'd√≠a', opposite: 'noche', example: 'Jugamos de d√≠a, dormimos de noche'}
                ],
                analogies: [
                    {
                        text: "P√°jaro es a volar como pez es a ___",
                        answer: "nadar",
                        options: ["caminar", "nadar", "correr", "saltar"],
                        explanation: "Los p√°jaros vuelan en el aire, los peces nadan en el agua"
                    },
                    {
                        text: "D√≠a es a sol como noche es a ___",
                        answer: "luna",
                        options: ["estrella", "sol", "luna", "nube"],
                        explanation: "Durante el d√≠a vemos el sol, durante la noche vemos la luna"
                    },
                    {
                        text: "Fr√≠o es a invierno como calor es a ___",
                        answer: "verano",
                        options: ["primavera", "verano", "oto√±o", "lluvia"],
                        explanation: "En invierno hace fr√≠o, en verano hace calor"
                    }
                ],
                emotions: [
                    {emoji: 'üòä', name: 'feliz', situations: ['recibir un regalo', 'jugar con amigos', 'comer algo rico']},
                    {emoji: 'üò¢', name: 'triste', situations: ['perder un juguete', 'despedirse de alguien', 'no poder jugar']},
                    {emoji: 'üò°', name: 'enojado', situations: ['cuando algo no sale bien', 'si alguien te molesta', 'cuando hay injusticia']},
                    {emoji: 'üò®', name: 'asustado', situations: ['escuchar truenos', 'ver algo desconocido', 'estar en la oscuridad']},
                    {emoji: 'üò≤', name: 'sorprendido', situations: ['algo inesperado', 'una sorpresa', 'algo muy grande']},
                    {emoji: 'ü§ó', name: 'emocionado', situations: ['ir de paseo', 'comenzar algo nuevo', 'ver algo incre√≠ble']}
                ],
                roleplay: {
                    scenarios: [
                        {
                            name: 'doctor',
                            phrases: [
                                "¬øD√≥nde te duele?",
                                "Voy a revisar tu temperatura",
                                "Toma esta medicina",
                                "Pronto te sentir√°s mejor"
                            ],
                            vocabulary: ['medicina', 'temperatura', 'estetoscopio', 'curar', 'salud']
                        },
                        {
                            name: 'maestro',
                            phrases: [
                                "Buenos d√≠as, clase",
                                "¬øQui√©n sabe la respuesta?",
                                "Muy bien, excelente trabajo",
                                "Vamos a aprender algo nuevo"
                            ],
                            vocabulary: ['ense√±ar', 'aprender', 'pizarra', 'estudiante', 'tarea']
                        },
                        {
                            name: 'chef',
                            phrases: [
                                "¬øQu√© quieres comer?",
                                "Voy a cocinar algo delicioso",
                                "La comida est√° lista",
                                "¬øTe gusta el sabor?"
                            ],
                            vocabulary: ['cocinar', 'receta', 'ingredientes', 'sabor', 'delicioso']
                        },
                        {
                            name: 'vendedor',
                            phrases: [
                                "¬øEn qu√© le puedo ayudar?",
                                "Este producto es muy bueno",
                                "¬øCu√°nto quiere llevar?",
                                "Gracias por su compra"
                            ],
                            vocabulary: ['vender', 'comprar', 'dinero', 'producto', 'cliente']
                        }
                    ]
                }
            }
        };

        // Inicializaci√≥n mejorada
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ Iniciando M√≥dulo 3: Actividades y Juegos');
            checkModuleAccess();
            loadSavedProgress();
            initializeDragAndDrop();
            showWelcomeMessage();
        });

        // Verificar acceso al m√≥dulo
        function checkModuleAccess() {
            const courseProgress = JSON.parse(localStorage.getItem('courseProgress') || '[false,false,false,false,false]');
            // En producci√≥n descomentar esta validaci√≥n:
            // if (!courseProgress[1]) {
            //     alert('‚ö†Ô∏è Debes completar el M√≥dulo 2 primero');
            //     window.location.href = '../modulo2/index.html';
            // }
        }

        // Mensaje de bienvenida educativo
        function showWelcomeMessage() {
            setTimeout(() => {
                if (!localStorage.getItem('module3_welcome_shown')) {
                    showNotification(`
                        üè† ¬°Bienvenido al M√≥dulo 3! 
                        Aqu√≠ aprender√°s actividades para hacer en casa con tu hijo. 
                        Los juegos que veas son ejemplos para que practiques las t√©cnicas.
                    `, 'info', 8000);
                    localStorage.setItem('module3_welcome_shown', 'true');
                }
            }, 2000);
        }

        // Selecci√≥n de edad mejorada
        function selectAge(age) {
            selectedAge = age;
            
            // Actualizar botones
            document.querySelectorAll('.age-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar mensaje
            document.getElementById('ageMessage').style.display = 'block';
            document.getElementById('selectedAge').textContent = age;
            
            // Ocultar todo el contenido espec√≠fico de edad
            document.querySelectorAll('.age-specific-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Mostrar contenido de la edad seleccionada
            const ageContent = document.getElementById(`content-age-${age}`);
            if (ageContent) {
                ageContent.classList.add('active');
            }
            
            // Guardar selecci√≥n
            localStorage.setItem('module3SelectedAge', age);
            
            // Ajustar total de actividades seg√∫n edad
            totalActivities = age === 3 ? 8 : age === 4 ? 10 : 12;
            updateProgress();
            
            showNotification(`‚úÖ Actividades adaptadas para ${age} a√±os cargadas`, 'success');
        }

        // JUEGOS PARA 3 A√ëOS - MEJORADOS

        // Juego Veo-Veo mejorado
        function startVocabGame3() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('veoVeoGame3').classList.remove('hidden');
            initializeVeoVeoGame();
        }

        function initializeVeoVeoGame() {
            const colors = contentDatabase[3].vocabulary.colors;
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            document.getElementById('targetColor').textContent = randomColor.name.toUpperCase();
            document.getElementById('targetColor').style.color = getColorHex(randomColor.name);
            
            const objectsContainer = document.getElementById('veoVeoObjects');
            objectsContainer.innerHTML = '';
            
            // Crear objetos para el juego
            let allObjects = [...randomColor.items];
            
            // Agregar objetos de otros colores como distractores
            const otherColors = colors.filter(c => c.name !== randomColor.name);
            otherColors.forEach(color => {
                const randomItem = color.items[Math.floor(Math.random() * color.items.length)];
                allObjects.push(randomItem);
            });
            
            // Mezclar y limitar a 6 objetos
            allObjects = allObjects.sort(() => Math.random() - 0.5).slice(0, 6);
            
            allObjects.forEach(obj => {
                const div = document.createElement('div');
                div.className = 'interactive-element';
                div.textContent = obj;
                div.onclick = () => checkVeoVeoAnswer(obj, randomColor);
                objectsContainer.appendChild(div);
            });
        }

        function checkVeoVeoAnswer(selected, targetColor) {
            const feedback = document.getElementById('veoVeoFeedback');
            const isCorrect = targetColor.items.includes(selected);
            
            if (isCorrect) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Muy bien! ${selected} es de color ${targetColor.name}
                    <br><strong>üè† En casa:</strong> Busca m√°s objetos de color ${targetColor.name}
                `;
                updateScore(10);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Intenta otra vez. Busca algo de color ${targetColor.name}
                    <br><strong>üí° Ayuda:</strong> Mira bien los colores
                `;
            }
        }

        function nextVeoVeoRound() {
            initializeVeoVeoGame();
            document.getElementById('veoVeoFeedback').className = 'feedback-box';
        }

        function closeVeoVeoGame() {
            document.getElementById('veoVeoGame3').classList.add('hidden');
            markActivityComplete('vocab-game-3');
        }

        function getColorHex(color) {
            const colors = {
                rojo: '#dc3545',
                azul: '#007bff',
                amarillo: '#ffc107',
                verde: '#28a745'
            };
            return colors[color] || '#333';
        }

        // Juego de Sonidos de Animales mejorado
        function startAnimalSounds3() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('animalSoundsGame3').classList.remove('hidden');
            initializeAnimalGame();
        }

        function initializeAnimalGame() {
            const animals = contentDatabase[3].vocabulary.animals;
            const currentAnimal = animals[Math.floor(Math.random() * animals.length)];
            
            document.getElementById('animalImage').textContent = currentAnimal.emoji;
            
            // Guardar para verificaci√≥n
            window.currentAnimal = currentAnimal;
            
            const optionsContainer = document.getElementById('animalOptions');
            optionsContainer.innerHTML = '';
            
            // Crear opciones (incluir respuesta correcta + 2 incorrectas)
            let options = [currentAnimal.name];
            while (options.length < 3) {
                const randomAnimal = animals[Math.floor(Math.random() * animals.length)];
                if (!options.includes(randomAnimal.name)) {
                    options.push(randomAnimal.name);
                }
            }
            
            // Mezclar opciones
            options.sort(() => Math.random() - 0.5);
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-info';
                btn.textContent = opt;
                btn.onclick = () => checkAnimalAnswer(opt, currentAnimal.name);
                optionsContainer.appendChild(btn);
            });
        }

        function playAnimalSound() {
            const currentAnimal = window.currentAnimal;
            
            // Mostrar instrucciones de sonido
            const soundInstruction = document.createElement('div');
            soundInstruction.style.cssText = `
                background: #fff3cd; 
                border: 1px solid #ffeaa7; 
                color: #856404; 
                padding: 1rem; 
                border-radius: 10px; 
                margin: 1rem 0;
                font-weight: bold;
                text-align: center;
            `;
            soundInstruction.innerHTML = `
                üîä ${currentAnimal.soundDesc}
                <br><strong>Sonido:</strong> "${currentAnimal.sound}"
            `;
            
            const gameArea = document.querySelector('#animalSoundsGame3 .game-area');
            const existingInstruction = gameArea.querySelector('.sound-instruction');
            if (existingInstruction) existingInstruction.remove();
            
            soundInstruction.className = 'sound-instruction';
            gameArea.insertBefore(soundInstruction, gameArea.children[1]);
            
            // Mostrar texto del sonido animado
            const soundText = document.createElement('div');
            soundText.style.cssText = `
                font-size: 2.5rem; 
                font-weight: bold; 
                color: #f093fb; 
                animation: pulse 2s; 
                text-align: center;
                margin: 1rem 0;
            `;
            soundText.textContent = currentAnimal.sound;
            
            const existing = gameArea.querySelector('.sound-display');
            if (existing) existing.remove();
            
            soundText.className = 'sound-display';
            gameArea.insertBefore(soundText, gameArea.children[2]);
            
            setTimeout(() => {
                if (soundText.parentNode) soundText.remove();
            }, 3000);
        }

        function checkAnimalAnswer(selected, correct) {
            const feedback = document.getElementById('animalFeedback');
            const currentAnimal = window.currentAnimal;
            
            if (selected === correct) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Correcto! Es un ${correct} y hace "${currentAnimal.sound}"
                    <br><strong>üè† En casa:</strong> ${currentAnimal.soundDesc}
                `;
                updateScore(10);
                
                setTimeout(() => {
                    initializeAnimalGame();
                    feedback.className = 'feedback-box';
                    // Limpiar instrucciones
                    const instructions = document.querySelectorAll('.sound-instruction, .sound-display');
                    instructions.forEach(el => el.remove());
                }, 3000);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå No es ${selected}. Escucha otra vez el sonido.
                    <br><strong>üí° Tip:</strong> Presiona el bot√≥n de sonido de nuevo
                `;
            }
        }

        function closeAnimalSoundsGame() {
            document.getElementById('animalSoundsGame3').classList.add('hidden');
            markActivityComplete('animal-sounds-3');
        }
        // Juego de Partes del Cuerpo mejorado
        function startBodyParts3() {
            if (!checkAgeSelected()) return;
            
            const gameHTML = `
                <div class="game-container">
                    <div class="demo-label">üë∂ DEMOSTRACI√ìN: T√©cnica "Sim√≥n dice"</div>
                    <h3>üë∂ Mi Cuerpo</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa har√°s esto:</h3>
                        <ul>
                            <li>Ponte frente a tu hijo para que pueda imitarte</li>
                            <li>Toca la parte de tu cuerpo mientras dices el nombre</li>
                            <li>Celebra cada intento, aunque no sea perfecto</li>
                        </ul>
                        <p><strong>Objetivo:</strong> Que asocie palabras con partes del cuerpo a trav√©s del movimiento.</p>
                    </div>
                    
                    <div class="game-area" style="text-align: center;">
                        <div style="font-size: 8rem;">üë¶</div>
                        <p style="font-size: 1.3rem; font-weight: bold; margin: 1rem;">
                            Sim√≥n dice: ¬°Toca tu <span id="bodyPartTarget" style="color: #f093fb;">NARIZ</span>!
                        </p>
                        <div id="bodyPartsOptions" style="display: flex; justify-content: center; gap: 1rem; margin: 2rem 0; flex-wrap: wrap;">
                            <!-- Se llenar√°n din√°micamente -->
                        </div>
                        <div id="bodyPartInstruction" style="background: #e7f3ff; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <strong>üè† En casa:</strong> Dile "Sim√≥n dice: toca tu nariz" y ay√∫dalo f√≠sicamente si es necesario.
                        </div>
                    </div>
                    <div class="feedback-box" id="bodyPartsFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('body-parts-3')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="body-parts-3"]').parentElement.appendChild(container.firstElementChild);
            
            startSimonSays();
        }

        function startSimonSays() {
            const parts = contentDatabase[3].vocabulary.bodyParts;
            const targetPart = parts[Math.floor(Math.random() * parts.length)];
            
            document.getElementById('bodyPartTarget').textContent = targetPart.toUpperCase();
            window.currentBodyPart = targetPart;
            
            // Crear botones para partes del cuerpo
            const container = document.getElementById('bodyPartsOptions');
            container.innerHTML = '';
            
            const bodyPartEmojis = {
                'cabeza': 'üë§', 'ojos': 'üëÄ', 'nariz': 'üëÉ', 'boca': 'üëÑ', 
                'orejas': 'üëÇ', 'manos': 'üëê', 'pies': 'üë£', 'barriga': 'ü§∞'
            };
            
            // Mostrar solo 4 opciones incluyendo la correcta
            let options = [targetPart];
            while (options.length < 4) {
                const randomPart = parts[Math.floor(Math.random() * parts.length)];
                if (!options.includes(randomPart)) {
                    options.push(randomPart);
                }
            }
            
            options.sort(() => Math.random() - 0.5);
            
            options.forEach(part => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-info';
                btn.innerHTML = `${bodyPartEmojis[part] || 'üë§'} ${part}`;
                btn.onclick = () => checkBodyPart(part);
                container.appendChild(btn);
            });
        }

        function checkBodyPart(selected) {
            const feedback = document.getElementById('bodyPartsFeedback');
            
            if (selected === window.currentBodyPart) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Muy bien! Tocaste tu ${selected}
                    <br><strong>üè† En casa:</strong> Toca tu propia ${selected} mientras dices la palabra
                `;
                updateScore(10);
                
                setTimeout(() => {
                    startSimonSays();
                    feedback.className = 'feedback-box';
                }, 2000);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Esa no es tu ${window.currentBodyPart}. Intenta de nuevo.
                    <br><strong>üí° Ayuda:</strong> Busca tu ${window.currentBodyPart}
                `;
            }
        }

        // Actividad de la Merienda MEJORADA con l√≠mites
        function startDailyActivity3() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('snackActivity3').classList.remove('hidden');
            initializeSnackActivity();
        }

        function initializeSnackActivity() {
            selectedFoodCount = 0;
            const foods = contentDatabase[3].vocabulary.foods;
            
            const foodGrid = document.getElementById('foodGrid');
            foodGrid.innerHTML = '';
            
            foods.forEach((food, index) => {
                const foodDiv = document.createElement('div');
                foodDiv.className = 'food-item';
                foodDiv.id = `food-${index}`;
                foodDiv.innerHTML = `
                    <div class="food-emoji">${food.emoji}</div>
                    <div>${food.name}</div>
                `;
                foodDiv.onclick = () => selectFood(food, index);
                foodGrid.appendChild(foodDiv);
            });
            
            updateFoodCounter();
        }

        function selectFood(food, index) {
            const foodElement = document.getElementById(`food-${index}`);
            
            if (foodElement.classList.contains('selected')) {
                // Deseleccionar
                foodElement.classList.remove('selected');
                const quantitySelector = foodElement.querySelector('.quantity-selector');
                if (quantitySelector) quantitySelector.remove();
                selectedFoodCount--;
                updateSelectedFoods();
            } else if (selectedFoodCount < maxFoodSelection) {
                // Seleccionar
                foodElement.classList.add('selected');
                
                // Agregar selector de cantidad
                const quantitySelector = document.createElement('div');
                quantitySelector.className = 'quantity-selector';
                quantitySelector.textContent = '1';
                foodElement.appendChild(quantitySelector);
                
                selectedFoodCount++;
                updateSelectedFoods();
            } else {
                showNotification('‚ö†Ô∏è Solo puedes seleccionar m√°ximo 3 alimentos para una merienda saludable', 'warning');
            }
            
            updateFoodCounter();
            
            // Deshabilitar alimentos no seleccionados si se alcanz√≥ el l√≠mite
            if (selectedFoodCount >= maxFoodSelection) {
                document.querySelectorAll('.food-item:not(.selected)').forEach(item => {
                    item.classList.add('disabled');
                });
            } else {
                document.querySelectorAll('.food-item').forEach(item => {
                    item.classList.remove('disabled');
                });
            }
        }

        function updateFoodCounter() {
            document.getElementById('selectedCount').textContent = `${selectedFoodCount}/${maxFoodSelection}`;
            
            const finalizeBtnContainer = document.getElementById('finalizeMealBtn');
            if (selectedFoodCount > 0) {
                finalizeBtnContainer.style.display = 'inline-block';
            } else {
                finalizeBtnContainer.style.display = 'none';
            }
        }

        function updateSelectedFoods() {
            const selectedContainer = document.getElementById('selectedFoods');
            const selectedItems = document.querySelectorAll('.food-item.selected');
            
            if (selectedItems.length === 0) {
                selectedContainer.textContent = 'Selecciona hasta 3 alimentos';
                return;
            }
            
            selectedContainer.innerHTML = '';
            selectedItems.forEach(item => {
                const emoji = item.querySelector('.food-emoji').textContent;
                const name = item.querySelector('div:last-child').textContent;
                const span = document.createElement('span');
                span.style.margin = '0.5rem';
                span.innerHTML = `${emoji} ${name}`;
                selectedContainer.appendChild(span);
            });
        }

        function finalizeMeal() {
            const selectedItems = document.querySelectorAll('.food-item.selected');
            updateScore(selectedItems.length * 5);
            
            showNotification(`
                üçé ¬°Excelente merienda! Seleccionaste ${selectedItems.length} alimentos.
                En casa, habla sobre los sabores, colores y texturas de cada alimento.
            `, 'success', 5000);
            
            markActivityComplete('daily-3');
        }

        function closeSnackActivity() {
            document.getElementById('snackActivity3').classList.add('hidden');
        }

        // FUNCIONES DE CUENTOS INTERACTIVOS MEJORADAS

        function startStory3_1() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('interactiveStory3').classList.remove('hidden');
            storyPage = 0;
            loadStoryPage();
        }

        function loadStoryPage() {
            const story = contentDatabase[3].stories[0];
            const content = document.getElementById('storyContent');
            const interaction = document.getElementById('storyInteraction');
            
            if (storyPage < story.pages.length) {
                content.innerHTML = `
                    <div style="text-align: center;">
                        <p style="font-size: 1.5rem; margin: 2rem 0;">${story.pages[storyPage]}</p>
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <strong>üè† En casa:</strong> Lee con expresi√≥n y pausa para que tu hijo participe
                        </div>
                    </div>
                `;
                
                // Agregar interacci√≥n seg√∫n la p√°gina
                const interactionType = story.interactions[storyPage];
                if (interactionType === 'jump') {
                    interaction.innerHTML = `
                        <div style="text-align: center;">
                            <p><strong>¬°Momento de participar!</strong></p>
                            <p>En casa: Haz que tu hijo salte como el conejito mientras dice "¬°HOP!"</p>
                            <button class="btn btn-warning" onclick="jumpLikeRabbit()">üê∞ Demostrar SALTO</button>
                        </div>
                    `;
                } else if (interactionType === 'eat') {
                    interaction.innerHTML = `
                        <div style="text-align: center;">
                            <p><strong>¬°Momento de participar!</strong></p>
                            <p>En casa: Haz gestos de comer y sonidos "√ëAM √ëAM" juntos</p>
                            <button class="btn btn-warning" onclick="makeEatingSound()">ü•ï Demostrar √ëAM √ëAM</button>
                        </div>
                    `;
                } else {
                    interaction.innerHTML = `
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px;">
                            <strong>üí° En casa:</strong> Pausa aqu√≠ y pregunta "¬øQu√© crees que pasar√° despu√©s?"
                        </div>
                    `;
                }
            } else {
                // Final del cuento
                content.innerHTML = `
                    <div style="text-align: center;">
                        <h3>üéâ ¬°Cuento terminado!</h3>
                        <p>¬°Excelente! Has aprendido la t√©cnica de cuento interactivo.</p>
                        <div style="background: #d4edda; padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                            <h4>üè† Para aplicar en casa:</h4>
                            <ul style="text-align: left; margin: 1rem 0;">
                                <li>Busca momentos para que tu hijo participe f√≠sicamente</li>
                                <li>Usa diferentes voces para los personajes</li>
                                <li>Haz sonidos onomatop√©yicos exagerados</li>
                                <li>Repite las partes que m√°s le gusten</li>
                                <li>Pregunta sobre la historia: "¬øQu√© comi√≥ el conejo?"</li>
                            </ul>
                        </div>
                    </div>
                `;
                interaction.innerHTML = '';
            }
        }

        function nextStoryPage() {
            storyPage++;
            if (storyPage >= contentDatabase[3].stories[0].pages.length) {
                loadStoryPage(); // Mostrar p√°gina de finalizaci√≥n
                document.querySelector('#interactiveStory3 .btn-warning').style.display = 'none';
            } else {
                loadStoryPage();
            }
        }

        function closeStory() {
            document.getElementById('interactiveStory3').classList.add('hidden');
            markActivityComplete('story-3-1');
        }

        function jumpLikeRabbit() {
            const btn = event.target;
            btn.style.animation = 'bounce 0.5s';
            btn.innerHTML = 'üê∞ ¬°HOP! ¬°HOP!';
            setTimeout(() => {
                btn.style.animation = '';
                btn.innerHTML = 'üê∞ Demostrar SALTO';
            }, 1000);
            updateScore(5);
            showNotification('üê∞ ¬°Perfecto! En casa, salta junto con tu hijo', 'success');
        }

        function makeEatingSound() {
            const btn = event.target;
            btn.innerHTML = 'ü•ï √ëAM √ëAM √ëAM!';
            btn.style.animation = 'pulse 1s';
            setTimeout(() => {
                btn.innerHTML = 'ü•ï Demostrar √ëAM √ëAM';
                btn.style.animation = '';
            }, 1500);
            updateScore(5);
            showNotification('ü•ï ¬°Excelente! Haz estos sonidos exagerados en casa', 'success');
        }

        // Cuento de completar frases
        function startStory3_2() {
            if (!checkAgeSelected()) return;
            
            const storyHTML = `
                <div class="game-container">
                    <div class="demo-label">üåô DEMOSTRACI√ìN: T√©cnica de completar frases</div>
                    <h3>üåô La Luna y las Estrellas</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa aplicar√°s:</h3>
                        <ul>
                            <li>Lee despacio hasta la palabra que falta</li>
                            <li>Haz una pausa larga esperando que complete</li>
                            <li>Si no responde, da la primera s√≠laba como pista</li>
                            <li>Celebra cualquier intento de completar</li>
                        </ul>
                    </div>
                    
                    <div class="game-area">
                        <div style="font-size: 1.1rem; line-height: 2; background: #f8f9fa; padding: 1.5rem; border-radius: 10px;">
                            <p>La luna üåô brillaba en el <input type="text" placeholder="cielo" style="border-bottom: 2px solid #667eea; width: 100px; background: #fff3cd;"> nocturno.</p>
                            <p>Las estrellas ‚≠ê eran muy <input type="text" placeholder="brillantes" style="border-bottom: 2px solid #667eea; width: 120px; background: #fff3cd;"> y bonitas.</p>
                            <p>El ni√±o las miraba desde su <input type="text" placeholder="ventana" style="border-bottom: 2px solid #667eea; width: 100px; background: #fff3cd;"> peque√±a.</p>
                            <p>Y se qued√≥ <input type="text" placeholder="dormido" style="border-bottom: 2px solid #667eea; width: 100px; background: #fff3cd;"> so√±ando con ellas.</p>
                        </div>
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <strong>üí° Palabras sugeridas:</strong> cielo, brillantes, ventana, dormido
                        </div>
                        <button class="btn btn-success" onclick="checkStoryCompletion()">Verificar Cuento</button>
                    </div>
                    <div class="feedback-box" id="storyCompletionFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('story-3-2')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = storyHTML;
            document.querySelector('[data-activity="story-3-2"]').parentElement.appendChild(container.firstElementChild);
        }

        function checkStoryCompletion() {
            const inputs = document.querySelectorAll('input[type="text"]');
            const expectedAnswers = ['cielo', 'brillantes', 'ventana', 'dormido'];
            let correct = 0;
            let filled = 0;
            
            inputs.forEach((input, index) => {
                if (input.value.trim().length > 0) {
                    filled++;
                    if (input.value.toLowerCase().trim() === expectedAnswers[index]) {
                        correct++;
                        input.style.borderColor = '#28a745';
                        input.style.backgroundColor = '#d4edda';
                    } else {
                        input.style.borderColor = '#ffc107';
                        input.style.backgroundColor = '#fff3cd';
                    }
                }
            });
            
            const feedback = document.getElementById('storyCompletionFeedback');
            
            if (filled === inputs.length) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Excelente! Completaste el cuento (${correct}/${inputs.length} perfectas)
                    <br><strong>üè† En casa:</strong> Acepta respuestas creativas, no solo las "correctas"
                `;
                updateScore(15);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Completa todas las palabras (${filled}/${inputs.length} completadas)
                    <br><strong>üí° Tip:</strong> En casa, da pistas si tu hijo no sabe qu√© palabra va
                `;
            }
        }

        // FUNCIONES DE CANCIONES MEJORADAS

        function startSong3_1() {
            if (!checkAgeSelected()) return;
            
            const song = contentDatabase[3].songs[0];
            const songHTML = `
                <div class="game-container">
                    <div class="demo-label">üéµ DEMOSTRACI√ìN: T√©cnica de canci√≥n con n√∫meros</div>
                    <h3>üéµ ${song.title}</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa necesitar√°s:</h3>
                        <ul>
                            <li>Tu voz (no necesitas saber cantar bien)</li>
                            <li>Espacio para moverse</li>
                            <li>Paciencia para repetir muchas veces</li>
                        </ul>
                        <p><strong>Objetivo:</strong> Que memorice n√∫meros del 1 al 10 a trav√©s del ritmo y movimiento.</p>
                    </div>
                    
                    <div class="game-area" style="text-align: center;">
                        <div style="background: #f8f9fa; padding: 2rem; border-radius: 10px; margin: 2rem 0;">
                            <pre style="font-size: 1.2rem; line-height: 2; color: #333;">${song.lyrics}</pre>
                        </div>
                        <div style="background: #fff3cd; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <strong>üéº ${song.instructions}</strong>
                        </div>
                        <div style="margin: 2rem 0;">
                            <button class="btn btn-warning" onclick="playSongAnimation()">üé∂ Demostrar Canci√≥n</button>
                        </div>
                    </div>
                    <div class="feedback-box" id="songFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('song-3-1')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = songHTML;
            document.querySelector('[data-activity="song-3-1"]').parentElement.appendChild(container.firstElementChild);
        }

        function playSongAnimation() {
            const btn = event.target;
            const movements = [
                'üéµ Uno ü¶∂', 'üéµ Dos ü¶∂', 'üéµ Tres ü¶∂',
                'üéµ Cuatro ü¶ò', 'üéµ Cinco ü¶ò', 'üéµ Seis ü¶ò',
                'üéµ Siete üíÉ', 'üéµ Ocho üíÉ', 'üéµ Nueve üíÉ',
                'üéµ Diez üéâ'
            ];
            
            let count = 0;
            btn.disabled = true;
            
            const interval = setInterval(() => {
                btn.innerHTML = movements[count];
                count++;
                if (count >= movements.length) {
                    clearInterval(interval);
                    btn.innerHTML = 'üé∂ ¬°Canci√≥n Demostrada!';
                    btn.disabled = false;
                    updateScore(10);
                    
                    const feedback = document.getElementById('songFeedback');
                    feedback.className = 'feedback-box feedback-correct show';
                    feedback.innerHTML = `
                        ‚úÖ ¬°Perfecto! Has visto la t√©cnica completa
                        <br><strong>üè† En casa:</strong> Repite esta secuencia diariamente, empezando lento
                    `;
                    
                    setTimeout(() => {
                        btn.innerHTML = 'üé∂ Demostrar Canci√≥n';
                    }, 3000);
                }
            }, 800);
        }

        function startSong3_2() {
            if (!checkAgeSelected()) return;
            
            const song = contentDatabase[3].songs[1];
            const colors = ['rojo', 'azul', 'verde', 'amarillo'];
            
            const songHTML = `
                <div class="game-container">
                    <div class="demo-label">üåà DEMOSTRACI√ìN: T√©cnica de canci√≥n de colores</div>
                    <h3>üåà ${song.title}</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† Instrucciones para casa:</h3>
                        <p><strong>${song.instructions}</strong></p>
                        <p>Mientras cantas cada color, se√±ala objetos de ese color en tu casa.</p>
                    </div>
                    
                    <div class="game-area">
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; margin: 2rem 0;">üåà</div>
                            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                                <pre style="font-size: 1.1rem; line-height: 1.8; color: #333;">${song.lyrics}</pre>
                            </div>
                            <p style="font-size: 1.2rem;">Haz clic en cada color para demostrar:</p>
                            <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 1rem; margin: 2rem 0;">
                                ${colors.map(color => `
                                    <button class="interactive-element" onclick="singColor('${color}')" style="background: ${getColorHex(color)}; color: white;">
                                        ${color.toUpperCase()}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        <div id="colorSong" style="text-align: center; font-size: 1.5rem; margin: 2rem 0; min-height: 60px;"></div>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('song-3-2')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = songHTML;
            document.querySelector('[data-activity="song-3-2"]').parentElement.appendChild(container.firstElementChild);
        }

        function singColor(color) {
            const display = document.getElementById('colorSong');
            const colorExamples = {
                'rojo': ['tomate üçÖ', 'coraz√≥n ‚ù§Ô∏è', 'fresa üçì'],
                'azul': ['cielo üåå', 'agua üåä', 'mar üèñÔ∏è'],
                'verde': ['hierba üåø', '√°rbol üå≥', 'rana üê∏'],
                'amarillo': ['sol ‚òÄÔ∏è', 'pl√°tano üçå', 'flor üåª']
            };
            
            const examples = colorExamples[color];
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            
            display.innerHTML = `
                <div style="color: ${getColorHex(color)}; font-weight: bold;">
                    üéµ "${color.toUpperCase()} como ${randomExample}" üéµ
                </div>
                <div style="font-size: 0.9rem; margin-top: 0.5rem; color: #666;">
                    üè† En casa: Se√±ala objetos ${color}s mientras cantas
                </div>
            `;
            
            setTimeout(() => {
                display.innerHTML = '<div style="color: #999;">Haz clic en otro color para continuar la demostraci√≥n</div>';
            }, 3000);
            
            updateScore(2);
        }
        // JUEGOS PARA 4 A√ëOS - MEJORADOS

        // Constructor de Oraciones mejorado
        function startSentenceBuilder4() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('sentenceBuilder4').classList.remove('hidden');
            initializeSentenceBuilder();
        }

        function initializeSentenceBuilder() {
            const data = contentDatabase[4].sentences;
            
            // Crear una oraci√≥n objetivo basada en ejemplos reales
            const examples = data.examples;
            const targetExample = examples[Math.floor(Math.random() * examples.length)];
            const targetWords = targetExample.split(' ');
            
            window.targetSentence = targetExample;
            window.targetWords = targetWords;
            
            // Crear palabras adicionales como distractores
            const allWords = [
                ...targetWords,
                ...data.subjects.slice(0, 2),
                ...data.verbs.slice(0, 2),
                ...data.objects.slice(0, 2)
            ];
            
            // Eliminar duplicados y mezclar
            const uniqueWords = [...new Set(allWords)];
            const mixedWords = uniqueWords.sort(() => Math.random() - 0.5);
            
            const wordBank = document.getElementById('availableWords');
            wordBank.innerHTML = '';
            
            mixedWords.forEach((word, index) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'drag-item';
                wordDiv.draggable = true;
                wordDiv.textContent = word;
                wordDiv.id = `word-${index}`;
                wordDiv.ondragstart = (e) => dragStart(e);
                wordBank.appendChild(wordDiv);
            });
            
            const sentenceZone = document.getElementById('sentenceZone');
            sentenceZone.innerHTML = `
                <p style="color: #999;">Arrastra las palabras aqu√≠ para formar una oraci√≥n</p>
                <p style="font-size: 0.9rem; color: #667eea; margin-top: 0.5rem;">
                    <strong>üí° Objetivo:</strong> Formar una oraci√≥n que tenga sentido
                </p>
            `;
        }

        function checkSentence() {
            const sentenceZone = document.getElementById('sentenceZone');
            const draggedWords = Array.from(sentenceZone.querySelectorAll('.drag-item'));
            const formedSentence = draggedWords.map(el => el.textContent).join(' ');
            
            const feedback = document.getElementById('sentenceFeedback');
            
            if (draggedWords.length === 0) {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Arrastra palabras para formar una oraci√≥n
                    <br><strong>üè† En casa:</strong> Empezar con oraciones de 3 palabras: sujeto + verbo + objeto
                `;
                return;
            }
            
            // Verificar si tiene sentido b√°sico (sujeto + verbo m√≠nimo)
            const hasSubject = window.targetWords.some(word => 
                contentDatabase[4].sentences.subjects.some(subj => subj.includes(word))
            );
            const hasVerb = draggedWords.some(word => 
                contentDatabase[4].sentences.verbs.includes(word.textContent)
            );
            
            if (formedSentence === window.targetSentence) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Perfecto! Formaste la oraci√≥n correcta: "${formedSentence}"
                    <br><strong>üè† En casa:</strong> Celebra cuando forme oraciones completas y correctas
                `;
                updateScore(20);
            } else if (draggedWords.length >= 3 && hasVerb) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Muy bien! Tu oraci√≥n tiene sentido: "${formedSentence}"
                    <br><strong>üè† En casa:</strong> Acepta oraciones creativas que tengan sentido
                `;
                updateScore(15);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Intenta formar una oraci√≥n m√°s completa
                    <br><strong>üí° Ayuda:</strong> Una oraci√≥n necesita: alguien + hace algo
                    <br><strong>Ejemplo:</strong> "${window.targetSentence}"
                `;
            }
            
            setTimeout(() => {
                initializeSentenceBuilder();
                feedback.className = 'feedback-box';
            }, 4000);
        }

        function closeSentenceBuilder() {
            document.getElementById('sentenceBuilder4').classList.add('hidden');
            markActivityComplete('sentence-4');
        }

        // Juego de Preguntas mejorado
        function startQuestionGame4() {
            if (!checkAgeSelected()) return;
            
            const scenarios = [
                {
                    image: 'üèñÔ∏è',
                    text: 'La familia fue a la playa el domingo',
                    questions: [
                        { q: '¬øD√ìNDE fue la familia?', options: ['A la playa', 'Al parque', 'A casa'], correct: 0 },
                        { q: '¬øCU√ÅNDO fueron?', options: ['El lunes', 'El domingo', 'El martes'], correct: 1 },
                        { q: '¬øQUI√âN fue a la playa?', options: ['Los ni√±os', 'La familia', 'Los abuelos'], correct: 1 }
                    ]
                },
                {
                    image: 'üéÇ',
                    text: 'Mar√≠a celebr√≥ su cumplea√±os con una torta grande',
                    questions: [
                        { q: '¬øQU√â celebr√≥ Mar√≠a?', options: ['Su boda', 'Su cumplea√±os', 'Su graduaci√≥n'], correct: 1 },
                        { q: '¬øC√ìMO era la torta?', options: ['Peque√±a', 'Grande', 'Mediana'], correct: 1 },
                        { q: '¬øQUI√âN celebr√≥?', options: ['Mar√≠a', 'Juan', 'Ana'], correct: 0 }
                    ]
                }
            ];
            
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            
            const gameHTML = `
                <div class="game-container">
                    <div class="demo-label">‚ùì DEMOSTRACI√ìN: T√©cnica de preguntas de comprensi√≥n</div>
                    <h3>‚ùì ¬øQu√©? ¬øD√≥nde? ¬øCu√°ndo?</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa aplicar√°s esto:</h3>
                        <ul>
                            <li>Despu√©s de leer cualquier cuento o experiencia</li>
                            <li>Haz una pregunta a la vez</li>
                            <li>Espera respuesta completa, no solo una palabra</li>
                            <li>Si no responde, da opciones para elegir</li>
                        </ul>
                    </div>
                    
                    <div class="game-area">
                        <div style="text-align: center;">
                            <div style="font-size: 4rem; margin: 1rem;">${scenario.image}</div>
                            <p style="font-size: 1.2rem; background: #f8f9fa; padding: 1rem; border-radius: 10px;">${scenario.text}</p>
                        </div>
                        <div id="questionsContainer" style="margin: 2rem 0;">
                            ${scenario.questions.map((item, index) => `
                                <div class="quiz-question" style="margin: 1rem 0;">
                                    <p style="font-weight: bold; color: #667eea;">${item.q}</p>
                                    <div style="display: flex; gap: 1rem; margin: 1rem 0; flex-wrap: wrap;">
                                        ${item.options.map((opt, optIndex) => `
                                            <button class="btn btn-info" onclick="checkQuestionAnswer4('${opt}', ${optIndex}, ${item.correct}, ${index})">
                                                ${opt}
                                            </button>
                                        `).join('')}
                                    </div>
                                    <div id="feedback-${index}" class="feedback-box"></div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('questions-4')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="questions-4"]').parentElement.appendChild(container.firstElementChild);
        }

        function checkQuestionAnswer4(answer, selectedIndex, correctIndex, questionIndex) {
            const feedback = document.getElementById(`feedback-${questionIndex}`);
            
            if (selectedIndex === correctIndex) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Correcto! La respuesta es "${answer}"
                    <br><strong>üè† En casa:</strong> Celebra las respuestas correctas y pide que repita la oraci√≥n completa
                `;
                updateScore(10);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Intenta otra vez. Lee la oraci√≥n con atenci√≥n
                    <br><strong>üí° Ayuda:</strong> Busca la informaci√≥n en el texto
                `;
            }
        }

        // Juego de Secuencias mejorado
        function startSequenceGame4() {
            if (!checkAgeSelected()) return;
            
            const sequences = [
                {
                    title: "Rutina de la ma√±ana de Mar√≠a",
                    items: [
                        {text: "üõèÔ∏è Se levanta", order: 1},
                        {text: "ü™• Se lava los dientes", order: 2},
                        {text: "üç≥ Desayuna", order: 3},
                        {text: "üéí Va a la escuela", order: 4}
                    ]
                },
                {
                    title: "C√≥mo hacer un s√°ndwich",
                    items: [
                        {text: "üçû Toma el pan", order: 1},
                        {text: "üßà Pone mantequilla", order: 2},
                        {text: "üßÄ Agrega queso", order: 3},
                        {text: "ü•™ Cierra el s√°ndwich", order: 4}
                    ]
                }
            ];
            
            const sequence = sequences[Math.floor(Math.random() * sequences.length)];
            
            const gameHTML = `
                <div class="game-container">
                    <div class="demo-label">üìÖ DEMOSTRACI√ìN: T√©cnica de secuencias temporales</div>
                    <h3>üìÖ Ordena la Secuencia</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† En casa aplicar√°s esto:</h3>
                        <ul>
                            <li>Con actividades diarias: vestirse, ba√±arse, cocinar</li>
                            <li>Usa palabras clave: "primero", "despu√©s", "luego", "al final"</li>
                            <li>Act√∫a la secuencia mientras la ordena</li>
                            <li>Pregunta: "¬øQu√© hacemos primero?"</li>
                        </ul>
                    </div>
                    
                    <div class="game-area">
                        <p style="font-size: 1.2rem; font-weight: bold; text-align: center;">${sequence.title}</p>
                        <div style="background: #fff3cd; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <strong>üí° Instrucciones:</strong> Arrastra los elementos en el orden correcto (de 1 a 4)
                        </div>
                        <div id="sequenceItems" style="margin: 2rem 0; display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;">
                            ${sequence.items.sort(() => Math.random() - 0.5).map((item, index) => `
                                <div class="drag-item" draggable="true" data-order="${item.order}" id="seq-item-${index}" style="background: #f8f9fa;">
                                    ${item.text}
                                </div>
                            `).join('')}
                        </div>
                        <div class="drop-zone" id="sequenceZone" style="min-height: 120px;">
                            <p>Arrastra aqu√≠ en el orden correcto</p>
                        </div>
                        <button class="btn btn-success" onclick="checkSequence4()">Verificar Orden</button>
                    </div>
                    <div class="feedback-box" id="sequenceFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('sequence-4')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="sequence-4"]').parentElement.appendChild(container.firstElementChild);
            
            // Inicializar drag and drop para esta actividad
            initializeSequenceDrag4();
        }

        function initializeSequenceDrag4() {
            const items = document.querySelectorAll('#sequenceItems .drag-item');
            const zone = document.getElementById('sequenceZone');
            
            items.forEach(item => {
                item.addEventListener('dragstart', dragStart);
            });
            
            zone.addEventListener('dragover', dragOver);
            zone.addEventListener('drop', drop);
        }

        function checkSequence4() {
            const zone = document.getElementById('sequenceZone');
            const items = Array.from(zone.querySelectorAll('.drag-item'));
            const feedback = document.getElementById('sequenceFeedback');
            
            if (items.length !== 4) {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Arrastra todas las actividades (${items.length}/4)
                    <br><strong>üè† En casa:</strong> Aseg√∫rate de que complete toda la secuencia
                `;
                return;
            }
            
            const order = items.map(item => parseInt(item.dataset.order));
            const isCorrect = order.every((val, index) => val === index + 1);
            
            if (isCorrect) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Perfecto! Has ordenado correctamente la secuencia
                    <br><strong>üè† En casa:</strong> Usa palabras como "primero", "despu√©s", "luego" mientras ordenan
                `;
                updateScore(20);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå El orden no es correcto. Piensa: ¬øqu√© se hace primero?
                    <br><strong>üí° Ayuda:</strong> Orden correcto: ${order.map((_, i) => i + 1).join(' ‚Üí ')}
                `;
            }
        }

        // Comprensi√≥n de cuentos mejorada
        function startComprehensionStory4() {
            if (!checkAgeSelected()) return;
            
            const storyData = contentDatabase[4].comprehension;
            
            const storyHTML = `
                <div class="game-container">
                    <div class="demo-label">üìö DEMOSTRACI√ìN: T√©cnica de lectura con comprensi√≥n</div>
                    <h3>ü¶Å El Le√≥n y el Rat√≥n</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† T√©cnica para aplicar con cualquier cuento:</h3>
                        <ul>
                            <li>Lee con expresi√≥n, cambiando voces</li>
                            <li>Pausa al final de cada p√°rrafo importante</li>
                            <li>Haz preguntas durante la lectura</li>
                            <li>Pide que prediga qu√© pasar√° despu√©s</li>
                            <li>Al final, que te cuente la historia con sus palabras</li>
                        </ul>
                    </div>
                    
                    <div class="game-area">
                        <div style="background: #f8f9fa; padding: 2rem; border-radius: 10px; line-height: 1.8;">
                            <p style="font-size: 1.1rem;">${storyData.story}</p>
                        </div>
                        <div style="background: #e7f3ff; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <strong>üìñ En casa:</strong> Despu√©s de leer, pregunta: "¬øQu√© aprendemos de esta historia?"
                        </div>
                    </div>
                    <button class="btn btn-warning" onclick="startComprehensionQuiz4()">Practicar Preguntas</button>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('comp-story-4')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = storyHTML;
            document.querySelector('[data-activity="comp-story-4"]').parentElement.appendChild(container.firstElementChild);
        }

        function startComprehensionQuiz4() {
            document.getElementById('comprehensionQuiz4').classList.remove('hidden');
            currentQuizQuestion = 0;
            loadQuizQuestion4();
        }

        function loadQuizQuestion4() {
            const questions = contentDatabase[4].comprehension.questions;
            
            if (currentQuizQuestion < questions.length) {
                const q = questions[currentQuizQuestion];
                document.getElementById('quizQuestion').innerHTML = `
                    <strong>Pregunta ${currentQuizQuestion + 1} de ${questions.length}:</strong><br>
                    ${q.question}
                `;
                
                const optionsHTML = q.options.map((opt, idx) => `
                    <div class="quiz-option" onclick="checkQuizAnswer4(${idx}, ${q.correct}, '${q.explanation}')">
                        ${opt}
                    </div>
                `).join('');
                
                document.getElementById('quizOptions').innerHTML = optionsHTML;
                document.getElementById('quizFeedback').className = 'feedback-box';
            }
        }

        function checkQuizAnswer4(selected, correct, explanation) {
            const feedback = document.getElementById('quizFeedback');
            
            if (selected === correct) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°Correcto! ${explanation}
                    <br><strong>üè† En casa:</strong> Explica por qu√© es correcta la respuesta
                `;
                updateScore(10);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Intenta otra vez. Piensa en lo que le√≠mos
                    <br><strong>üí° Ayuda:</strong> Vuelve a leer la parte importante del cuento
                `;
            }
        }

        function nextQuizQuestion() {
            currentQuizQuestion++;
            if (currentQuizQuestion >= contentDatabase[4].comprehension.questions.length) {
                closeQuiz();
                showNotification('üéâ ¬°Excelente! Dominas la t√©cnica de comprensi√≥n lectora', 'success');
            } else {
                loadQuizQuestion4();
            }
        }

        function closeQuiz() {
            document.getElementById('comprehensionQuiz4').classList.add('hidden');
        }

        // Juegos de rimas mejorados
        function startRhymeGame4() {
            if (!checkAgeSelected()) return;
            
            const rhymes = contentDatabase[4].rhymes.words;
            const currentRhyme = rhymes[Math.floor(Math.random() * rhymes.length)];
            
            const gameHTML = `
                <div class="game-container">
                    <div class="demo-label">üé™ DEMOSTRACI√ìN: T√©cnica de identificaci√≥n de rimas</div>
                    <h3>üé™ Encuentra la Rima</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† C√≥mo ense√±ar rimas en casa:</h3>
                        <ul>
                            <li>Exagera el sonido final: "ga-TO, pa-TO"</li>
                            <li>Usa objetos reales cuando sea posible</li>
                            <li>Inventa rimas absurdas para divertirse</li>
                            <li>Canta las rimas para que sea m√°s f√°cil</li>
                            <li>Acepta intentos creativos aunque no sean perfectos</li>
                        </ul>
                    </div>
                    
                    <div class="game-area">
                        <div style="text-align: center;">
                            <p style="font-size: 2rem; margin: 2rem 0; background: #f8f9fa; padding: 1rem; border-radius: 10px;">
                                Encuentra palabras que rimen con: <strong style="color: #f093fb;">${currentRhyme.word}</strong>
                            </p>
                            <div style="background: #fff3cd; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                                <strong>üí° Pista:</strong> Busca palabras que terminen con el mismo sonido
                            </div>
                            <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin: 2rem 0;">
                                ${[...currentRhyme.rhymes, ...currentRhyme.nonRhymes].sort(() => Math.random() - 0.5).map(word => `
                                    <button class="interactive-element" onclick="checkRhyme4('${word}', '${currentRhyme.word}', ${currentRhyme.rhymes.includes(word)})">
                                        ${word}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="feedback-box" id="rhymeFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('rhyme-4')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="rhyme-4"]').parentElement.appendChild(container.firstElementChild);
        }

        function checkRhyme4(word, baseWord, isRhyme) {
            const feedback = document.getElementById('rhymeFeedback');
            
            if (isRhyme) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `
                    ‚úÖ ¬°S√≠! "${word}" rima con "${baseWord}" porque terminan igual
                    <br><strong>üè† En casa:</strong> D√≠: "${baseWord}, ${word}" exagerando el final
                `;
                updateScore(10);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå "${word}" no rima con "${baseWord}". Escucha: "${baseWord}" vs "${word}"
                    <br><strong>üí° Ayuda:</strong> Las rimas suenan parecido al final
                `;
            }
        }

        // Trabalenguas mejorados
        function startTongueTwister4() {
            if (!checkAgeSelected()) return;
            
            const twisters = contentDatabase[4].tongueTwisters;
            
            const gameHTML = `
                <div class="game-container">
                    <div class="demo-label">üëÖ DEMOSTRACI√ìN: T√©cnica de trabalenguas</div>
                    <h3>üëÖ Trabalenguas F√°ciles</h3>
                    
                    <div class="educational-context" style="margin: 1rem 0;">
                        <h3>üè† Progresi√≥n para ense√±ar trabalenguas:</h3>
                        <ol>
                            <li><strong>Muy lento:</strong> Separa cada s√≠laba</li>
                            <li><strong>Con palmas:</strong> Aplaude en cada s√≠laba</li>
                            <li><strong>Normal:</strong> Velocidad de conversaci√≥n</li>
                            <li><strong>R√°pido:</strong> Solo cuando domine el lento</li>
                            <li><strong>Divertido:</strong> R√≠anse de los errores juntos</li>
                        </ol>
                    </div>
                    
                    <div class="game-area">
                        <div style="text-align: center;">
                            ${twisters.map((twister, idx) => `
                                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                                    <p style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">${twister.text}</p>
                                    <div style="background: #e7f3ff; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                                        <strong>üéØ T√©cnica:</strong> ${twister.instruction}
                                    </div>
                                    <button class="btn btn-info" onclick="practiceTwister4(${idx}, '${twister.text}')">
                                        üé§ Demostrar T√©cnica
                                    </button>
                                    <div id="twister-demo-${idx}" style="margin-top: 1rem; min-height: 40px;"></div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('tongue-4')">Entend√≠ la T√©cnica</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="tongue-4"]').parentElement.appendChild(container.firstElementChild);
        }

        function practiceTwister4(index, text) {
            const demoArea = document.getElementById(`twister-demo-${index}`);
            const words = text.split(' ');
            
            demoArea.innerHTML = `
                <div style="background: #fff3cd; padding: 1rem; border-radius: 8px;">
                    <strong>üêå Demostraci√≥n lenta:</strong>
                    <div id="slow-demo-${index}" style="font-size: 1.2rem; margin: 0.5rem 0;"></div>
                </div>
            `;
            
            const slowDemo = document.getElementById(`slow-demo-${index}`);
            let wordIndex = 0;
            
            const interval = setInterval(() => {
                if (wordIndex < words.length) {
                    slowDemo.innerHTML += `<span style="color: #f093fb; font-weight: bold;">${words[wordIndex]}</span> `;
                    wordIndex++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        demoArea.innerHTML += `
                            <div style="background: #d4edda; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                                ‚úÖ <strong>üè† En casa:</strong> Empezar siempre as√≠ de lento, aumentar velocidad gradualmente
                            </div>
                        `;
                        updateScore(10);
                    }, 1000);
                }
            }, 800);
        }

        // FUNCIONES PARA 5 A√ëOS - AVANZADAS

        // Creador de historias mejorado
        function startStoryCreator5() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('storyCreator5').classList.remove('hidden');
            initializeStoryCreator();
        }

        function initializeStoryCreator() {
            const elements = contentDatabase[5].storyElements;
            
            const imageBank = document.getElementById('imageBank');
            imageBank.innerHTML = '';
            
            // Crear elementos por categor√≠as
            const categories = [
                {name: 'Personajes', items: elements.characters, color: '#ff6b6b'},
                {name: 'Lugares', items: elements.settings, color: '#4ecdc4'},
                {name: 'Problemas', items: elements.problems, color: '#ffe66d'},
                {name: 'Soluciones', items: elements.solutions, color: '#95e1d3'}
            ];
            
            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.style.margin = '1rem 0';
                categoryDiv.innerHTML = `
                    <h4 style="color: ${category.color}; margin-bottom: 0.5rem;">${category.name}:</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        ${category.items.map((item, index) => {
                            const emoji = typeof item === 'object' ? item.emoji : 'üìù';
                            const text = typeof item === 'object' ? item.name : item;
                            const desc = typeof item === 'object' ? item.description : '';
                            
                            return `
                                <div class="drag-item" draggable="true" 
                                     id="story-element-${category.name}-${index}"
                                     data-element="${text}" 
                                     data-description="${desc}"
                                     title="${text}${desc ? ': ' + desc : ''}"
                                     style="background: ${category.color}; color: white;">
                                    ${emoji} ${text}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                imageBank.appendChild(categoryDiv);
            });
            
            // Configurar drag and drop
            document.querySelectorAll('.drag-item').forEach(item => {
                item.ondragstart = dragStart;
            });
            
            // Limpiar zonas
            ['storyBeginning', 'storyMiddle', 'storyEnd'].forEach(id => {
                const zone = document.getElementById(id);
                zone.innerHTML = 'Arrastra una imagen aqu√≠';
                zone.ondragover = dragOver;
                zone.ondrop = drop;
            });
        }
        function tellStory() {
            const beginning = document.getElementById('storyBeginning').querySelector('.drag-item');
            const middle = document.getElementById('storyMiddle').querySelector('.drag-item');
            const end = document.getElementById('storyEnd').querySelector('.drag-item');
            
            const feedback = document.getElementById('storyFeedback');
            
            if (!beginning || !middle || !end) {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `
                    ‚ùå Completa todas las partes de la historia
                    <br><strong>üè† En casa:</strong> Si falta inspiraci√≥n, ayuda con preguntas: "¬øQu√© pas√≥ despu√©s?"
                `;
                return;
            }
            
            const story = `
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; line-height: 1.8;">
                    <h4>üìñ Tu historia:</h4>
                    <p><strong>Hab√≠a una vez</strong> ${beginning.dataset.element} ${beginning.dataset.description ? '(' + beginning.dataset.description + ')' : ''}.</p>
                    <p><strong>Un d√≠a,</strong> ${middle.dataset.element}.</p>
                    <p><strong>Al final,</strong> ${end.dataset.element}.</p>
                    <p><strong>Y todos fueron felices para siempre.</strong></p>
                </div>
                <div style="background: #d4edda; padding: 1rem; border-radius: 10px; margin-top: 1rem;">
                    <strong>üè† En casa:</strong> Pide que cuente la historia con sus propias palabras y a√±ada m√°s detalles
                </div>
            `;
            
            feedback.className = 'feedback-box feedback-correct show';
            feedback.innerHTML = `‚úÖ ¬°Qu√© historia tan creativa!<br>${story}`;
            updateScore(25);
            
            markActivityComplete('create-story-5');
        }

        function closeStoryCreator() {
            document.getElementById('storyCreator5').classList.add('hidden');
        }

        // Otras funciones de 5 a√±os (simplificadas por espacio)
        function startDescriptionGame5() {
            // Funci√≥n ya implementada en partes anteriores
        }

        function startDialogGame5() {
            // Funci√≥n ya implementada en partes anteriores
        }

        function startCategoryGame5() {
            // Funci√≥n ya implementada en partes anteriores
        }

        function startOppositeGame5() {
            // Funci√≥n ya implementada en partes anteriores
        }

        function startAnalogiesGame5() {
            // Funci√≥n ya implementada en partes anteriores
        }

        function startRolePlay5() {
            // Funci√≥n ya implementada en partes anteriores
        }

        function startEmotionsGame5() {
            // Funci√≥n ya implementada en partes anteriores
        }

        // SISTEMA DE UTILIDADES MEJORADO

        function initializeDragAndDrop() {
            // Configuraci√≥n global de drag and drop
            document.addEventListener('DOMContentLoaded', () => {
                console.log('üîß Sistema de drag and drop inicializado');
            });
        }

        function dragStart(e) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
            e.dataTransfer.setData('elementId', e.target.id);
            e.target.classList.add('dragging');
            
            // Guardar datos del elemento
            e.dataTransfer.setData('element', e.target.dataset.element || e.target.textContent);
            e.dataTransfer.setData('description', e.target.dataset.description || '');
        }

        function dragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
            return false;
        }

        function drop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.preventDefault();
            
            const elementHtml = e.dataTransfer.getData('text/html');
            const element = e.dataTransfer.getData('element');
            const description = e.dataTransfer.getData('description');
            
            if (e.currentTarget.classList.contains('drop-zone')) {
                e.currentTarget.innerHTML = elementHtml;
                
                // Restaurar datos si es necesario
                const droppedElement = e.currentTarget.querySelector('.drag-item');
                if (droppedElement) {
                    droppedElement.dataset.element = element;
                    droppedElement.dataset.description = description;
                }
            }
            
            e.currentTarget.classList.remove('drag-over');
            
            // Remover clase dragging
            const dragging = document.querySelector('.dragging');
            if (dragging) {
                dragging.classList.remove('dragging');
            }
            
            return false;
        }

        function checkAgeSelected() {
            if (!selectedAge) {
                showNotification('‚ö†Ô∏è Por favor, selecciona primero la edad de tu hijo para ver actividades apropiadas', 'warning');
                return false;
            }
            return true;
        }

        function markActivityComplete(activityId) {
            const card = document.querySelector(`[data-activity="${activityId}"]`);
            if (card && !card.classList.contains('completed')) {
                card.classList.add('completed');
                completedActivities.add(activityId);
                updateProgress();
                checkAchievements();
                saveProgress();
                
                showNotification(`‚úÖ Actividad completada: ${card.querySelector('.activity-title').textContent}`, 'success');
            }
        }

        function updateScore(points) {
            currentScore += points;
            showNotification(`+${points} puntos`, 'success', 2000);
        }

        function updateProgress() {
            const progress = (completedActivities.size / totalActivities) * 100;
            
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const activitiesText = document.getElementById('activitiesCompleted');
            
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
            if (progressText) {
                progressText.textContent = Math.round(progress) + '% completado';
            }
            if (activitiesText) {
                activitiesText.textContent = `${completedActivities.size} de ${totalActivities} actividades`;
            }
            
            // Habilitar evaluaci√≥n final si se completaron suficientes actividades
            if (completedActivities.size >= Math.min(8, totalActivities - 2)) {
                const finalBtn = document.getElementById('finalQuizBtn');
                if (finalBtn) {
                    finalBtn.disabled = false;
                    finalBtn.textContent = 'üèÜ Comenzar Evaluaci√≥n Final (Desbloqueado)';
                }
            }
            
            // Completar m√≥dulo si todas las actividades est√°n hechas
            if (completedActivities.size >= totalActivities) {
                completeModule();
            }
        }

        function checkAchievements() {
            const completed = completedActivities.size;
            
            // Primera actividad
            if (completed >= 1 && !achievements.has('first')) {
                achievements.add('first');
                document.getElementById('badge1').classList.add('unlocked');
                showNotification('üéØ ¬°Logro desbloqueado: Primera Actividad!', 'success');
            }
            
            // 5 Juegos
            if (completed >= 5 && !achievements.has('games')) {
                achievements.add('games');
                document.getElementById('badge2').classList.add('unlocked');
                showNotification('üéÆ ¬°Logro desbloqueado: 5 Juegos Completados!', 'success');
            }
            
            // Maestro Musical (completar actividades de canciones)
            const songActivities = ['song-3-1', 'song-3-2'];
            const songsCompleted = songActivities.filter(act => completedActivities.has(act)).length;
            if (songsCompleted >= 1 && !achievements.has('music')) {
                achievements.add('music');
                document.getElementById('badge3').classList.add('unlocked');
                showNotification('üéµ ¬°Logro desbloqueado: Maestro Musical!', 'success');
            }
            
            // Contador de Cuentos (completar actividades de cuentos)
            const storyActivities = ['story-3-1', 'story-3-2', 'comp-story-4', 'create-story-5'];
            const storiesCompleted = storyActivities.filter(act => completedActivities.has(act)).length;
            if (storiesCompleted >= 2 && !achievements.has('stories')) {
                achievements.add('stories');
                document.getElementById('badge4').classList.add('unlocked');
                showNotification('üìö ¬°Logro desbloqueado: Contador de Cuentos!', 'success');
            }
            
            // M√≥dulo Completo
            if (completed >= totalActivities && !achievements.has('complete')) {
                achievements.add('complete');
                document.getElementById('badge5').classList.add('unlocked');
                showNotification('üèÜ ¬°Logro desbloqueado: M√≥dulo Completo!', 'success');
            }
        }

        // EVALUACI√ìN FINAL MEJORADA

        function startFinalQuiz() {
            if (!checkAgeSelected()) {
                showNotification('‚ö†Ô∏è Selecciona la edad de tu hijo primero', 'warning');
                return;
            }
            
            const minActivities = Math.min(8, totalActivities - 2);
            if (completedActivities.size < minActivities) {
                showNotification(`‚ö†Ô∏è Completa al menos ${minActivities} actividades primero`, 'warning');
                return;
            }
            
            document.getElementById('finalQuizContainer').classList.remove('hidden');
            initializeFinalQuiz();
            startQuizTimer();
        }

        function initializeFinalQuiz() {
            const questions = getFinalQuizQuestions();
            window.finalQuizQuestions = questions;
            window.finalQuizAnswers = [];
            window.currentFinalQuestion = 0;
            
            loadFinalQuestion();
        }

        function getFinalQuizQuestions() {
            const questions = {
                3: [
                    {
                        question: "¬øCu√°l es la mejor manera de ense√±ar colores a un ni√±o de 3 a√±os?",
                        options: ["Solo con libros", "Con objetos reales y juego", "Memorizando listas", "Viendo TV"],
                        correct: 1,
                        explanation: "Los ni√±os de 3 a√±os aprenden mejor con objetos reales y participaci√≥n activa"
                    },
                    {
                        question: "¬øC√≥mo debe hacer un padre el sonido 'MUU' de la vaca?",
                        options: ["Muy bajito", "Normal", "Exagerado y claro", "No importa c√≥mo"],
                        correct: 2,
                        explanation: "Los sonidos exagerados ayudan a los ni√±os a distinguir y reproducir mejor los sonidos"
                    },
                    {
                        question: "En el juego 'Sim√≥n dice', ¬øqu√© debe hacer el padre si el ni√±o no toca la parte correcta?",
                        options: ["Corregirlo inmediatamente", "Ayudarlo f√≠sicamente", "Ignorarlo", "Rega√±arlo"],
                        correct: 1,
                        explanation: "A los 3 a√±os necesitan gu√≠a f√≠sica suave para aprender"
                    },
                    {
                        question: "¬øCu√°ntos alimentos debe seleccionar un ni√±o para una merienda saludable?",
                        options: ["Todos los que quiera", "M√°ximo 3", "Solo 1", "M√≠nimo 5"],
                        correct: 1,
                        explanation: "3 alimentos es una cantidad apropiada para ense√±ar moderaci√≥n y variedad"
                    }
                ],
                4: [
                    {
                        question: "¬øCu√°l es la estructura b√°sica que debe tener una oraci√≥n para ni√±os de 4 a√±os?",
                        options: ["Solo verbo", "Sujeto + verbo + objeto", "Muy complicada", "No importa"],
                        correct: 1,
                        explanation: "La estructura sujeto-verbo-objeto es la base del lenguaje a los 4 a√±os"
                    },
                    {
                        question: "Al leer un cuento, ¬øcu√°ndo debe hacer preguntas de comprensi√≥n?",
                        options: ["Al final solamente", "Durante la lectura", "Nunca", "Antes de empezar"],
                        correct: 1,
                        explanation: "Las preguntas durante la lectura mantienen la atenci√≥n y verifican comprensi√≥n"
                    },
                    {
                        question: "Para ense√±ar secuencias, ¬øqu√© palabras clave debe usar?",
                        options: ["Cualquiera", "Primero, despu√©s, luego", "Solo n√∫meros", "No usar palabras"],
                        correct: 1,
                        explanation: "Estas palabras temporales ayudan a organizar el pensamiento secuencial"
                    },
                    {
                        question: "¬øC√≥mo debe ense√±ar trabalenguas a un ni√±o de 4 a√±os?",
                        options: ["Muy r√°pido", "S√∫per lento primero", "Gritando", "Una sola vez"],
                        correct: 1,
                        explanation: "Empezar lento permite que el ni√±o procese cada sonido correctamente"
                    }
                ],
                5: [
                    {
                        question: "¬øCu√°l es la estructura narrativa que debe ense√±ar a un ni√±o de 5 a√±os?",
                        options: ["Solo final", "Inicio-problema-soluci√≥n-final", "Sin estructura", "Solo personajes"],
                        correct: 1,
                        explanation: "Esta estructura desarrolla pensamiento l√≥gico y habilidades narrativas"
                    },
                    {
                        question: "Al hacer juegos de categor√≠as, ¬øqu√© debe hacer si el ni√±o se equivoca?",
                        options: ["Corregir y explicar", "Ignorar", "Rega√±ar", "Cambiar de juego"],
                        correct: 0,
                        explanation: "Explicar el criterio de clasificaci√≥n ayuda al aprendizaje"
                    },
                    {
                        question: "¬øCu√°l es la mejor manera de ense√±ar opuestos?",
                        options: ["Solo memorizando", "Con experiencias reales", "Con castigos", "No ense√±ar"],
                        correct: 1,
                        explanation: "Las experiencias f√≠sicas y reales hacen que los conceptos sean m√°s claros"
                    },
                    {
                        question: "En el juego de roles, ¬øqu√© debe hacer el padre?",
                        options: ["Solo observar", "Participar y guiar", "Criticar", "Hacer todo √©l"],
                        correct: 1,
                        explanation: "La participaci√≥n guiada desarrolla habilidades sociales y vocabulario"
                    }
                ]
            };
            
            return questions[selectedAge] || questions[3];
        }

        function loadFinalQuestion() {
            const question = window.finalQuizQuestions[window.currentFinalQuestion];
            const container = document.getElementById('finalQuestion');
            
            container.innerHTML = `
                <p style="font-size: 1.2rem; font-weight: bold; margin-bottom: 1rem;">
                    Pregunta ${window.currentFinalQuestion + 1} de ${window.finalQuizQuestions.length}
                </p>
                <p style="font-size: 1.1rem; margin: 1rem 0; background: #f8f9fa; padding: 1rem; border-radius: 10px;">
                    ${question.question}
                </p>
                <div class="quiz-options">
                    ${question.options.map((opt, idx) => `
                        <div class="quiz-option" onclick="selectFinalAnswer(${idx})">
                            ${opt}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function selectFinalAnswer(index) {
            // Guardar respuesta
            window.finalQuizAnswers[window.currentFinalQuestion] = index;
            
            // Marcar opci√≥n seleccionada y mostrar feedback inmediato
            const options = document.querySelectorAll('.quiz-option');
            const question = window.finalQuizQuestions[window.currentFinalQuestion];
            
            options.forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
            
            if (index === question.correct) {
                options[index].classList.add('correct');
                options[index].innerHTML += ' ‚úÖ';
            } else {
                options[index].classList.add('incorrect');
                options[index].innerHTML += ' ‚ùå';
                options[question.correct].classList.add('correct');
                options[question.correct].innerHTML += ' ‚úÖ (Correcto)';
            }
            
            // Mostrar explicaci√≥n
            const explanation = document.createElement('div');
            explanation.style.cssText = 'background: #e7f3ff; padding: 1rem; border-radius: 8px; margin: 1rem 0;';
            explanation.innerHTML = `<strong>üí° Explicaci√≥n:</strong> ${question.explanation}`;
            document.getElementById('finalQuestion').appendChild(explanation);
            
            // Avanzar autom√°ticamente despu√©s de 3 segundos
            setTimeout(() => {
                window.currentFinalQuestion++;
                if (window.currentFinalQuestion < window.finalQuizQuestions.length) {
                    loadFinalQuestion();
                } else {
                    submitFinalQuiz();
                }
            }, 3000);
        }

        function startQuizTimer() {
            let timeLeft = 300; // 5 minutos
            
            quizTimer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                const display = document.getElementById('quizTimer');
                if (display) {
                    display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Cambiar color cuando quede poco tiempo
                    if (timeLeft <= 60) {
                        display.style.color = '#dc3545';
                    }
                }
                
                if (timeLeft <= 0) {
                    clearInterval(quizTimer);
                    submitFinalQuiz();
                }
            }, 1000);
        }

        function submitFinalQuiz() {
            clearInterval(quizTimer);
            
            // Calcular puntuaci√≥n
            let correct = 0;
            window.finalQuizQuestions.forEach((q, idx) => {
                if (window.finalQuizAnswers[idx] === q.correct) {
                    correct++;
                }
            });
            
            const percentage = (correct / window.finalQuizQuestions.length) * 100;
            
            const feedback = document.getElementById('finalFeedback');
            feedback.className = 'feedback-box show';
            
            if (percentage >= 80) {
                feedback.classList.add('feedback-correct');
                feedback.innerHTML = `
                    <h3>üéâ ¬°EXCELENTE!</h3>
                    <p><strong>Puntuaci√≥n:</strong> ${correct}/${window.finalQuizQuestions.length} (${Math.round(percentage)}%)</p>
                    <p>Has dominado las t√©cnicas de estimulaci√≥n del lenguaje para ${selectedAge} a√±os.</p>
                    <p><strong>üè† Est√°s listo para aplicar estas t√©cnicas en casa con confianza.</strong></p>
                `;
                completeModule();
            } else if (percentage >= 60) {
                feedback.classList.add('feedback-correct');
                feedback.innerHTML = `
                    <h3>üëç ¬°Muy Bien!</h3>
                    <p><strong>Puntuaci√≥n:</strong> ${correct}/${window.finalQuizQuestions.length} (${Math.round(percentage)}%)</p>
                    <p>Buen trabajo. Repasa las t√©cnicas que m√°s te costaron.</p>
                    <p><strong>üí° Puedes empezar a aplicar lo aprendido, pero revisa el material ocasionalmente.</strong></p>
                `;
            } else {
                feedback.classList.add('feedback-incorrect');
                feedback.innerHTML = `
                    <h3>üìö Necesitas Repasar</h3>
                    <p><strong>Puntuaci√≥n:</strong> ${correct}/${window.finalQuizQuestions.length} (${Math.round(percentage)}%)</p>
                    <p>Te recomendamos repasar las actividades antes de continuar.</p>
                    <p><strong>üîÑ Practica m√°s las t√©cnicas y vuelve a intentar la evaluaci√≥n.</strong></p>
                `;
            }
            
            // Ocultar el contenedor del quiz
            setTimeout(() => {
                document.getElementById('finalQuizContainer').innerHTML = feedback.outerHTML;
            }, 1000);
        }

        // FUNCIONES DE SISTEMA FINALES

        function completeModule() {
            // Mostrar botones de navegaci√≥n
            document.getElementById('certificateBtn').style.display = 'inline-block';
            document.getElementById('nextModuleBtn').style.display = 'inline-block';
            
            // Actualizar progreso del curso
            let courseProgress = JSON.parse(localStorage.getItem('courseProgress') || '[false,false,false,false,false]');
            courseProgress[2] = true; // M√≥dulo 3 completado
            localStorage.setItem('courseProgress', JSON.stringify(courseProgress));
            
            // Logro final
            if (!achievements.has('complete')) {
                achievements.add('complete');
                document.getElementById('badge5').classList.add('unlocked');
            }
            
            showNotification('üéâ ¬°FELICITACIONES! Has completado el M√≥dulo 3', 'success', 10000);
            
            setTimeout(() => {
                alert(`
üèÜ ¬°M√≥dulo 3 Completado!

‚úÖ Has dominado ${completedActivities.size} t√©cnicas de estimulaci√≥n
‚úÖ Conoces actividades para ${selectedAge} a√±os
‚úÖ Puedes crear juegos educativos personalizados
‚úÖ Sabes c√≥mo usar cuentos, canciones y rutinas diarias

üè† ¬°Ahora puedes aplicar todo esto en casa con tu hijo!

¬°Contin√∫a al M√≥dulo 4 para aprender a identificar dificultades!
                `);
            }, 2000);
        }

        function generateCertificate() {
            const userName = prompt('¬øCu√°l es tu nombre para el certificado?') || 'Estudiante';
            const currentDate = new Date().toLocaleDateString('es-ES');
            
            const certificate = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                                ‚ïë
‚ïë         üèÜ CERTIFICADO DE ESPECIALIZACI√ìN üèÜ                   ‚ïë
‚ïë                                                                ‚ïë
‚ïë      ESTIMULACI√ìN DEL LENGUAJE INFANTIL - M√ìDULO 3            ‚ïë
‚ïë                                                                ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                                ‚ïë
‚ïë  Certificamos que:                                             ‚ïë
‚ïë                                                                ‚ïë
‚ïë            ${userName.toUpperCase().padEnd(48, ' ')}           ‚ïë
‚ïë                                                                ‚ïë
‚ïë  Ha completado exitosamente el M√ìDULO 3:                      ‚ïë
‚ïë                                                                ‚ïë
‚ïë        "ACTIVIDADES Y JUEGOS PARA EL HOGAR"                   ‚ïë
‚ïë                                                                ‚ïë
‚ïë  Competencias Profesionales Adquiridas:                       ‚ïë
‚ïë  ‚úÖ T√©cnicas de juegos de vocabulario por edades              ‚ïë
‚ïë  ‚úÖ Metodolog√≠a de cuentos interactivos                       ‚ïë
‚ïë  ‚úÖ Creaci√≥n de canciones educativas                          ‚ïë
‚ïë  ‚úÖ Transformaci√≥n de rutinas en oportunidades de aprendizaje ‚ïë
‚ïë  ‚úÖ Estimulaci√≥n de creatividad y narrativa                   ‚ïë
‚ïë  ‚úÖ T√©cnicas de comprensi√≥n lectora infantil                  ‚ïë
‚ïë  ‚úÖ Desarrollo de conciencia fonol√≥gica                       ‚ïë
‚ïë                                                                ‚ïë
‚ïë  Especializaci√≥n: Ni√±os de ${(selectedAge ? selectedAge + ' a√±os' : 'todas las edades').padEnd(33, ' ')}‚ïë
‚ïë  Actividades dominadas: ${completedActivities.size.toString().padEnd(35, ' ')}‚ïë
‚ïë  Puntuaci√≥n total: ${currentScore.toString().padEnd(38, ' ')}‚ïë
‚ïë  T√©cnicas aplicables en casa: S√ç                              ‚ïë
‚ïë                                                                ‚ïë
‚ïë  Fecha: ${currentDate.padEnd(51, ' ')}‚ïë
‚ïë                                                                ‚ïë
‚ïë  Certificado ID: MOD3-${Date.now().toString().slice(-8)}                        ‚ïë
‚ïë                                                                ‚ïë
‚ïë  üè† LISTO PARA APLICAR T√âCNICAS PROFESIONALES EN CASA         ‚ïë
‚ïë                                                                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

VALIDEZ: Este certificado avala el dominio de t√©cnicas cient√≠ficamente 
respaldadas para la estimulaci√≥n del lenguaje infantil en el hogar.

APLICACI√ìN: Las competencias adquiridas pueden implementarse inmediatamente
en actividades diarias con ni√±os de ${selectedAge || 'la'} edad${selectedAge ? '' : 'es'} correspondiente${selectedAge ? '' : 's'}.
            `;
            
            // Crear y descargar el archivo
            const blob = new Blob([certificate], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Certificado_Modulo3_${userName.replace(/\s/g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üéâ Certificado profesional descargado exitosamente', 'success');
        }

        function printActivities() {
            if (!selectedAge) {
                showNotification('‚ö†Ô∏è Selecciona la edad de tu hijo primero', 'warning');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            const activities = {
                3: [
                    'Veo-Veo de Colores: 10 minutos diarios con objetos reales',
                    'Sonidos de Animales: 5 minutos con libros o juguetes',
                    'Sim√≥n dice (partes del cuerpo): 5 minutos de juego activo',
                    'Canciones con n√∫meros: 10 minutos, repetir hasta memorizar',
                    'Cuento interactivo: 15 minutos antes de dormir',
                    'Vocabulario en la merienda: durante comidas principales'
                ],
                4: [
                    'Constructor de Oraciones: 15 minutos con tarjetas de palabras',
                    'Preguntas de comprensi√≥n: durante cualquier cuento o experiencia',
                    'Secuencias temporales: 10 minutos con rutinas diarias',
                    'Rimas y trabalenguas: 10 minutos, empezar lento',
                    'Cuentos con preguntas: 15 minutos, hacer pausas estrat√©gicas'
                ],
                5: [
                    'Creaci√≥n de historias: 20 minutos con im√°genes o objetos',
                    'Juego de categor√≠as: 15 minutos clasificando objetos reales',
                    'Teatro y roles: 20 minutos interpretando profesiones',
                    'Opuestos y analog√≠as: 15 minutos con experiencias f√≠sicas',
                    'Descripciones detalladas: durante actividades cotidianas'
                ]
            };
            
            const tips = {
                3: [
                    'Exagerar sonidos y expresiones faciales',
                    'Repetir actividades favoritas varias veces',
                    'Usar objetos reales siempre que sea posible',
                    'Celebrar cada intento, aunque no sea perfecto',
                    'Mantener sesiones cortas (5-15 minutos)'
                ],
                4: [
                    'Esperar respuestas completas, no solo palabras sueltas',
                    'Usar preguntas: ¬øqu√©?, ¬øqui√©n?, ¬ød√≥nde?, ¬øcu√°ndo?',
                    'Modelar oraciones correctas antes de pedirlas',
                    'Incorporar movimiento en los aprendizajes',
                    'Ser paciente con la pronunciaci√≥n'
                ],
                5: [
                    'Fomentar creatividad aceptando respuestas originales',
                    'Hacer preguntas abiertas: "¬øQu√© crees que...?"',
                    'Conectar aprendizajes con experiencias reales',
                    'Grabar o escribir sus historias para releerlas',
                    'Incluir vocabulario emocional en las actividades'
                ]
            };
            
            const content = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Plan Personalizado de Actividades - ${selectedAge} a√±os</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
                        h1 { color: #667eea; text-align: center; }
                        h2 { color: #764ba2; border-bottom: 2px solid #f093fb; padding-bottom: 5px; }
                        h3 { color: #2c3e50; }
                        ul { line-height: 2; }
                        li { margin-bottom: 8px; }
                        .header-info { background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 20px 0; }
                        .activity-section { background: #fff; border: 1px solid #dee2e6; padding: 20px; margin: 15px 0; border-radius: 10px; }
                        .tip-box { background: #d1ecf1; padding: 15px; border-radius: 10px; margin: 10px 0; }
                        .schedule-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        .schedule-table th, .schedule-table td { border: 1px solid #dee2e6; padding: 12px; text-align: left; }
                        .schedule-table th { background: #f8f9fa; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #667eea; font-size: 0.9rem; }
                        .important { background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; }
                    </style>
                </head>
                <body>
                    <h1>üè† Plan Personalizado de Estimulaci√≥n del Lenguaje</h1>
                    
                    <div class="header-info">
                        <h2>Informaci√≥n del Plan</h2>
                        <p><strong>Edad del ni√±o:</strong> ${selectedAge} a√±os</p>
                        <p><strong>Actividades completadas en el curso:</strong> ${completedActivities.size}</p>
                        <p><strong>Fecha de creaci√≥n:</strong> ${new Date().toLocaleDateString('es-ES')}</p>
                        <p><strong>Nivel de preparaci√≥n:</strong> ‚úÖ Listo para aplicar t√©cnicas profesionales</p>
                    </div>

                    <div class="important">
                        <strong>‚ö†Ô∏è IMPORTANTE:</strong> Este plan est√° basado en t√©cnicas cient√≠ficamente respaldadas que has aprendido en el M√≥dulo 3. Cada actividad tiene un prop√≥sito espec√≠fico para el desarrollo del lenguaje.
                    </div>
                    
                    <div class="activity-section">
                        <h2>üìã Actividades Diarias Recomendadas</h2>
                        <ul>
                            ${activities[selectedAge].map(act => `<li>‚òê ${act}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="activity-section">
                        <h2>üí° T√©cnicas Profesionales Aprendidas</h2>
                        <ul>
                            ${tips[selectedAge].map(tip => `<li><strong>‚Ä¢</strong> ${tip}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="activity-section">
                        <h2>‚è∞ Horario Sugerido</h2>
                        <ul>
                            <li>‚òê <strong>Ma√±ana (10 min):</strong> Juego de vocabulario o sonidos</li>
                            <li>‚òê <strong>Tarde (15 min):</strong> Actividad creativa o construcci√≥n de frases</li>
                            <li>‚òê <strong>Noche (10 min):</strong> Cuento interactivo o canci√≥n educativa</li>
                            <li>‚òê <strong>Durante comidas:</strong> Vocabulario de alimentos y acciones</li>
                            <li>‚òê <strong>Momentos de espera:</strong> Juegos r√°pidos de rimas o secuencias</li>
                        </ul>
                    </div>
                    
                    <div class="activity-section">
                        <h2>üìä Registro Semanal de Actividades</h2>
                        <table class="schedule-table">
                            <tr>
                                <th>D√≠a</th>
                                <th>Actividad Realizada</th>
                                <th>Tiempo</th>
                                <th>Respuesta del Ni√±o</th>
                                <th>Observaciones</th>
                            </tr>
                            ${['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'].map(dia => `
                                <tr>
                                    <td style="font-weight: bold;">${dia}</td>
                                    <td style="width: 25%;"></td>
                                    <td style="width: 15%;"></td>
                                    <td style="width: 25%;"></td>
                                    <td style="width: 25%;"></td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>

                    <div class="tip-box">
                        <h3>üéØ Objetivos del Mes</h3>
                        <ul>
                            <li>‚òê Establecer rutina diaria de 20-30 minutos de estimulaci√≥n</li>
                            <li>‚òê Implementar al menos 3 actividades diferentes por semana</li>
                            <li>‚òê Observar mejoras en vocabulario o expresi√≥n</li>
                            <li>‚òê Adaptar actividades seg√∫n el inter√©s del ni√±o</li>
                            <li>‚òê Mantener un registro de progreso</li>
                        </ul>
                    </div>

                    <div class="footer">
                        <p><strong>Creado por:</strong> M√≥dulo 3 - Actividades y Juegos para Estimulaci√≥n del Lenguaje</p>
                        <p><strong>Basado en:</strong> T√©cnicas cient√≠ficamente validadas para ni√±os de ${selectedAge} a√±os</p>
                        <p><strong>Pr√≥ximo paso:</strong> Continuar con M√≥dulo 4 para aprender a identificar dificultades</p>
                        <p><strong>Soporte:</strong> Revisa el material del curso cuando tengas dudas</p>
                        
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; margin-top: 20px;">
                            <strong>üåü Recuerda:</strong> La consistencia es m√°s importante que la perfecci√≥n. 
                            Dedica unos minutos diarios y ver√°s resultados sorprendentes en el desarrollo del lenguaje de tu hijo.
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(content);
            printWindow.document.close();
            printWindow.print();
            
            showNotification('üìÑ Plan personalizado enviado a impresi√≥n', 'success');
        }

        function showProgress() {
            const progress = (completedActivities.size / totalActivities) * 100;
            
            let activitiesList = Array.from(completedActivities).map(act => {
                const card = document.querySelector(`[data-activity="${act}"]`);
                return card ? card.querySelector('.activity-title').textContent : act;
            }).join('\n‚Ä¢ ') || 'Ninguna a√∫n';
            
            let achievementsList = Array.from(achievements).map(ach => {
                const badges = {
                    'first': 'üéØ Primera Actividad',
                    'games': 'üéÆ 5 Juegos Completados',
                    'music': 'üéµ Maestro Musical',
                    'stories': 'üìö Contador de Cuentos',
                    'complete': 'üèÜ M√≥dulo Completo'
                };
                return badges[ach] || ach;
            }).join('\n‚Ä¢ ') || 'Ninguno a√∫n';
            
            const progressMessage = `
üìä TU PROGRESO EN M√ìDULO 3:

üìà Progreso general: ${Math.round(progress)}%
üéÆ Actividades completadas: ${completedActivities.size} de ${totalActivities}
üë∂ Edad seleccionada: ${selectedAge ? selectedAge + ' a√±os' : 'No seleccionada'}
üéØ Puntuaci√≥n total: ${currentScore} puntos

üèÜ Logros desbloqueados:
‚Ä¢ ${achievementsList}

üìö Actividades dominadas:
‚Ä¢ ${activitiesList}

üè† T√âCNICAS LISTAS PARA APLICAR EN CASA:
${completedActivities.size > 0 ? '‚úÖ Tienes herramientas profesionales para estimular el lenguaje' : '‚è≥ Completa actividades para obtener t√©cnicas'}

${progress === 100 ? 'üéâ ¬°M√ìDULO COMPLETADO! Descarga tu certificado y plan personalizado.' : 'üí™ ¬°Sigue aprendiendo t√©cnicas valiosas!'}
            `;
            
            alert(progressMessage);
        }

        function showHelp() {
            const helpMessage = `
üìñ GU√çA DEL M√ìDULO 3: ACTIVIDADES Y JUEGOS

üéØ OBJETIVO PRINCIPAL:
Aprender t√©cnicas profesionales para estimular el lenguaje de tu hijo en casa a trav√©s de actividades l√∫dicas y cient√≠ficamente respaldadas.

üè† ¬øC√ìMO FUNCIONA?
Este m√≥dulo te ENSE√ëA actividades para que T√ö las hagas en casa con tu hijo. Los juegos que ves aqu√≠ son DEMOSTRACIONES para que aprendas la metodolog√≠a.

üìã INSTRUCCIONES:
1. Selecciona la edad de tu hijo (3, 4 o 5 a√±os)
2. Lee las instrucciones de cada actividad cuidadosamente
3. Observa las demostraciones para entender la t√©cnica
4. Aplica lo aprendido en casa con tu hijo
5. Usa el plan imprimible como gu√≠a diaria

üéÆ TIPOS DE T√âCNICAS QUE APRENDER√ÅS:
‚Ä¢ Juegos de vocabulario con objetos reales
‚Ä¢ Cuentos interactivos con participaci√≥n
‚Ä¢ Canciones educativas que puedes crear
‚Ä¢ Construcci√≥n de frases paso a paso
‚Ä¢ Comprensi√≥n lectora con preguntas estrat√©gicas
‚Ä¢ Actividades de la vida diaria convertidas en aprendizaje

üí° CONSEJOS PROFESIONALES:
‚Ä¢ La consistencia diaria es m√°s importante que sesiones largas
‚Ä¢ Adapta las actividades al inter√©s de tu hijo
‚Ä¢ Celebra cada peque√±o progreso
‚Ä¢ Usa objetos reales siempre que sea posible
‚Ä¢ Mant√©n sesiones cortas pero frecuentes (10-20 minutos)
‚Ä¢ S√© paciente: cada ni√±o aprende a su ritmo

üèÜ BENEFICIOS AL COMPLETAR:
‚Ä¢ Dominio de t√©cnicas cient√≠ficamente validadas
‚Ä¢ Plan personalizado para aplicar en casa
‚Ä¢ Certificado de especializaci√≥n
‚Ä¢ Herramientas para toda la vida
‚Ä¢ Confianza para estimular el lenguaje de tu hijo

üìû ¬øNECESITAS M√ÅS AYUDA?
‚Ä¢ Revisa las instrucciones detalladas en cada actividad
‚Ä¢ Usa el bot√≥n "Imprimir Plan" para tener una gu√≠a f√≠sica
‚Ä¢ Contacta al instructor del curso si tienes dudas espec√≠ficas

üåü RECUERDA: Est√°s aprendiendo a ser el mejor estimulador del lenguaje de tu hijo.
            `;
            
            alert(helpMessage);
        }

        function saveProgress() {
            const progress = {
                selectedAge: selectedAge,
                completedActivities: Array.from(completedActivities),
                achievements: Array.from(achievements),
                currentScore: currentScore,
                lastAccess: new Date().toISOString(),
                version: '2.0' // Para futuras actualizaciones
            };
            
            localStorage.setItem('module3Progress', JSON.stringify(progress));
        }

        function loadSavedProgress() {
            try {
                const saved = localStorage.getItem('module3Progress');
                if (saved) {
                    const progress = JSON.parse(saved);
                    
                    console.log('üì• Cargando progreso guardado:', progress);
                    
                    // Restaurar edad
                    if (progress.selectedAge) {
                        selectedAge = progress.selectedAge;
                        setTimeout(() => {
                            selectAge(selectedAge);
                        }, 500);
                    }
                    
                    // Restaurar actividades completadas
                    if (progress.completedActivities && Array.isArray(progress.completedActivities)) {
                        progress.completedActivities.forEach(activity => {
                            completedActivities.add(activity);
                            setTimeout(() => {
                                const card = document.querySelector(`[data-activity="${activity}"]`);
                                if (card) {
                                    card.classList.add('completed');
                                }
                            }, 1000);
                        });
                    }
                    
                    // Restaurar logros
                    if (progress.achievements && Array.isArray(progress.achievements)) {
                        progress.achievements.forEach(achievement => {
                            achievements.add(achievement);
                        });
                        
                        // Actualizar badges visualmente
                        setTimeout(() => {
                            achievements.forEach(ach => {
                                const badgeMap = {
                                    'first': 'badge1',
                                    'games': 'badge2',
                                    'music': 'badge3',
                                    'stories': 'badge4',
                                    'complete': 'badge5'
                                };
                                
                                if (badgeMap[ach]) {
                                    const badge = document.getElementById(badgeMap[ach]);
                                    if (badge) {
                                        badge.classList.add('unlocked');
                                    }
                                }
                            });
                        }, 1500);
                    }
                    
                    // Restaurar puntuaci√≥n
                    if (progress.currentScore) {
                        currentScore = progress.currentScore;
                    }
                    
                    // Actualizar interfaz
                    setTimeout(() => {
                        updateProgress();
                        
                        // Mostrar botones si est√° completo
                        if (completedActivities.size >= totalActivities) {
                            document.getElementById('certificateBtn').style.display = 'inline-block';
                            document.getElementById('nextModuleBtn').style.display = 'inline-block';
                        }
                    }, 2000);
                    
                    console.log('‚úÖ Progreso cargado exitosamente');
                }
            } catch (error) {
                console.error('‚ùå Error cargando progreso:', error);
                showNotification('‚ö†Ô∏è Hubo un problema cargando tu progreso anterior', 'warning');
            }
        }

        function logout() {
            if (confirm('¬øEst√°s seguro que quieres salir? Tu progreso se guardar√° autom√°ticamente.')) {
                saveProgress();
                showNotification('üíæ Progreso guardado. ¬°Hasta pronto!', 'success');
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 1500);
            }
        }

        function showNotification(message, type = 'info', duration = 4000) {
            // Remover notificaciones existentes
            const existingNotifications = document.querySelectorAll('.notification-custom');
            existingNotifications.forEach(notif => notif.remove());
            
            // Crear nueva notificaci√≥n
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} notification-custom`;
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                max-width: 500px;
                animation: slideInNotification 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                border-radius: 10px;
                font-weight: 500;
            `;
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            // Auto-ocultar despu√©s del tiempo especificado
            setTimeout(() => {
                notification.style.animation = 'slideOutNotification 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, duration);
        }

        // Auto-guardado peri√≥dico
        setInterval(() => {
            if (completedActivities.size > 0) {
                saveProgress();
            }
        }, 30000); // Guardar cada 30 segundos

        // Guardar al cerrar/recargar la p√°gina
        window.addEventListener('beforeunload', () => {
            saveProgress();
        });

        // Prevenir p√©rdida de datos
        window.addEventListener('pagehide', () => {
            saveProgress();
        });

        // Mensajes motivacionales personalizados
        const motivationalMessages = [
            "¬°Excelente! Cada t√©cnica que aprendes beneficia el desarrollo de tu hijo üåü",
            "¬°Fant√°stico! Tu hijo tendr√° un gran estimulador del lenguaje en casa üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
            "¬°Incre√≠ble progreso! Est√°s adquiriendo herramientas profesionales valiosas üí™",
            "¬°Muy bien! El aprendizaje l√∫dico es la clave del desarrollo infantil üéÆ",
            "¬°Genial! Cada actividad que dominas es una inversi√≥n en el futuro de tu hijo üéØ"
        ];

        function showRandomMotivation() {
            if (completedActivities.size > 0 && completedActivities.size % 3 === 0) {
                const message = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
                showNotification(message, 'success', 6000);
            }
        }

        // Reemplazar funci√≥n original con la motivacional
        const originalMarkComplete = markActivityComplete;
        markActivityComplete = function(activityId) {
            originalMarkComplete(activityId);
            showRandomMotivation();
        };

        // Agregar estilos de animaci√≥n din√°micamente
        if (!document.getElementById('notification-styles')) {
            const style = document.createElement('style');
            style.id = 'notification-styles';
            style.textContent = `
                @keyframes slideInNotification {
                    from { 
                        transform: translateX(100%); 
                        opacity: 0; 
                    }
                    to { 
                        transform: translateX(0); 
                        opacity: 1; 
                    }
                }
                @keyframes slideOutNotification {
                    from { 
                        transform: translateX(0); 
                        opacity: 1; 
                    }
                    to { 
                        transform: translateX(100%); 
                        opacity: 0; 
                    }
                }
                .notification-custom {
                    transition: all 0.3s ease;
                }
                @media (max-width: 768px) {
                    .notification-custom {
                        right: 10px;
                        left: 10px;
                        min-width: auto;
                        max-width: none;
                    }
                }
            `;
            document.head.appendChild(style);
        }

        // Funci√≥n de depuraci√≥n para desarrollo
        function debugReset() {
            if (confirm('üîß ¬øReiniciar completamente el progreso del m√≥dulo? (Solo para desarrollo)')) {
                localStorage.removeItem('module3Progress');
                localStorage.removeItem('module3_welcome_shown');
                showNotification('üîÑ Progreso reiniciado', 'warning');
                setTimeout(() => location.reload(), 1000);
            }
        }

        // Funci√≥n para compartir progreso
        function shareProgress() {
            const shareText = `
üéâ ¬°He completado ${completedActivities.size} actividades del M√≥dulo 3 de Estimulaci√≥n del Lenguaje!

üìä Mi progreso:
- T√©cnicas dominadas: ${completedActivities.size}/${totalActivities}
- Edad especializada: ${selectedAge ? selectedAge + ' a√±os' : 'Todas las edades'}
- Puntuaci√≥n: ${currentScore} puntos
- Logros: ${achievements.size}/5

üè† Ahora tengo herramientas profesionales para estimular el lenguaje de mi hijo en casa.

#Estimulaci√≥nDelLenguaje #DesarrolloInfantil #Educaci√≥n #Familia
            `;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Mi progreso en Estimulaci√≥n del Lenguaje',
                    text: shareText
                }).then(() => {
                    showNotification('‚úÖ Progreso compartido exitosamente', 'success');
                }).catch((error) => {
                    console.log('Error al compartir:', error);
                    fallbackShare(shareText);
                });
            } else {
                fallbackShare(shareText);
            }
        }

        function fallbackShare(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('üìã Texto copiado al portapapeles para compartir', 'success');
                });
            } else {
                // Fallback para navegadores m√°s antiguos
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('üìã Texto copiado al portapapeles', 'success');
            }
        }

        // Easter egg: c√≥digo secreto para acceso de desarrollo
        let secretCode = [];
        document.addEventListener('keydown', (e) => {
            secretCode.push(e.key);
            secretCode = secretCode.slice(-8);
            if (secretCode.join('') === 'devtools') {
                if (confirm('üîß ¬øActivar herramientas de desarrollo?')) {
                    console.log('üõ†Ô∏è Herramientas de desarrollo activadas');
                    console.log('Funciones disponibles:');
                    console.log('- debugReset(): Reiniciar progreso');
                    console.log('- completedActivities:', completedActivities);
                    console.log('- achievements:', achievements);
                    console.log('- currentScore:', currentScore);
                    
                    // A√±adir bot√≥n de debug temporal
                    const debugBtn = document.createElement('button');
                    debugBtn.textContent = 'üîß Debug';
                    debugBtn.className = 'btn';
                    debugBtn.onclick = debugReset;
                    debugBtn.style.position = 'fixed';
                    debugBtn.style.bottom = '20px';
                    debugBtn.style.left = '20px';
                    debugBtn.style.zIndex = '10000';
                    document.body.appendChild(debugBtn);
                    
                    showNotification('üõ†Ô∏è Herramientas de desarrollo activadas', 'info');
                }
            }
        });

        // Log de inicializaci√≥n completa
        console.log('üéÆ M√≥dulo 3: Actividades y Juegos - Sistema completo cargado');
        console.log('üìö Base cient√≠fica integrada para cada edad (3, 4, 5 a√±os)');
        console.log('üéØ Total de actividades disponibles:', totalActivities);
        console.log('üè† Enfoque: T√©cnicas para aplicar en casa');
        console.log('üí° Selecciona la edad de tu hijo para comenzar');

        // Verificar integridad del sistema
        setTimeout(() => {
            const requiredElements = [
                'progressFill', 'progressText', 'activitiesCompleted',
                'ageMessage', 'selectedAge', 'achievementsList'
            ];
            
            const missingElements = requiredElements.filter(id => !document.getElementById(id));
            
            if (missingElements.length === 0) {
                console.log('‚úÖ Todos los elementos del sistema est√°n presentes');
            } else {
                console.warn('‚ö†Ô∏è Elementos faltantes:', missingElements);
            }
            
            if (localStorage.getItem('module3Progress')) {
                console.log('üì• Progreso anterior detectado y cargado');
            } else {
                console.log('üÜï Sesi√≥n nueva - no hay progreso anterior');
            }
        }, 3000);

        // Funci√≥n final de limpieza
        window.addEventListener('unload', () => {
            console.log('üëã M√≥dulo 3 finalizado - progreso guardado');
        });

    </script>
</body>
</html>
