<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥dulo 3: Actividades y Juegos - Estimulaci√≥n del Lenguaje</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.8;
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 2rem 2rem;
        }

        .progress-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e9ecef;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        .module-header {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .module-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .age-selector {
            background: linear-gradient(135deg, #f093fb20 0%, #f5576c20 100%);
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 2px solid #f093fb;
        }

        .age-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .age-btn {
            background: white;
            color: #764ba2;
            padding: 1rem 2rem;
            border: 2px solid #764ba2;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .age-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .age-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .content-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .activity-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(118, 75, 162, 0.4);
        }

        .activity-card.completed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .activity-card.completed::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
            opacity: 0.5;
        }

        .activity-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .activity-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .activity-description {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .game-container {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 3px solid #667eea;
        }

        .game-area {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            margin: 1rem 0;
            min-height: 300px;
            position: relative;
        }

        .interactive-element {
            display: inline-block;
            padding: 1rem;
            margin: 0.5rem;
            background: linear-gradient(135deg, #ffd93d 0%, #ffb300 100%);
            color: #333;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .interactive-element:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 183, 0, 0.4);
        }

        .btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 1rem 0.5rem 1rem 0;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .quiz-container {
            background: #f0f8ff;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 2px solid #4a90e2;
        }

        .quiz-question {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .quiz-options {
            display: grid;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .quiz-option {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: #e9ecef;
            border-color: #4a90e2;
        }

        .quiz-option.selected {
            background: #d1ecf1;
            border-color: #0c5460;
        }

        .quiz-option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .quiz-option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .feedback-box {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }

        .feedback-box.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .feedback-correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback-incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .achievement-badge {
            display: inline-block;
            background: #ffd700;
            color: #333;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin: 0.5rem;
            font-weight: 600;
            opacity: 0.3;
            transition: all 0.3s ease;
        }

        .achievement-badge.unlocked {
            opacity: 1;
            animation: bounce 0.5s ease;
        }

        .timer {
            background: #fff;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin: 1rem 0;
        }

        .score-display {
            background: linear-gradient(135deg, #ffd93d 0%, #ffb300 100%);
            color: #333;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        .drag-item {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            margin: 0.5rem;
            background: #fff;
            border: 2px solid #667eea;
            border-radius: 25px;
            cursor: move;
            transition: all 0.3s ease;
        }

        .drag-item.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            min-height: 100px;
            padding: 1rem;
            border: 3px dashed #667eea;
            border-radius: 10px;
            margin: 1rem 0;
            background: #f8f9fa;
            text-align: center;
        }

        .drop-zone.drag-over {
            background: #e8f4f8;
            border-color: #28a745;
        }

        .module-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .hidden {
            display: none;
        }

        .age-specific-content {
            display: none;
        }

        .age-specific-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .module-header h1 {
                font-size: 2rem;
            }
            
            .age-buttons {
                flex-direction: column;
            }
            
            .activity-grid {
                grid-template-columns: 1fr;
            }
            
            .module-navigation {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <span>üéÆ</span>
                <span>M√≥dulo 3: Actividades y Juegos</span>
            </div>
            <div class="nav-links">
                <a href="../index.html">‚Üê Dashboard</a>
                <a href="../modulo2/index.html">M√≥dulo 2</a>
                <a href="#" onclick="showProgress()">Mi Progreso</a>
                <a href="#" onclick="logout()">Salir</a>
            </div>
        </div>
    </header>

    <div class="main-content">
        <div class="progress-section">
            <h3>Tu Progreso en el M√≥dulo 3</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p><span id="progressText">0% completado</span> ‚Ä¢ <span id="activitiesCompleted">0 de 12 actividades</span></p>
            <div id="achievementsList" style="margin-top: 1rem;">
                <span class="achievement-badge" id="badge1">üéØ Primera Actividad</span>
                <span class="achievement-badge" id="badge2">üéÆ 5 Juegos</span>
                <span class="achievement-badge" id="badge3">üéµ Maestro Musical</span>
                <span class="achievement-badge" id="badge4">üìö Contador de Cuentos</span>
                <span class="achievement-badge" id="badge5">üèÜ M√≥dulo Completo</span>
            </div>
        </div>

        <div class="module-header">
            <h1>üéÆ Actividades y Juegos para Estimular el Lenguaje</h1>
            <p>Descubre actividades l√∫dicas dise√±adas cient√≠ficamente para cada edad</p>
            
            <div class="age-selector">
                <h3>üìå Selecciona la edad de tu hijo para ver actividades personalizadas:</h3>
                <div class="age-buttons">
                    <button class="age-btn" onclick="selectAge(3)">3 a√±os</button>
                    <button class="age-btn" onclick="selectAge(4)">4 a√±os</button>
                    <button class="age-btn" onclick="selectAge(5)">5 a√±os</button>
                </div>
                <p id="ageMessage" style="margin-top: 1rem; display: none; text-align: center; font-weight: bold; color: #667eea;">
                    ‚ú® Actividades adaptadas para <span id="selectedAge"></span> a√±os
                </p>
            </div>
        </div>
        <!-- Contenido para 3 a√±os -->
        <div id="content-age-3" class="age-specific-content">
            
            <!-- Secci√≥n 1: Juegos de Vocabulario -->
            <div class="content-section" data-section="vocab-3">
                <h2 class="section-title">
                    <span>üéØ</span>
                    Juegos de Vocabulario (3 a√±os)
                </h2>
                
                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> A los 3 a√±os, los ni√±os aprenden mejor a trav√©s de la repetici√≥n y asociaci√≥n visual. Pueden aprender 5-10 palabras nuevas por d√≠a.
                </div>

                <div class="activity-grid">
                    <!-- Actividad 1 -->
                    <div class="activity-card" onclick="startVocabGame3()" data-activity="vocab-game-3">
                        <div class="activity-icon">üñºÔ∏è</div>
                        <div class="activity-title">Veo-Veo de Colores</div>
                        <div class="activity-description">Identifica objetos por su color y aprende vocabulario nuevo</div>
                    </div>

                    <!-- Actividad 2 -->
                    <div class="activity-card" onclick="startAnimalSounds3()" data-activity="animal-sounds-3">
                        <div class="activity-icon">üê∂</div>
                        <div class="activity-title">Sonidos de Animales</div>
                        <div class="activity-description">Asocia animales con sus sonidos y nombres</div>
                    </div>

                    <!-- Actividad 3 -->
                    <div class="activity-card" onclick="startBodyParts3()" data-activity="body-parts-3">
                        <div class="activity-icon">üë∂</div>
                        <div class="activity-title">Mi Cuerpo</div>
                        <div class="activity-description">Aprende las partes del cuerpo con movimientos</div>
                    </div>
                </div>

                <!-- Juego Interactivo: Veo-Veo -->
                <div id="veoVeoGame3" class="game-container hidden">
                    <h3>üéÆ Juego: Veo-Veo de Colores</h3>
                    <div class="score-display">Puntos: <span id="veoVeoScore">0</span></div>
                    
                    <div class="game-area">
                        <p id="veoVeoInstruction" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 1rem;">
                            Veo, veo... algo de color <span id="targetColor" style="color: red;">ROJO</span>
                        </p>
                        <div id="veoVeoObjects" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;">
                            <!-- Se llenar√°n din√°micamente -->
                        </div>
                    </div>
                    
                    <div class="feedback-box" id="veoVeoFeedback"></div>
                    <button class="btn btn-warning" onclick="nextVeoVeoRound()">Siguiente Ronda</button>
                    <button class="btn" onclick="closeVeoVeoGame()">Cerrar Juego</button>
                </div>

                <!-- Juego de Sonidos de Animales -->
                <div id="animalSoundsGame3" class="game-container hidden">
                    <h3>üêæ Juego: ¬øQu√© Animal Soy?</h3>
                    <div class="game-area">
                        <div style="text-align: center;">
                            <div id="animalImage" style="font-size: 5rem; margin: 1rem;">üêÆ</div>
                            <p style="font-size: 1.2rem; margin: 1rem;">Escucha el sonido y adivina el animal</p>
                            <button class="btn btn-info" onclick="playAnimalSound()">üîä Reproducir Sonido</button>
                        </div>
                        <div id="animalOptions" style="display: flex; justify-content: center; gap: 1rem; margin: 2rem 0;">
                            <!-- Se llenar√°n din√°micamente -->
                        </div>
                    </div>
                    <div class="feedback-box" id="animalFeedback"></div>
                    <button class="btn" onclick="closeAnimalSoundsGame()">Cerrar Juego</button>
                </div>
            </div>

            <!-- Secci√≥n 2: Cuentos Interactivos -->
            <div class="content-section" data-section="stories-3">
                <h2 class="section-title">
                    <span>üìö</span>
                    Cuentos Interactivos (3 a√±os)
                </h2>

                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> Los cuentos con repetici√≥n y sonidos onomatop√©yicos mejoran la memoria auditiva y la comprensi√≥n narrativa.
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startStory3_1()" data-activity="story-3-1">
                        <div class="activity-icon">üê∞</div>
                        <div class="activity-title">El Conejito Saltar√≠n</div>
                        <div class="activity-description">Cuento con movimientos y sonidos</div>
                    </div>

                    <div class="activity-card" onclick="startStory3_2()" data-activity="story-3-2">
                        <div class="activity-icon">üåô</div>
                        <div class="activity-title">La Luna y las Estrellas</div>
                        <div class="activity-description">Cuento para completar frases</div>
                    </div>
                </div>

                <!-- Cuento Interactivo -->
                <div id="interactiveStory3" class="game-container hidden">
                    <h3>üìñ El Conejito Saltar√≠n</h3>
                    <div class="game-area">
                        <div id="storyContent" style="font-size: 1.1rem; line-height: 1.8;">
                            <!-- Contenido del cuento -->
                        </div>
                        <div id="storyInteraction" style="margin-top: 2rem;">
                            <!-- Elementos interactivos -->
                        </div>
                    </div>
                    <button class="btn btn-warning" onclick="nextStoryPage()">Siguiente P√°gina ‚Üí</button>
                    <button class="btn" onclick="closeStory()">Cerrar Cuento</button>
                </div>
            </div>

            <!-- Secci√≥n 3: Canciones Educativas -->
            <div class="content-section" data-section="songs-3">
                <h2 class="section-title">
                    <span>üéµ</span>
                    Canciones Educativas (3 a√±os)
                </h2>

                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> El ritmo y la melod√≠a facilitan la memorizaci√≥n de palabras y mejoran la pronunciaci√≥n.
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startSong3_1()" data-activity="song-3-1">
                        <div class="activity-icon">üé∂</div>
                        <div class="activity-title">Los N√∫meros Bailarines</div>
                        <div class="activity-description">Aprende a contar del 1 al 10</div>
                    </div>

                    <div class="activity-card" onclick="startSong3_2()" data-activity="song-3-2">
                        <div class="activity-icon">üåà</div>
                        <div class="activity-title">El Arco√≠ris Musical</div>
                        <div class="activity-description">Aprende los colores cantando</div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 4: Actividades Diarias -->
            <div class="content-section" data-section="daily-3">
                <h2 class="section-title">
                    <span>üè†</span>
                    Actividades Diarias (3 a√±os)
                </h2>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startDailyActivity3()" data-activity="daily-3">
                        <div class="activity-icon">üçé</div>
                        <div class="activity-title">Hora de la Merienda</div>
                        <div class="activity-description">Vocabulario de alimentos y acciones</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido para 4 a√±os -->
        <div id="content-age-4" class="age-specific-content">
            
            <!-- Secci√≥n 1: Juegos de Construcci√≥n de Frases -->
            <div class="content-section" data-section="sentences-4">
                <h2 class="section-title">
                    <span>üèóÔ∏è</span>
                    Construcci√≥n de Frases (4 a√±os)
                </h2>
                
                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> A los 4 a√±os, los ni√±os pueden formar frases de 4-5 palabras y comprenden estructuras gramaticales b√°sicas.
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startSentenceBuilder4()" data-activity="sentence-4">
                        <div class="activity-icon">üß©</div>
                        <div class="activity-title">Constructor de Oraciones</div>
                        <div class="activity-description">Arrastra palabras para formar frases</div>
                    </div>

                    <div class="activity-card" onclick="startQuestionGame4()" data-activity="questions-4">
                        <div class="activity-icon">‚ùì</div>
                        <div class="activity-title">¬øQu√©? ¬øD√≥nde? ¬øCu√°ndo?</div>
                        <div class="activity-description">Aprende a hacer y responder preguntas</div>
                    </div>

                    <div class="activity-card" onclick="startSequenceGame4()" data-activity="sequence-4">
                        <div class="activity-icon">üìÖ</div>
                        <div class="activity-title">Primero, Luego, Despu√©s</div>
                        <div class="activity-description">Ordena secuencias de eventos</div>
                    </div>
                </div>

                <!-- Juego Constructor de Oraciones -->
                <div id="sentenceBuilder4" class="game-container hidden">
                    <h3>üß© Constructor de Oraciones</h3>
                    <div class="game-area">
                        <p style="font-size: 1.2rem; font-weight: bold;">Arrastra las palabras para formar una oraci√≥n:</p>
                        
                        <div id="wordBank" style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <p>Banco de palabras:</p>
                            <div id="availableWords" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <!-- Palabras draggables -->
                            </div>
                        </div>

                        <div class="drop-zone" id="sentenceZone">
                            <p style="color: #999;">Arrastra las palabras aqu√≠ para formar una oraci√≥n</p>
                        </div>

                        <button class="btn btn-success" onclick="checkSentence()">Verificar Oraci√≥n</button>
                    </div>
                    <div class="feedback-box" id="sentenceFeedback"></div>
                    <button class="btn" onclick="closeSentenceBuilder()">Cerrar Juego</button>
                </div>
            </div>

            <!-- Secci√≥n 2: Cuentos con Comprensi√≥n -->
            <div class="content-section" data-section="comprehension-4">
                <h2 class="section-title">
                    <span>üìñ</span>
                    Cuentos con Comprensi√≥n (4 a√±os)
                </h2>

                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> Los ni√±os de 4 a√±os pueden seguir historias con 3-4 eventos y responder preguntas simples sobre ellas.
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startComprehensionStory4()" data-activity="comp-story-4">
                        <div class="activity-icon">ü¶Å</div>
                        <div class="activity-title">El Le√≥n y el Rat√≥n</div>
                        <div class="activity-description">Lee y responde preguntas</div>
                    </div>
                </div>

                <!-- Quiz de Comprensi√≥n -->
                <div id="comprehensionQuiz4" class="quiz-container hidden">
                    <h3>üìñ Comprensi√≥n del Cuento</h3>
                    <div class="quiz-question">
                        <p id="quizQuestion">Pregunta aparecer√° aqu√≠</p>
                        <div class="quiz-options" id="quizOptions">
                            <!-- Opciones -->
                        </div>
                    </div>
                    <div class="feedback-box" id="quizFeedback"></div>
                    <button class="btn btn-warning" onclick="nextQuizQuestion()">Siguiente Pregunta</button>
                    <button class="btn" onclick="closeQuiz()">Cerrar Quiz</button>
                </div>
            </div>

            <!-- Secci√≥n 3: Rimas y Trabalenguas -->
            <div class="content-section" data-section="rhymes-4">
                <h2 class="section-title">
                    <span>üé≠</span>
                    Rimas y Trabalenguas (4 a√±os)
                </h2>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startRhymeGame4()" data-activity="rhyme-4">
                        <div class="activity-icon">üé™</div>
                        <div class="activity-title">Encuentra la Rima</div>
                        <div class="activity-description">Identifica palabras que riman</div>
                    </div>

                    <div class="activity-card" onclick="startTongueTwister4()" data-activity="tongue-4">
                        <div class="activity-icon">üëÖ</div>
                        <div class="activity-title">Trabalenguas F√°ciles</div>
                        <div class="activity-description">Mejora la pronunciaci√≥n</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido para 5 a√±os -->
        <div id="content-age-5" class="age-specific-content">
            
            <!-- Secci√≥n 1: Narraci√≥n y Creatividad -->
            <div class="content-section" data-section="narration-5">
                <h2 class="section-title">
                    <span>üé®</span>
                    Narraci√≥n y Creatividad (5 a√±os)
                </h2>
                
                <div class="alert alert-info">
                    <strong>üß† Base cient√≠fica:</strong> A los 5 a√±os, los ni√±os pueden crear historias simples con inicio, desarrollo y final, usando frases de 6-8 palabras.
                </div>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startStoryCreator5()" data-activity="create-story-5">
                        <div class="activity-icon">‚úçÔ∏è</div>
                        <div class="activity-title">Crea tu Cuento</div>
                        <div class="activity-description">Inventa una historia con im√°genes</div>
                    </div>

                    <div class="activity-card" onclick="startDescriptionGame5()" data-activity="describe-5">
                        <div class="activity-icon">üîç</div>
                        <div class="activity-title">Describe y Adivina</div>
                        <div class="activity-description">Describe objetos con detalles</div>
                    </div>

                    <div class="activity-card" onclick="startDialogGame5()" data-activity="dialog-5">
                        <div class="activity-icon">üí¨</div>
                        <div class="activity-title">Conversaciones</div>
                        <div class="activity-description">Practica di√°logos y roles</div>
                    </div>
                </div>

                <!-- Creador de Historias -->
                <div id="storyCreator5" class="game-container hidden">
                    <h3>‚úçÔ∏è Crea tu Propia Historia</h3>
                    <div class="game-area">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 1rem 0;">
                            <div style="text-align: center;">
                                <p><strong>Inicio</strong></p>
                                <div id="storyBeginning" class="drop-zone" style="min-height: 150px;">
                                    Arrastra una imagen aqu√≠
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <p><strong>Desarrollo</strong></p>
                                <div id="storyMiddle" class="drop-zone" style="min-height: 150px;">
                                    Arrastra una imagen aqu√≠
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <p><strong>Final</strong></p>
                                <div id="storyEnd" class="drop-zone" style="min-height: 150px;">
                                    Arrastra una imagen aqu√≠
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <p><strong>Banco de im√°genes:</strong></p>
                            <div id="imageBank" style="display: flex; flex-wrap: wrap; gap: 1rem;">
                                <!-- Im√°genes draggables -->
                            </div>
                        </div>

                        <button class="btn btn-success" onclick="tellStory()">Contar la Historia</button>
                    </div>
                    <div class="feedback-box" id="storyFeedback"></div>
                    <button class="btn" onclick="closeStoryCreator()">Cerrar</button>
                </div>
            </div>

            <!-- Secci√≥n 2: Juegos de L√≥gica Verbal -->
            <div class="content-section" data-section="logic-5">
                <h2 class="section-title">
                    <span>üß†</span>
                    L√≥gica Verbal (5 a√±os)
                </h2>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startCategoryGame5()" data-activity="category-5">
                        <div class="activity-icon">üì¶</div>
                        <div class="activity-title">Categor√≠as</div>
                        <div class="activity-description">Agrupa palabras por categor√≠as</div>
                    </div>

                    <div class="activity-card" onclick="startOppositeGame5()" data-activity="opposite-5">
                        <div class="activity-icon">‚ÜîÔ∏è</div>
                        <div class="activity-title">Opuestos</div>
                        <div class="activity-description">Encuentra palabras contrarias</div>
                    </div>

                    <div class="activity-card" onclick="startAnalogiesGame5()" data-activity="analogies-5">
                        <div class="activity-icon">üîó</div>
                        <div class="activity-title">Analog√≠as Simples</div>
                        <div class="activity-description">Completa relaciones l√≥gicas</div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 3: Teatro y Expresi√≥n -->
            <div class="content-section" data-section="theater-5">
                <h2 class="section-title">
                    <span>üé≠</span>
                    Teatro y Expresi√≥n (5 a√±os)
                </h2>

                <div class="activity-grid">
                    <div class="activity-card" onclick="startRolePlay5()" data-activity="roleplay-5">
                        <div class="activity-icon">üë®‚Äçüë©‚Äçüëß</div>
                        <div class="activity-title">Juego de Roles</div>
                        <div class="activity-description">Act√∫a diferentes personajes</div>
                    </div>

                    <div class="activity-card" onclick="startEmotionsGame5()" data-activity="emotions-5">
                        <div class="activity-icon">üòä</div>
                        <div class="activity-title">Expresando Emociones</div>
                        <div class="activity-description">Identifica y expresa sentimientos</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Quiz Final del M√≥dulo -->
        <div class="content-section">
            <h2 class="section-title">
                <span>üèÜ</span>
                Evaluaci√≥n Final del M√≥dulo
            </h2>
            
            <div class="alert alert-warning">
                <strong>üìù Importante:</strong> Completa al menos 8 actividades antes de realizar la evaluaci√≥n final.
            </div>

            <button class="btn btn-success" onclick="startFinalQuiz()" id="finalQuizBtn" disabled>
                Comenzar Evaluaci√≥n Final
            </button>

            <div id="finalQuizContainer" class="quiz-container hidden">
                <h3>üèÜ Evaluaci√≥n Final</h3>
                <div class="timer">Tiempo: <span id="quizTimer">05:00</span></div>
                <div class="quiz-question" id="finalQuestion">
                    <!-- Preguntas din√°micas seg√∫n edad -->
                </div>
                <div class="feedback-box" id="finalFeedback"></div>
                <button class="btn btn-warning" onclick="submitFinalQuiz()">Enviar Respuestas</button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="module-navigation">
            <a href="../modulo2/index.html" class="btn btn-secondary">‚Üê M√≥dulo 2</a>
            <div>
                <button class="btn" onclick="generateCertificate()" id="certificateBtn" style="display: none;">üèÜ Certificado</button>
                <a href="../modulo4/index.html" class="btn" id="nextModuleBtn" style="display: none;">M√≥dulo 4 ‚Üí</a>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let selectedAge = null;
        let completedActivities = new Set();
        let totalActivities = 12;
        let currentScore = 0;
        let currentQuizQuestion = 0;
        let quizTimer = null;
        let storyPage = 0;
        let achievements = new Set();

        // Base de datos de contenido por edad
        const contentDatabase = {
            3: {
                vocabulary: {
                    colors: ['rojo', 'azul', 'amarillo', 'verde', 'naranja', 'rosa'],
                    animals: ['perro', 'gato', 'vaca', 'pato', 'pollo', 'caballo'],
                    bodyParts: ['cabeza', 'ojos', 'nariz', 'boca', 'manos', 'pies'],
                    foods: ['manzana', 'pl√°tano', 'leche', 'pan', 'agua', 'galleta'],
                    actions: ['comer', 'dormir', 'jugar', 'correr', 'saltar', 'cantar']
                },
                stories: [
                    {
                        title: "El Conejito Saltar√≠n",
                        pages: [
                            "Hab√≠a una vez un conejito üê∞ que le gustaba saltar.",
                            "Saltaba por aqu√≠... HOP! Saltaba por all√°... HOP!",
                            "Un d√≠a encontr√≥ una zanahoria ü•ï muy grande.",
                            "¬°√ëam, √±am! Qu√© rica estaba la zanahoria.",
                            "Y color√≠n colorado, este cuento se ha acabado."
                        ]
                    }
                ],
                songs: [
                    {
                        title: "Los N√∫meros Bailarines",
                        lyrics: "Uno, dos, tres - mueve los pies\nCuatro, cinco, seis - salta otra vez\nSiete, ocho, nueve - el cuerpo se mueve\nDiez, diez, diez - ¬°baila con los pies!"
                    }
                ]
            },
            4: {
                sentences: {
                    subjects: ['El ni√±o', 'La ni√±a', 'El perro', 'Mi mam√°', 'Mi pap√°'],
                    verbs: ['come', 'juega', 'corre', 'lee', 'canta'],
                    objects: ['pelota', 'manzana', 'libro', 'canci√≥n', 'juguete'],
                    places: ['en el parque', 'en casa', 'en la escuela', 'en el jard√≠n']
                },
                rhymes: {
                    words: [
                        {word: 'gato', rhymes: ['pato', 'zapato', 'plato']},
                        {word: 'casa', rhymes: ['pasa', 'masa', 'taza']},
                        {word: 'pelota', rhymes: ['bota', 'flota', 'gota']}
                    ]
                },
                tongueTwisters: [
                    "Tres tristes tigres",
                    "Pepe pica papas",
                    "El perro de Rita"
                ]
            },
            5: {
                storyElements: {
                    characters: ['üë∏ princesa', 'ü¶∏ superh√©roe', 'üßô mago', 'üêâ drag√≥n', 'ü§ñ robot'],
                    settings: ['üè∞ castillo', 'üå≥ bosque', 'üèñÔ∏è playa', 'üåô espacio', 'üèîÔ∏è monta√±a'],
                    problems: ['perdi√≥ algo', 'necesita ayuda', 'est√° atrapado', 'busca un tesoro'],
                    solutions: ['encuentra amigos', 'usa magia', 'resuelve acertijo', 'trabaja en equipo']
                },
                categories: {
                    animals: ['le√≥n', 'tigre', 'elefante', 'jirafa', 'mono'],
                    transport: ['auto', 'avi√≥n', 'barco', 'tren', 'bicicleta'],
                    clothes: ['camisa', 'pantal√≥n', 'zapatos', 'gorro', 'vestido']
                },
                opposites: [
                    {word: 'grande', opposite: 'peque√±o'},
                    {word: 'alto', opposite: 'bajo'},
                    {word: 'r√°pido', opposite: 'lento'},
                    {word: 'caliente', opposite: 'fr√≠o'},
                    {word: 'd√≠a', opposite: 'noche'}
                ],
                emotions: ['feliz', 'triste', 'enojado', 'asustado', 'sorprendido', 'emocionado']
            }
        };

        // Inicializaci√≥n
        window.addEventListener('DOMContentLoaded', function() {
            checkModuleAccess();
            loadSavedProgress();
            initializeDragAndDrop();
        });

        // Verificar acceso al m√≥dulo
        function checkModuleAccess() {
            const courseProgress = JSON.parse(localStorage.getItem('courseProgress') || '[false,false,false,false,false]');
            // Descomentado para producci√≥n
            // if (!courseProgress[1]) {
            //     alert('‚ö†Ô∏è Debes completar el M√≥dulo 2 primero');
            //     window.location.href = '../modulo2/index.html';
            // }
        }

        // Selecci√≥n de edad
        function selectAge(age) {
            selectedAge = age;
            
            // Actualizar botones
            document.querySelectorAll('.age-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar mensaje
            document.getElementById('ageMessage').style.display = 'block';
            document.getElementById('selectedAge').textContent = age;
            
            // Ocultar todo el contenido espec√≠fico de edad
            document.querySelectorAll('.age-specific-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Mostrar contenido de la edad seleccionada
            const ageContent = document.getElementById(`content-age-${age}`);
            if (ageContent) {
                ageContent.classList.add('active');
            }
            
            // Guardar selecci√≥n
            localStorage.setItem('module3SelectedAge', age);
            
            showNotification(`‚úÖ Actividades adaptadas para ${age} a√±os`, 'success');
        }

        // JUEGOS PARA 3 A√ëOS
        
        // Juego Veo-Veo de Colores
        function startVocabGame3() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('veoVeoGame3').classList.remove('hidden');
            initializeVeoVeoGame();
        }

        function initializeVeoVeoGame() {
            const colors = ['rojo', 'azul', 'amarillo', 'verde'];
            const objects = {
                rojo: ['üçé manzana', 'üçì fresa', '‚ù§Ô∏è coraz√≥n', 'üåπ rosa'],
                azul: ['üåä agua', 'üêü pez', 'üëï camisa', 'üåå cielo'],
                amarillo: ['‚òÄÔ∏è sol', 'üåª girasol', 'üçå pl√°tano', '‚≠ê estrella'],
                verde: ['üå≥ √°rbol', 'ü•¶ br√≥coli', 'üê∏ rana', 'üåø hoja']
            };
            
            const targetColor = colors[Math.floor(Math.random() * colors.length)];
            document.getElementById('targetColor').textContent = targetColor.toUpperCase();
            document.getElementById('targetColor').style.color = getColorHex(targetColor);
            
            const objectsContainer = document.getElementById('veoVeoObjects');
            objectsContainer.innerHTML = '';
            
            // A√±adir objetos correctos
            const correctObjects = objects[targetColor];
            const selectedCorrect = correctObjects[Math.floor(Math.random() * correctObjects.length)];
            
            // A√±adir objetos incorrectos
            let allObjects = [selectedCorrect];
            for (let color in objects) {
                if (color !== targetColor) {
                    const wrongObject = objects[color][Math.floor(Math.random() * objects[color].length)];
                    allObjects.push(wrongObject);
                }
            }
            
            // Mezclar
            allObjects.sort(() => Math.random() - 0.5);
            
            allObjects.forEach(obj => {
                const div = document.createElement('div');
                div.className = 'interactive-element';
                div.textContent = obj;
                div.onclick = () => checkVeoVeoAnswer(obj, targetColor, objects);
                objectsContainer.appendChild(div);
            });
        }

        function checkVeoVeoAnswer(selected, targetColor, objects) {
            const feedback = document.getElementById('veoVeoFeedback');
            const isCorrect = objects[targetColor].includes(selected);
            
            if (isCorrect) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `‚úÖ ¬°Muy bien! ${selected} es de color ${targetColor}`;
                updateScore(10);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚ùå Intenta otra vez. Ese no es de color ${targetColor}`;
            }
        }

        function nextVeoVeoRound() {
            initializeVeoVeoGame();
            document.getElementById('veoVeoFeedback').className = 'feedback-box';
        }

        function closeVeoVeoGame() {
            document.getElementById('veoVeoGame3').classList.add('hidden');
            markActivityComplete('vocab-game-3');
        }

        function getColorHex(color) {
            const colors = {
                rojo: '#ff0000',
                azul: '#0000ff',
                amarillo: '#ffff00',
                verde: '#00ff00'
            };
            return colors[color] || '#000000';
        }

        // Juego de Sonidos de Animales
        function startAnimalSounds3() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('animalSoundsGame3').classList.remove('hidden');
            initializeAnimalGame();
        }

        function initializeAnimalGame() {
            const animals = [
                {emoji: 'üêÆ', name: 'vaca', sound: 'muuu'},
                {emoji: 'üê∂', name: 'perro', sound: 'guau guau'},
                {emoji: 'üê±', name: 'gato', sound: 'miau'},
                {emoji: 'üê∑', name: 'cerdo', sound: 'oink oink'},
                {emoji: 'üêî', name: 'pollo', sound: 'p√≠o p√≠o'}
            ];
            
            const current = animals[Math.floor(Math.random() * animals.length)];
            document.getElementById('animalImage').textContent = current.emoji;
            
            const optionsContainer = document.getElementById('animalOptions');
            optionsContainer.innerHTML = '';
            
            // Crear opciones
            let options = [current.name];
            while (options.length < 3) {
                const random = animals[Math.floor(Math.random() * animals.length)].name;
                if (!options.includes(random)) {
                    options.push(random);
                }
            }
            
            options.sort(() => Math.random() - 0.5);
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-info';
                btn.textContent = opt;
                btn.onclick = () => checkAnimalAnswer(opt, current.name);
                optionsContainer.appendChild(btn);
            });
            
            // Guardar el sonido actual
            window.currentAnimalSound = current.sound;
        }

        function playAnimalSound() {
            // Simulaci√≥n de sonido con texto
            const soundText = document.createElement('div');
            soundText.style.cssText = 'font-size: 2rem; font-weight: bold; color: #f093fb; animation: pulse 1s;';
            soundText.textContent = window.currentAnimalSound.toUpperCase();
            
            const gameArea = document.querySelector('#animalSoundsGame3 .game-area');
            const existing = gameArea.querySelector('.sound-text');
            if (existing) existing.remove();
            
            soundText.className = 'sound-text';
            gameArea.insertBefore(soundText, gameArea.firstChild);
            
            setTimeout(() => soundText.remove(), 2000);
        }

        function checkAnimalAnswer(selected, correct) {
            const feedback = document.getElementById('animalFeedback');
            
            if (selected === correct) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `‚úÖ ¬°Correcto! Es un ${correct}`;
                updateScore(10);
                
                setTimeout(() => {
                    initializeAnimalGame();
                    feedback.className = 'feedback-box';
                }, 2000);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚ùå No es ${selected}. Escucha otra vez el sonido.`;
            }
        }

        function closeAnimalSoundsGame() {
            document.getElementById('animalSoundsGame3').classList.add('hidden');
            markActivityComplete('animal-sounds-3');
        }

        // Juego de Partes del Cuerpo
        function startBodyParts3() {
            if (!checkAgeSelected()) return;
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üë∂ Mi Cuerpo</h3>
                    <div class="game-area" style="text-align: center;">
                        <div style="font-size: 8rem;">üë¶</div>
                        <p style="font-size: 1.3rem; font-weight: bold; margin: 1rem;">
                            Sim√≥n dice: ¬°Toca tu <span id="bodyPartTarget" style="color: #f093fb;">NARIZ</span>!
                        </p>
                        <div id="bodyPartsOptions" style="display: flex; justify-content: center; gap: 1rem; margin: 2rem 0;">
                            <button class="btn btn-info" onclick="checkBodyPart('cabeza')">üë§ Cabeza</button>
                            <button class="btn btn-info" onclick="checkBodyPart('ojos')">üëÄ Ojos</button>
                            <button class="btn btn-info" onclick="checkBodyPart('nariz')">üëÉ Nariz</button>
                            <button class="btn btn-info" onclick="checkBodyPart('boca')">üëÑ Boca</button>
                            <button class="btn btn-info" onclick="checkBodyPart('manos')">üëê Manos</button>
                            <button class="btn btn-info" onclick="checkBodyPart('pies')">üë£ Pies</button>
                        </div>
                    </div>
                    <div class="feedback-box" id="bodyPartsFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('body-parts-3')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="body-parts-3"]').parentElement.appendChild(container.firstElementChild);
            
            startSimonSays();
        }

        function startSimonSays() {
            const parts = ['cabeza', 'ojos', 'nariz', 'boca', 'manos', 'pies'];
            const target = parts[Math.floor(Math.random() * parts.length)];
            document.getElementById('bodyPartTarget').textContent = target.toUpperCase();
            window.currentBodyPart = target;
        }

        function checkBodyPart(selected) {
            const feedback = document.getElementById('bodyPartsFeedback');
            
            if (selected === window.currentBodyPart) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `‚úÖ ¬°Muy bien! Tocaste tu ${selected}`;
                updateScore(10);
                
                setTimeout(() => {
                    startSimonSays();
                    feedback.className = 'feedback-box';
                }, 1500);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚ùå Ese no es tu ${window.currentBodyPart}`;
            }
        }
      // JUEGOS PARA 4 A√ëOS

        // Constructor de Oraciones
        function startSentenceBuilder4() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('sentenceBuilder4').classList.remove('hidden');
            initializeSentenceBuilder();
        }

        function initializeSentenceBuilder() {
            const data = contentDatabase[4].sentences;
            
            // Crear una oraci√≥n objetivo
            const targetSentence = [
                data.subjects[Math.floor(Math.random() * data.subjects.length)],
                data.verbs[Math.floor(Math.random() * data.verbs.length)],
                'la',
                data.objects[Math.floor(Math.random() * data.objects.length)]
            ];
            
            window.targetSentence = targetSentence.join(' ');
            
            // Mezclar las palabras
            const mixedWords = [...targetSentence, 'el', 'un', 'con'].sort(() => Math.random() - 0.5);
            
            const wordBank = document.getElementById('availableWords');
            wordBank.innerHTML = '';
            
            mixedWords.forEach((word, index) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'drag-item';
                wordDiv.draggable = true;
                wordDiv.textContent = word;
                wordDiv.id = `word-${index}`;
                wordDiv.ondragstart = (e) => dragStart(e);
                wordBank.appendChild(wordDiv);
            });
            
            const sentenceZone = document.getElementById('sentenceZone');
            sentenceZone.innerHTML = '<p style="color: #999;">Arrastra las palabras aqu√≠ para formar una oraci√≥n</p>';
        }

        function checkSentence() {
            const sentenceZone = document.getElementById('sentenceZone');
            const words = Array.from(sentenceZone.querySelectorAll('.drag-item')).map(el => el.textContent);
            const formed = words.join(' ');
            
            const feedback = document.getElementById('sentenceFeedback');
            
            // Verificar si la oraci√≥n tiene sentido (simplificado)
            if (words.length >= 3 && words.length <= 5) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `‚úÖ ¬°Excelente! Formaste la oraci√≥n: "${formed}"`;
                updateScore(15);
                
                setTimeout(() => {
                    initializeSentenceBuilder();
                    feedback.className = 'feedback-box';
                }, 2000);
            } else if (words.length === 0) {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Arrastra palabras para formar una oraci√≥n';
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Intenta formar una oraci√≥n m√°s completa';
            }
        }

        function closeSentenceBuilder() {
            document.getElementById('sentenceBuilder4').classList.add('hidden');
            markActivityComplete('sentence-4');
        }

        // Juego de Preguntas
        function startQuestionGame4() {
            if (!checkAgeSelected()) return;
            
            const gameHTML = `
                <div class="game-container">
                    <h3>‚ùì ¬øQu√©? ¬øD√≥nde? ¬øCu√°ndo?</h3>
                    <div class="game-area">
                        <div style="text-align: center;">
                            <div style="font-size: 4rem; margin: 1rem;">üèñÔ∏è</div>
                            <p style="font-size: 1.2rem;">La familia fue a la playa el domingo</p>
                        </div>
                        <div style="margin: 2rem 0;">
                            <p style="font-weight: bold;">Responde las preguntas:</p>
                            <div class="quiz-question" style="margin: 1rem 0;">
                                <p>¬øD√ìNDE fue la familia?</p>
                                <div style="display: flex; gap: 1rem; margin: 1rem 0;">
                                    <button class="btn btn-info" onclick="checkQuestionAnswer('playa', true)">A la playa</button>
                                    <button class="btn btn-info" onclick="checkQuestionAnswer('parque', false)">Al parque</button>
                                    <button class="btn btn-info" onclick="checkQuestionAnswer('casa', false)">A casa</button>
                                </div>
                            </div>
                            <div class="quiz-question" style="margin: 1rem 0;">
                                <p>¬øCU√ÅNDO fueron?</p>
                                <div style="display: flex; gap: 1rem; margin: 1rem 0;">
                                    <button class="btn btn-info" onclick="checkQuestionAnswer('lunes', false)">El lunes</button>
                                    <button class="btn btn-info" onclick="checkQuestionAnswer('domingo', true)">El domingo</button>
                                    <button class="btn btn-info" onclick="checkQuestionAnswer('martes', false)">El martes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="feedback-box" id="questionFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('questions-4')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="questions-4"]').parentElement.appendChild(container.firstElementChild);
        }

        function checkQuestionAnswer(answer, isCorrect) {
            const feedback = document.getElementById('questionFeedback');
            
            if (isCorrect) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = '‚úÖ ¬°Correcto! Muy bien respondido';
                updateScore(10);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Intenta otra vez. Lee la oraci√≥n con atenci√≥n';
            }
        }

        // Juego de Secuencias
        function startSequenceGame4() {
            if (!checkAgeSelected()) return;
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üìÖ Ordena la Secuencia</h3>
                    <div class="game-area">
                        <p style="font-size: 1.2rem; font-weight: bold;">Ordena lo que hace Mar√≠a en la ma√±ana:</p>
                        <div id="sequenceItems" style="margin: 2rem 0;">
                            <div class="drag-item" draggable="true" data-order="3">üç≥ Desayuna</div>
                            <div class="drag-item" draggable="true" data-order="1">üõèÔ∏è Se levanta</div>
                            <div class="drag-item" draggable="true" data-order="4">üéí Va a la escuela</div>
                            <div class="drag-item" draggable="true" data-order="2">ü™• Se lava los dientes</div>
                        </div>
                        <div class="drop-zone" id="sequenceZone">
                            <p>Arrastra aqu√≠ en el orden correcto</p>
                        </div>
                        <button class="btn btn-success" onclick="checkSequence()">Verificar Orden</button>
                    </div>
                    <div class="feedback-box" id="sequenceFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('sequence-4')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="sequence-4"]').parentElement.appendChild(container.firstElementChild);
            
            // Inicializar drag and drop para esta actividad
            initializeSequenceDrag();
        }

        function initializeSequenceDrag() {
            const items = document.querySelectorAll('#sequenceItems .drag-item');
            const zone = document.getElementById('sequenceZone');
            
            items.forEach(item => {
                item.addEventListener('dragstart', dragStart);
            });
            
            zone.addEventListener('dragover', dragOver);
            zone.addEventListener('drop', drop);
        }

        function checkSequence() {
            const zone = document.getElementById('sequenceZone');
            const items = Array.from(zone.querySelectorAll('.drag-item'));
            const feedback = document.getElementById('sequenceFeedback');
            
            if (items.length !== 4) {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Arrastra todas las actividades';
                return;
            }
            
            const order = items.map(item => parseInt(item.dataset.order));
            const isCorrect = order.every((val, index) => val === index + 1);
            
            if (isCorrect) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = '‚úÖ ¬°Perfecto! Has ordenado correctamente la secuencia';
                updateScore(20);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå El orden no es correcto. Piensa: ¬øqu√© hace Mar√≠a primero?';
            }
        }

        // JUEGOS PARA 5 A√ëOS

        // Creador de Historias
        function startStoryCreator5() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('storyCreator5').classList.remove('hidden');
            initializeStoryCreator();
        }

        function initializeStoryCreator() {
            const elements = contentDatabase[5].storyElements;
            
            const imageBank = document.getElementById('imageBank');
            imageBank.innerHTML = '';
            
            // Crear elementos draggables
            const allElements = [
                ...elements.characters,
                ...elements.settings,
                { emoji: '‚ùì', text: 'problema' },
                { emoji: 'üí°', text: 'soluci√≥n' }
            ];
            
            allElements.forEach((element, index) => {
                const div = document.createElement('div');
                div.className = 'drag-item';
                div.draggable = true;
                div.id = `story-element-${index}`;
                div.textContent = typeof element === 'string' ? element : element.emoji;
                div.dataset.element = typeof element === 'string' ? element : element.text;
                div.ondragstart = dragStart;
                imageBank.appendChild(div);
            });
            
            // Limpiar zonas
            ['storyBeginning', 'storyMiddle', 'storyEnd'].forEach(id => {
                const zone = document.getElementById(id);
                zone.innerHTML = 'Arrastra una imagen aqu√≠';
                zone.ondragover = dragOver;
                zone.ondrop = drop;
            });
        }

        function tellStory() {
            const beginning = document.getElementById('storyBeginning').querySelector('.drag-item');
            const middle = document.getElementById('storyMiddle').querySelector('.drag-item');
            const end = document.getElementById('storyEnd').querySelector('.drag-item');
            
            const feedback = document.getElementById('storyFeedback');
            
            if (!beginning || !middle || !end) {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Completa todas las partes de la historia';
                return;
            }
            
            const story = `
                <strong>Tu historia:</strong><br>
                Hab√≠a una vez ${beginning.dataset.element}.<br>
                Un d√≠a, ${middle.dataset.element}.<br>
                Al final, ${end.dataset.element}.<br>
                ¬°Y todos fueron felices!
            `;
            
            feedback.className = 'feedback-box feedback-correct show';
            feedback.innerHTML = `‚úÖ ¬°Qu√© historia tan creativa!<br>${story}`;
            updateScore(25);
            
            markActivityComplete('create-story-5');
        }

        function closeStoryCreator() {
            document.getElementById('storyCreator5').classList.add('hidden');
        }

        // Juego de Descripci√≥n
        function startDescriptionGame5() {
            if (!checkAgeSelected()) return;
            
            const objects = ['üéà globo', 'üöó carro', 'üå≥ √°rbol', 'üìö libro', '‚öΩ pelota'];
            const selected = objects[Math.floor(Math.random() * objects.length)];
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üîç Describe y Adivina</h3>
                    <div class="game-area">
                        <div style="text-align: center;">
                            <div style="font-size: 5rem; margin: 1rem;">${selected.split(' ')[0]}</div>
                            <p style="font-size: 1.2rem;">Describe este objeto usando estas palabras:</p>
                            <div style="margin: 2rem 0;">
                                <span class="interactive-element">color</span>
                                <span class="interactive-element">tama√±o</span>
                                <span class="interactive-element">forma</span>
                                <span class="interactive-element">para qu√© sirve</span>
                                <span class="interactive-element">d√≥nde lo encuentras</span>
                            </div>
                            <textarea id="description" rows="4" style="width: 100%; padding: 1rem; border: 2px solid #667eea; border-radius: 10px;" 
                                placeholder="Escribe tu descripci√≥n aqu√≠..."></textarea>
                            <button class="btn btn-success" onclick="checkDescription('${selected}')">Verificar Descripci√≥n</button>
                        </div>
                    </div>
                    <div class="feedback-box" id="descriptionFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('describe-5')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="describe-5"]').parentElement.appendChild(container.firstElementChild);
        }

        function checkDescription(object) {
            const description = document.getElementById('description').value.toLowerCase();
            const feedback = document.getElementById('descriptionFeedback');
            
            const keywords = ['color', 'tama√±o', 'forma', 'sirve', 'encuentr'];
            const usedKeywords = keywords.filter(word => description.includes(word));
            
            if (description.length < 20) {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Tu descripci√≥n es muy corta. Agrega m√°s detalles';
            } else if (usedKeywords.length >= 3) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `‚úÖ ¬°Excelente descripci√≥n! Usaste ${usedKeywords.length} caracter√≠sticas`;
                updateScore(20);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚ùå Intenta usar m√°s caracter√≠sticas. Solo usaste ${usedKeywords.length}`;
            }
        }

        // Juego de Categor√≠as
        function startCategoryGame5() {
            if (!checkAgeSelected()) return;
            
            const categories = contentDatabase[5].categories;
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üì¶ Juego de Categor√≠as</h3>
                    <div class="game-area">
                        <p style="font-size: 1.2rem; font-weight: bold;">Arrastra cada palabra a su categor√≠a:</p>
                        
                        <div id="categoryWords" style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <!-- Palabras mezcladas -->
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 2rem 0;">
                            <div>
                                <h4>ü¶Å Animales</h4>
                                <div class="drop-zone" id="category-animals" data-category="animals">
                                    Arrastra aqu√≠
                                </div>
                            </div>
                            <div>
                                <h4>üöó Transporte</h4>
                                <div class="drop-zone" id="category-transport" data-category="transport">
                                    Arrastra aqu√≠
                                </div>
                            </div>
                            <div>
                                <h4>üëï Ropa</h4>
                                <div class="drop-zone" id="category-clothes" data-category="clothes">
                                    Arrastra aqu√≠
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-success" onclick="checkCategories()">Verificar</button>
                    </div>
                    <div class="feedback-box" id="categoryFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('category-5')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="category-5"]').parentElement.appendChild(container.firstElementChild);
            
            // Llenar con palabras
            const wordsContainer = document.getElementById('categoryWords');
            const allWords = [];
            
            for (let cat in categories) {
                categories[cat].slice(0, 2).forEach(word => {
                    allWords.push({ word: word, category: cat });
                });
            }
            
            allWords.sort(() => Math.random() - 0.5);
            
            allWords.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'drag-item';
                div.draggable = true;
                div.textContent = item.word;
                div.dataset.category = item.category;
                div.id = `cat-word-${index}`;
                div.ondragstart = dragStart;
                wordsContainer.appendChild(div);
            });
            
            // Configurar drop zones
            document.querySelectorAll('#category-animals, #category-transport, #category-clothes').forEach(zone => {
                zone.ondragover = dragOver;
                zone.ondrop = drop;
            });
        }

        function checkCategories() {
            const feedback = document.getElementById('categoryFeedback');
            let correct = 0;
            let total = 0;
            
            ['animals', 'transport', 'clothes'].forEach(cat => {
                const zone = document.getElementById(`category-${cat}`);
                const items = zone.querySelectorAll('.drag-item');
                
                items.forEach(item => {
                    total++;
                    if (item.dataset.category === cat) {
                        correct++;
                    }
                });
            });
            
            if (total === 0) {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Arrastra las palabras a sus categor√≠as';
            } else if (correct === total && total === 6) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = '‚úÖ ¬°Perfecto! Todas las palabras est√°n en su categor√≠a correcta';
                updateScore(30);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚ùå ${correct} de ${total} correctas. Revisa las categor√≠as`;
            }
        }
      // FUNCIONES DE CUENTOS INTERACTIVOS

        function startStory3_1() {
            if (!checkAgeSelected()) return;
            
            document.getElementById('interactiveStory3').classList.remove('hidden');
            storyPage = 0;
            loadStoryPage();
        }

        function startStory3_2() {
            if (!checkAgeSelected()) return;
            
            const storyHTML = `
                <div class="game-container">
                    <h3>üåô La Luna y las Estrellas - Completa el Cuento</h3>
                    <div class="game-area">
                        <div style="font-size: 1.1rem; line-height: 2;">
                            <p>La luna üåô brillaba en el <input type="text" placeholder="cielo" style="border-bottom: 2px solid #667eea; width: 100px;">.</p>
                            <p>Las estrellas ‚≠ê eran muy <input type="text" placeholder="brillantes" style="border-bottom: 2px solid #667eea; width: 100px;">.</p>
                            <p>El ni√±o las miraba desde su <input type="text" placeholder="ventana" style="border-bottom: 2px solid #667eea; width: 100px;">.</p>
                            <p>Y se qued√≥ <input type="text" placeholder="dormido" style="border-bottom: 2px solid #667eea; width: 100px;"> so√±ando.</p>
                        </div>
                        <button class="btn btn-success" onclick="checkStoryCompletion()">Verificar Cuento</button>
                    </div>
                    <div class="feedback-box" id="storyCompletionFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('story-3-2')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = storyHTML;
            document.querySelector('[data-activity="story-3-2"]').parentElement.appendChild(container.firstElementChild);
        }

        function loadStoryPage() {
            const story = contentDatabase[3].stories[0];
            const content = document.getElementById('storyContent');
            const interaction = document.getElementById('storyInteraction');
            
            if (storyPage < story.pages.length) {
                content.innerHTML = `
                    <div style="text-align: center;">
                        <p style="font-size: 1.5rem; margin: 2rem 0;">${story.pages[storyPage]}</p>
                    </div>
                `;
                
                // Agregar interacci√≥n seg√∫n la p√°gina
                if (storyPage === 1) {
                    interaction.innerHTML = `
                        <div style="text-align: center;">
                            <p>¬°Salta como el conejito!</p>
                            <button class="btn btn-warning" onclick="jumpLikeRabbit()">üê∞ SALTAR</button>
                        </div>
                    `;
                } else if (storyPage === 3) {
                    interaction.innerHTML = `
                        <div style="text-align: center;">
                            <p>Haz el sonido de comer:</p>
                            <button class="btn btn-warning" onclick="makeEatingSound()">ü•ï √ëAM √ëAM</button>
                        </div>
                    `;
                } else {
                    interaction.innerHTML = '';
                }
            }
        }

        function nextStoryPage() {
            storyPage++;
            if (storyPage >= contentDatabase[3].stories[0].pages.length) {
                closeStory();
                markActivityComplete('story-3-1');
                showNotification('üéâ ¬°Cuento completado!', 'success');
            } else {
                loadStoryPage();
            }
        }

        function closeStory() {
            document.getElementById('interactiveStory3').classList.add('hidden');
        }

        function jumpLikeRabbit() {
            const btn = event.target;
            btn.style.animation = 'bounce 0.5s';
            setTimeout(() => btn.style.animation = '', 500);
            updateScore(5);
            showNotification('üê∞ ¬°Hop! ¬°Hop!', 'success');
        }

        function makeEatingSound() {
            const btn = event.target;
            btn.textContent = '√ëAM √ëAM √ëAM!';
            setTimeout(() => btn.textContent = 'ü•ï √ëAM √ëAM', 1000);
            updateScore(5);
            showNotification('ü•ï ¬°Qu√© rico!', 'success');
        }

        function checkStoryCompletion() {
            const inputs = document.querySelectorAll('input[type="text"]');
            const filled = Array.from(inputs).filter(input => input.value.trim().length > 0);
            const feedback = document.getElementById('storyCompletionFeedback');
            
            if (filled.length === inputs.length) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = '‚úÖ ¬°Excelente! Completaste el cuento';
                updateScore(15);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚ùå Completa todas las palabras (${filled.length}/${inputs.length})`;
            }
        }

        // FUNCIONES DE CANCIONES

        function startSong3_1() {
            if (!checkAgeSelected()) return;
            
            const song = contentDatabase[3].songs[0];
            const songHTML = `
                <div class="game-container">
                    <h3>üéµ ${song.title}</h3>
                    <div class="game-area" style="text-align: center;">
                        <div style="background: #f8f9fa; padding: 2rem; border-radius: 10px; margin: 2rem 0;">
                            <pre style="font-size: 1.2rem; line-height: 2;">${song.lyrics}</pre>
                        </div>
                        <div style="margin: 2rem 0;">
                            <button class="btn btn-warning" onclick="playSongAnimation()">üé∂ Cantar y Bailar</button>
                        </div>
                        <p>Practica los n√∫meros del 1 al 10 con movimientos</p>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('song-3-1')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = songHTML;
            document.querySelector('[data-activity="song-3-1"]').parentElement.appendChild(container.firstElementChild);
        }

        function startSong3_2() {
            if (!checkAgeSelected()) return;
            
            const colors = ['üî¥ rojo', 'üü† naranja', 'üü° amarillo', 'üü¢ verde', 'üîµ azul', 'üü£ morado'];
            
            const songHTML = `
                <div class="game-container">
                    <h3>üåà El Arco√≠ris Musical</h3>
                    <div class="game-area">
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; margin: 2rem 0;">üåà</div>
                            <p style="font-size: 1.2rem;">Canta los colores del arco√≠ris:</p>
                            <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 1rem; margin: 2rem 0;">
                                ${colors.map(color => `
                                    <button class="interactive-element" onclick="singColor('${color}')">
                                        ${color}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        <div id="colorSong" style="text-align: center; font-size: 1.5rem; margin: 2rem 0;"></div>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('song-3-2')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = songHTML;
            document.querySelector('[data-activity="song-3-2"]').parentElement.appendChild(container.firstElementChild);
        }

        function playSongAnimation() {
            const btn = event.target;
            let count = 1;
            
            const interval = setInterval(() => {
                btn.textContent = `üéµ ${count} üéµ`;
                count++;
                if (count > 10) {
                    clearInterval(interval);
                    btn.textContent = 'üé∂ Cantar y Bailar';
                    updateScore(10);
                    showNotification('üéâ ¬°Bravo! Cantaste hasta el 10', 'success');
                }
            }, 500);
        }

        function singColor(color) {
            const display = document.getElementById('colorSong');
            display.textContent = `¬°${color.toUpperCase()}!`;
            display.style.color = color.split(' ')[1];
            
            setTimeout(() => {
                display.textContent = '';
            }, 1000);
            
            updateScore(2);
        }

        // FUNCIONES PARA ACTIVIDADES DIARIAS

        function startDailyActivity3() {
            if (!checkAgeSelected()) return;
            
            const foods = contentDatabase[3].vocabulary.foods;
            
            const activityHTML = `
                <div class="game-container">
                    <h3>üçé Hora de la Merienda</h3>
                    <div class="game-area">
                        <p style="font-size: 1.2rem; text-align: center;">¬øQu√© quieres comer hoy?</p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 2rem 0;">
                            ${foods.map(food => {
                                const emoji = {
                                    'manzana': 'üçé',
                                    'pl√°tano': 'üçå',
                                    'leche': 'ü•õ',
                                    'pan': 'üçû',
                                    'agua': 'üíß',
                                    'galleta': 'üç™'
                                }[food];
                                return `
                                    <div class="interactive-element" onclick="selectFood('${food}', '${emoji}')">
                                        <div style="font-size: 2rem;">${emoji}</div>
                                        <div>${food}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div id="mealPlan" style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                            <p><strong>Mi merienda:</strong></p>
                            <div id="selectedFoods"></div>
                        </div>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('daily-3')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = activityHTML;
            document.querySelector('[data-activity="daily-3"]').parentElement.appendChild(container.firstElementChild);
        }

        function selectFood(food, emoji) {
            const selected = document.getElementById('selectedFoods');
            selected.innerHTML += `<span style="margin: 0.5rem;">${emoji} ${food}</span>`;
            updateScore(5);
            showNotification(`‚úÖ Agregaste ${food} a tu merienda`, 'success');
        }

        // FUNCIONES ADICIONALES PARA 4 A√ëOS

        function startComprehensionStory4() {
            if (!checkAgeSelected()) return;
            
            const storyHTML = `
                <div class="game-container">
                    <h3>ü¶Å El Le√≥n y el Rat√≥n</h3>
                    <div class="game-area">
                        <div style="background: #f8f9fa; padding: 2rem; border-radius: 10px;">
                            <p style="font-size: 1.1rem; line-height: 1.8;">
                                Un d√≠a, un rat√≥n peque√±o üê≠ pas√≥ cerca de un le√≥n dormido ü¶Å.<br>
                                El le√≥n se despert√≥ y atrap√≥ al rat√≥n.<br>
                                "Por favor, no me comas", dijo el rat√≥n. "Un d√≠a te ayudar√©".<br>
                                El le√≥n se ri√≥ pero lo dej√≥ ir.<br>
                                D√≠as despu√©s, el le√≥n qued√≥ atrapado en una red.<br>
                                El rat√≥n vino y mordi√≥ la red hasta liberarlo.<br>
                                "Gracias, peque√±o amigo", dijo el le√≥n.
                            </p>
                        </div>
                    </div>
                    <button class="btn btn-warning" onclick="startComprehensionQuiz()">Responder Preguntas</button>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('comp-story-4')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = storyHTML;
            document.querySelector('[data-activity="comp-story-4"]').parentElement.appendChild(container.firstElementChild);
        }

        function startComprehensionQuiz() {
            document.getElementById('comprehensionQuiz4').classList.remove('hidden');
            currentQuizQuestion = 0;
            loadQuizQuestion();
        }

        function loadQuizQuestion() {
            const questions = [
                {
                    question: "¬øQui√©n qued√≥ atrapado primero?",
                    options: ["El rat√≥n", "El le√≥n", "Nadie"],
                    correct: 0
                },
                {
                    question: "¬øC√≥mo ayud√≥ el rat√≥n al le√≥n?",
                    options: ["Le trajo comida", "Mordi√≥ la red", "Llam√≥ ayuda"],
                    correct: 1
                },
                {
                    question: "¬øQu√© aprendemos del cuento?",
                    options: ["Los peque√±os pueden ayudar", "Los leones son malos", "Los ratones son r√°pidos"],
                    correct: 0
                }
            ];
            
            if (currentQuizQuestion < questions.length) {
                const q = questions[currentQuizQuestion];
                document.getElementById('quizQuestion').textContent = q.question;
                
                const optionsHTML = q.options.map((opt, idx) => `
                    <div class="quiz-option" onclick="checkQuizAnswer(${idx}, ${q.correct})">
                        ${opt}
                    </div>
                `).join('');
                
                document.getElementById('quizOptions').innerHTML = optionsHTML;
            }
        }

        function checkQuizAnswer(selected, correct) {
            const feedback = document.getElementById('quizFeedback');
            
            if (selected === correct) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = '‚úÖ ¬°Correcto!';
                updateScore(10);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Intenta otra vez';
            }
        }

        function nextQuizQuestion() {
            currentQuizQuestion++;
            if (currentQuizQuestion >= 3) {
                closeQuiz();
                showNotification('üéâ ¬°Quiz completado!', 'success');
            } else {
                loadQuizQuestion();
                document.getElementById('quizFeedback').className = 'feedback-box';
            }
        }

        function closeQuiz() {
            document.getElementById('comprehensionQuiz4').classList.add('hidden');
        }

        // FUNCIONES DE RIMAS Y TRABALENGUAS (4 A√ëOS)

        function startRhymeGame4() {
            if (!checkAgeSelected()) return;
            
            const rhymes = contentDatabase[4].rhymes.words;
            const current = rhymes[Math.floor(Math.random() * rhymes.length)];
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üé™ Encuentra la Rima</h3>
                    <div class="game-area">
                        <div style="text-align: center;">
                            <p style="font-size: 2rem; margin: 2rem 0;">
                                Encuentra palabras que rimen con: <strong>${current.word}</strong>
                            </p>
                            <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                                ${current.rhymes.map(rhyme => `
                                    <button class="interactive-element" onclick="checkRhyme('${rhyme}', true)">
                                        ${rhyme}
                                    </button>
                                `).join('')}
                                <button class="interactive-element" onclick="checkRhyme('mesa', false)">
                                    mesa
                                </button>
                                <button class="interactive-element" onclick="checkRhyme('libro', false)">
                                    libro
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="feedback-box" id="rhymeFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('rhyme-4')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="rhyme-4"]').parentElement.appendChild(container.firstElementChild);
        }

        function checkRhyme(word, isRhyme) {
            const feedback = document.getElementById('rhymeFeedback');
            
            if (isRhyme) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `‚úÖ ¬°S√≠! "${word}" rima perfectamente`;
                updateScore(10);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚ùå "${word}" no rima. Busca palabras con el mismo sonido final`;
            }
        }

        function startTongueTwister4() {
            if (!checkAgeSelected()) return;
            
            const twisters = contentDatabase[4].tongueTwisters;
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üëÖ Trabalenguas F√°ciles</h3>
                    <div class="game-area">
                        <div style="text-align: center;">
                            ${twisters.map((twister, idx) => `
                                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                                    <p style="font-size: 1.3rem; font-weight: bold;">${twister}</p>
                                    <button class="btn btn-info" onclick="practiceTwister(${idx})">
                                        üé§ Practicar
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <div id="twisterFeedback" style="text-align: center; margin: 2rem 0;"></div>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('tongue-4')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="tongue-4"]').parentElement.appendChild(container.firstElementChild);
        }

        function practiceTwister(index) {
            const feedback = document.getElementById('twisterFeedback');
            feedback.innerHTML = `
                <div class="alert alert-success">
                    ¬°Excelente pr√°ctica! Intenta decirlo m√°s r√°pido cada vez üöÄ
                </div>
            `;
            updateScore(10);
        }

        // FUNCIONES ADICIONALES PARA 5 A√ëOS

        function startDialogGame5() {
            if (!checkAgeSelected()) return;
            
            const dialogHTML = `
                <div class="game-container">
                    <h3>üí¨ Practica Conversaciones</h3>
                    <div class="game-area">
                        <p style="font-size: 1.2rem; text-align: center;">Elige un escenario para practicar:</p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 2rem 0;">
                            <div class="interactive-element" onclick="startDialog('tienda')">
                                üè™ En la Tienda
                            </div>
                            <div class="interactive-element" onclick="startDialog('doctor')">
                                üè• En el Doctor
                            </div>
                            <div class="interactive-element" onclick="startDialog('escuela')">
                                üè´ En la Escuela
                            </div>
                            <div class="interactive-element" onclick="startDialog('restaurante')">
                                üçΩÔ∏è En el Restaurante
                            </div>
                        </div>
                        <div id="dialogArea" style="display: none;">
                            <!-- √Årea de di√°logo -->
                        </div>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('dialog-5')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = dialogHTML;
            document.querySelector('[data-activity="dialog-5"]').parentElement.appendChild(container.firstElementChild);
        }

        function startDialog(scenario) {
            const dialogArea = document.getElementById('dialogArea');
            
            const dialogs = {
                tienda: [
                    "Cliente: Buenos d√≠as, ¬øtiene manzanas?",
                    "Vendedor: S√≠, tenemos manzanas rojas y verdes",
                    "Cliente: ¬øCu√°nto cuestan?",
                    "Vendedor: 2 pesos cada una"
                ],
                doctor: [
                    "Doctor: ¬øQu√© te duele?",
                    "Paciente: Me duele la garganta",
                    "Doctor: Abre la boca y di 'Ahhh'",
                    "Paciente: Ahhhhh"
                ],
                escuela: [
                    "Profesor: ¬øHiciste la tarea?",
                    "Estudiante: S√≠, est√° en mi mochila",
                    "Profesor: Muy bien, s√°cala por favor",
                    "Estudiante: Aqu√≠ est√°"
                ],
                restaurante: [
                    "Mesero: ¬øQu√© desea ordenar?",
                    "Cliente: Quiero espagueti, por favor",
                    "Mesero: ¬øAlgo de beber?",
                    "Cliente: Jugo de naranja, gracias"
                ]
            };
            
            dialogArea.style.display = 'block';
            dialogArea.innerHTML = `
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                    <h4>Practica este di√°logo:</h4>
                    ${dialogs[scenario].map((line, idx) => `
                        <p style="margin: 0.5rem 0; ${idx % 2 === 0 ? 'text-align: left;' : 'text-align: right; color: #667eea;'}">
                            ${line}
                        </p>
                    `).join('')}
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-success" onclick="completeDialog()">
                        ‚úÖ Practiqu√© el Di√°logo
                    </button>
                </div>
            `;
        }

        function completeDialog() {
            updateScore(15);
            showNotification('üé≠ ¬°Excelente pr√°ctica de conversaci√≥n!', 'success');
        }

        function startOppositeGame5() {
            if (!checkAgeSelected()) return;
            
            const opposites = contentDatabase[5].opposites;
            
            const gameHTML = `
                <div class="game-container">
                    <h3>‚ÜîÔ∏è Encuentra el Opuesto</h3>
                    <div class="game-area">
                        ${opposites.map((pair, idx) => `
                            <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 10px;">
                                <p style="font-size: 1.2rem;">
                                    ${pair.word} ‚ÜîÔ∏è 
                                    <input type="text" id="opposite-${idx}" placeholder="escribe el opuesto" 
                                           style="border-bottom: 2px solid #667eea; width: 150px;">
                                </p>
                            </div>
                        `).join('')}
                        <button class="btn btn-success" onclick="checkOpposites()">Verificar Respuestas</button>
                    </div>
                    <div class="feedback-box" id="oppositesFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('opposite-5')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="opposite-5"]').parentElement.appendChild(container.firstElementChild);
        }

        function checkOpposites() {
            const opposites = contentDatabase[5].opposites;
            let correct = 0;
            
            opposites.forEach((pair, idx) => {
                const input = document.getElementById(`opposite-${idx}`);
                if (input.value.toLowerCase().trim() === pair.opposite) {
                    correct++;
                    input.style.borderColor = '#28a745';
                } else {
                    input.style.borderColor = '#dc3545';
                }
            });
            
            const feedback = document.getElementById('oppositesFeedback');
            
            if (correct === opposites.length) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = '‚úÖ ¬°Perfecto! Conoces todos los opuestos';
                updateScore(25);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚úÖ ${correct}/${opposites.length} correctos. Sigue intentando`;
            }
        }

        // SISTEMA DE UTILIDADES

        function initializeDragAndDrop() {
            // Configuraci√≥n global de drag and drop
            document.addEventListener('DOMContentLoaded', () => {
                // Se inicializa cuando se necesita
            });
        }

        function dragStart(e) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
            e.dataTransfer.setData('elementId', e.target.id);
            e.target.classList.add('dragging');
        }

        function dragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
            return false;
        }

        function drop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.preventDefault();
            
            const elementId = e.dataTransfer.getData('elementId');
            const draggedElement = document.getElementById(elementId);
            
            if (draggedElement && e.currentTarget.classList.contains('drop-zone')) {
                // Si es zona de p√°rrafo, agregar al contenido existente
                if (e.currentTarget.id === 'sentenceZone') {
                    if (e.currentTarget.querySelector('p')) {
                        e.currentTarget.querySelector('p').remove();
                    }
                    e.currentTarget.appendChild(draggedElement.cloneNode(true));
                } else {
                    e.currentTarget.innerHTML = '';
                    e.currentTarget.appendChild(draggedElement.cloneNode(true));
                }
            }
            
            e.currentTarget.classList.remove('drag-over');
            
            // Remover clase dragging
            const dragging = document.querySelector('.dragging');
            if (dragging) {
                dragging.classList.remove('dragging');
            }
            
            return false;
        }

        function checkAgeSelected() {
            if (!selectedAge) {
                showNotification('‚ö†Ô∏è Por favor, selecciona primero la edad de tu hijo', 'warning');
                return false;
            }
            return true;
        }

        function markActivityComplete(activityId) {
            const card = document.querySelector(`[data-activity="${activityId}"]`);
            if (card && !card.classList.contains('completed')) {
                card.classList.add('completed');
                completedActivities.add(activityId);
                updateProgress();
                checkAchievements();
                saveProgress();
            }
        }

        function updateScore(points) {
            currentScore += points;
            showNotification(`+${points} puntos`, 'success');
        }

        function updateProgress() {
            const progress = (completedActivities.size / totalActivities) * 100;
            
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const activitiesText = document.getElementById('activitiesCompleted');
            
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
            if (progressText) {
                progressText.textContent = Math.round(progress) + '% completado';
            }
            if (activitiesText) {
                activitiesText.textContent = `${completedActivities.size} de ${totalActivities} actividades`;
            }
            
            // Habilitar evaluaci√≥n final si se completaron suficientes actividades
            if (completedActivities.size >= 8) {
                const finalBtn = document.getElementById('finalQuizBtn');
                if (finalBtn) {
                    finalBtn.disabled = false;
                    finalBtn.textContent = 'üèÜ Comenzar Evaluaci√≥n Final (Desbloqueado)';
                }
            }
            
            // Completar m√≥dulo si todas las actividades est√°n hechas
            if (completedActivities.size >= totalActivities) {
                completeModule();
            }
        }

        function checkAchievements() {
            const completed = completedActivities.size;
            
            // Primera actividad
            if (completed >= 1 && !achievements.has('first')) {
              achievements.add('first');
                document.getElementById('badge1').classList.add('unlocked');
                showNotification('üéØ ¬°Logro desbloqueado: Primera Actividad!', 'success');
            }
            
            // 5 Juegos
            if (completed >= 5 && !achievements.has('games')) {
                achievements.add('games');
                document.getElementById('badge2').classList.add('unlocked');
                showNotification('üéÆ ¬°Logro desbloqueado: 5 Juegos Completados!', 'success');
            }
            
            // Maestro Musical (completar todas las canciones)
            const songActivities = ['song-3-1', 'song-3-2'];
            const songsCompleted = songActivities.every(act => completedActivities.has(act));
            if (songsCompleted && !achievements.has('music')) {
                achievements.add('music');
                document.getElementById('badge3').classList.add('unlocked');
                showNotification('üéµ ¬°Logro desbloqueado: Maestro Musical!', 'success');
            }
            
            // Contador de Cuentos (completar todos los cuentos)
            const storyActivities = ['story-3-1', 'story-3-2', 'comp-story-4', 'create-story-5'];
            const storiesCompleted = storyActivities.filter(act => completedActivities.has(act)).length >= 2;
            if (storiesCompleted && !achievements.has('stories')) {
                achievements.add('stories');
                document.getElementById('badge4').classList.add('unlocked');
                showNotification('üìö ¬°Logro desbloqueado: Contador de Cuentos!', 'success');
            }
            
            // M√≥dulo Completo
            if (completed >= totalActivities && !achievements.has('complete')) {
                achievements.add('complete');
                document.getElementById('badge5').classList.add('unlocked');
                showNotification('üèÜ ¬°Logro desbloqueado: M√≥dulo Completo!', 'success');
            }
        }

        // EVALUACI√ìN FINAL

        function startFinalQuiz() {
            if (!checkAgeSelected()) {
                showNotification('‚ö†Ô∏è Selecciona la edad de tu hijo primero', 'warning');
                return;
            }
            
            if (completedActivities.size < 8) {
                showNotification('‚ö†Ô∏è Completa al menos 8 actividades primero', 'warning');
                return;
            }
            
            document.getElementById('finalQuizContainer').classList.remove('hidden');
            initializeFinalQuiz();
            startQuizTimer();
        }

        function initializeFinalQuiz() {
            const questions = getFinalQuizQuestions();
            window.finalQuizQuestions = questions;
            window.finalQuizAnswers = [];
            window.currentFinalQuestion = 0;
            
            loadFinalQuestion();
        }

        function getFinalQuizQuestions() {
            const questions = {
                3: [
                    {
                        question: "¬øCu√°l es el color del sol?",
                        options: ["Azul", "Amarillo", "Verde", "Rojo"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© animal hace 'miau'?",
                        options: ["Perro", "Vaca", "Gato", "Pato"],
                        correct: 2
                    },
                    {
                        question: "¬øCu√°ntas manos tienes?",
                        options: ["Una", "Dos", "Tres", "Cuatro"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© comes en el desayuno?",
                        options: ["Cena", "Almuerzo", "Pan y leche", "Dormir"],
                        correct: 2
                    },
                    {
                        question: "¬øD√≥nde viven los peces?",
                        options: ["En el agua", "En el √°rbol", "En la casa", "En el cielo"],
                        correct: 0
                    }
                ],
                4: [
                    {
                        question: "Completa: 'El perro ___ en el parque'",
                        options: ["corre", "vuela", "nada", "duerme"],
                        correct: 0
                    },
                    {
                        question: "¬øQu√© va primero: desayuno o almuerzo?",
                        options: ["Almuerzo", "Desayuno", "Cena", "Merienda"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°l palabra rima con 'gato'?",
                        options: ["Perro", "Pato", "Casa", "√Årbol"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© usas para escribir?",
                        options: ["Cuchara", "L√°piz", "Plato", "Zapato"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°ntos d√≠as tiene una semana?",
                        options: ["5", "6", "7", "8"],
                        correct: 2
                    }
                ],
                5: [
                    {
                        question: "¬øCu√°l es el opuesto de 'grande'?",
                        options: ["Alto", "Peque√±o", "Gordo", "Largo"],
                        correct: 1
                    },
                    {
                        question: "¬øEn qu√© categor√≠a va 'le√≥n'?",
                        options: ["Transporte", "Animales", "Comida", "Ropa"],
                        correct: 1
                    },
                    {
                        question: "Ordena: 'ni√±o El juega pelota la con'",
                        options: [
                            "La pelota juega con el ni√±o",
                            "El ni√±o juega con la pelota",
                            "Con la pelota el ni√±o juega",
                            "Juega el ni√±o la pelota con"
                        ],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© emoci√≥n sientes cuando recibes un regalo?",
                        options: ["Triste", "Enojado", "Feliz", "Asustado"],
                        correct: 2
                    },
                    {
                        question: "¬øCu√°l es el final t√≠pico de un cuento?",
                        options: [
                            "Hab√≠a una vez",
                            "Y color√≠n colorado",
                            "En un lugar lejano",
                            "√ârase una vez"
                        ],
                        correct: 1
                    }
                ]
            };
            
            return questions[selectedAge] || questions[3];
        }

        function loadFinalQuestion() {
            const question = window.finalQuizQuestions[window.currentFinalQuestion];
            const container = document.getElementById('finalQuestion');
            
            container.innerHTML = `
                <p style="font-size: 1.2rem; font-weight: bold;">
                    Pregunta ${window.currentFinalQuestion + 1} de ${window.finalQuizQuestions.length}
                </p>
                <p style="font-size: 1.1rem; margin: 1rem 0;">${question.question}</p>
                <div class="quiz-options">
                    ${question.options.map((opt, idx) => `
                        <div class="quiz-option" onclick="selectFinalAnswer(${idx})">
                            ${opt}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function selectFinalAnswer(index) {
            // Guardar respuesta
            window.finalQuizAnswers[window.currentFinalQuestion] = index;
            
            // Marcar opci√≥n seleccionada
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelectorAll('.quiz-option')[index].classList.add('selected');
            
            // Avanzar autom√°ticamente despu√©s de 1 segundo
            setTimeout(() => {
                window.currentFinalQuestion++;
                if (window.currentFinalQuestion < window.finalQuizQuestions.length) {
                    loadFinalQuestion();
                } else {
                    submitFinalQuiz();
                }
            }, 1000);
        }

        function startQuizTimer() {
            let timeLeft = 300; // 5 minutos
            
            quizTimer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                const display = document.getElementById('quizTimer');
                if (display) {
                    display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                if (timeLeft <= 0) {
                    clearInterval(quizTimer);
                    submitFinalQuiz();
                }
            }, 1000);
        }

        function submitFinalQuiz() {
            clearInterval(quizTimer);
            
            // Calcular puntuaci√≥n
            let correct = 0;
            window.finalQuizQuestions.forEach((q, idx) => {
                if (window.finalQuizAnswers[idx] === q.correct) {
                    correct++;
                }
            });
            
            const percentage = (correct / window.finalQuizQuestions.length) * 100;
            
            const feedback = document.getElementById('finalFeedback');
            feedback.className = 'feedback-box show';
            
            if (percentage >= 80) {
                feedback.classList.add('feedback-correct');
                feedback.innerHTML = `
                    <h3>üéâ ¬°EXCELENTE!</h3>
                    <p>Puntuaci√≥n: ${correct}/${window.finalQuizQuestions.length} (${Math.round(percentage)}%)</p>
                    <p>Has dominado las actividades de estimulaci√≥n del lenguaje para ${selectedAge} a√±os.</p>
                `;
                
                // Marcar m√≥dulo como completado
                completeModule();
            } else if (percentage >= 60) {
                feedback.classList.add('feedback-correct');
                feedback.innerHTML = `
                    <h3>üëç ¬°Muy Bien!</h3>
                    <p>Puntuaci√≥n: ${correct}/${window.finalQuizQuestions.length} (${Math.round(percentage)}%)</p>
                    <p>Buen trabajo. Practica un poco m√°s las actividades.</p>
                `;
            } else {
                feedback.classList.add('feedback-incorrect');
                feedback.innerHTML = `
                    <h3>üìö Sigue Practicando</h3>
                    <p>Puntuaci√≥n: ${correct}/${window.finalQuizQuestions.length} (${Math.round(percentage)}%)</p>
                    <p>Te recomendamos repasar las actividades antes de continuar.</p>
                `;
            }
            
            // Ocultar el contenedor del quiz despu√©s de mostrar resultados
            setTimeout(() => {
                document.getElementById('finalQuizContainer').innerHTML = feedback.outerHTML;
            }, 1000);
        }

        // FUNCIONES DE SISTEMA

        function completeModule() {
            // Mostrar botones de navegaci√≥n
            document.getElementById('certificateBtn').style.display = 'inline-block';
            document.getElementById('nextModuleBtn').style.display = 'inline-block';
            
            // Actualizar progreso del curso
            let courseProgress = JSON.parse(localStorage.getItem('courseProgress') || '[false,false,false,false,false]');
            courseProgress[2] = true; // M√≥dulo 3 completado
            localStorage.setItem('courseProgress', JSON.stringify(courseProgress));
            
            // Logro final
            if (!achievements.has('complete')) {
                achievements.add('complete');
                document.getElementById('badge5').classList.add('unlocked');
            }
            
            showNotification('üéâ ¬°FELICITACIONES! Has completado el M√≥dulo 3', 'success');
            
            setTimeout(() => {
                alert(`
üèÜ ¬°M√≥dulo 3 Completado!

‚úÖ Has explorado ${completedActivities.size} actividades
‚úÖ Dominas juegos para ${selectedAge} a√±os
‚úÖ Conoces canciones y cuentos educativos
‚úÖ Puedes crear actividades personalizadas

¬°Contin√∫a al M√≥dulo 4 para identificar dificultades comunes!
                `);
            }, 1000);
        }

        function generateCertificate() {
            const userName = prompt('¬øCu√°l es tu nombre para el certificado?') || 'Estudiante';
            const currentDate = new Date().toLocaleDateString('es-ES');
            
            const certificate = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                    ‚ïë
‚ïë         üèÜ CERTIFICADO DE COMPLETACI√ìN üèÜ          ‚ïë
‚ïë                                                    ‚ïë
‚ïë      ESTIMULACI√ìN DEL LENGUAJE INFANTIL           ‚ïë
‚ïë                                                    ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                    ‚ïë
‚ïë  Certificamos que:                                 ‚ïë
‚ïë                                                    ‚ïë
‚ïë            ${userName.toUpperCase().padEnd(40, ' ')}‚ïë
‚ïë                                                    ‚ïë
‚ïë  Ha completado exitosamente el M√ìDULO 3:          ‚ïë
‚ïë                                                    ‚ïë
‚ïë        "ACTIVIDADES Y JUEGOS"                     ‚ïë
‚ïë                                                    ‚ïë
‚ïë  Competencias Adquiridas:                         ‚ïë
‚ïë  ‚úÖ Juegos de vocabulario y construcci√≥n          ‚ïë
‚ïë  ‚úÖ Cuentos interactivos por edad                 ‚ïë
‚ïë  ‚úÖ Canciones educativas                          ‚ïë
‚ïë  ‚úÖ Actividades de la vida diaria                 ‚ïë
‚ïë  ‚úÖ Ejercicios de comprensi√≥n y creatividad       ‚ïë
‚ïë                                                    ‚ïë
‚ïë  Edad trabajada: ${(selectedAge ? selectedAge + ' a√±os' : 'General').padEnd(32, ' ')}‚ïë
‚ïë  Actividades completadas: ${completedActivities.size.toString().padEnd(24, ' ')}‚ïë
‚ïë  Puntuaci√≥n total: ${currentScore.toString().padEnd(31, ' ')}‚ïë
‚ïë                                                    ‚ïë
‚ïë  Fecha: ${currentDate.padEnd(43, ' ')}‚ïë
‚ïë                                                    ‚ïë
‚ïë  ID Certificado: MOD3-${Date.now()}      ‚ïë
‚ïë                                                    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            `;
            
            // Crear y descargar el archivo
            const blob = new Blob([certificate], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Certificado_Modulo3_${userName.replace(/\s/g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üéâ Certificado descargado exitosamente', 'success');
        }

        function showProgress() {
            const progress = (completedActivities.size / totalActivities) * 100;
            
            let activitiesList = Array.from(completedActivities).join('\n‚Ä¢ ') || 'Ninguna a√∫n';
            let achievementsList = Array.from(achievements).join(', ') || 'Ninguno a√∫n';
            
            const progressMessage = `
üìä TU PROGRESO EN M√ìDULO 3:

üìà Progreso general: ${Math.round(progress)}%
üéÆ Actividades completadas: ${completedActivities.size} de ${totalActivities}
üë∂ Edad seleccionada: ${selectedAge ? selectedAge + ' a√±os' : 'No seleccionada'}
üéØ Puntuaci√≥n total: ${currentScore} puntos

üèÜ Logros desbloqueados:
${achievementsList}

üìö Actividades realizadas:
- ${activitiesList}

${progress === 100 ? 'üéâ ¬°M√ìDULO COMPLETADO! Descarga tu certificado.' : 'üí™ ¬°Sigue jugando y aprendiendo!'}
            `;
            
            alert(progressMessage);
        }

        function saveProgress() {
            const progress = {
                selectedAge: selectedAge,
                completedActivities: Array.from(completedActivities),
                achievements: Array.from(achievements),
                currentScore: currentScore,
                lastAccess: new Date().toISOString()
            };
            
            localStorage.setItem('module3Progress', JSON.stringify(progress));
        }

        function loadSavedProgress() {
            try {
                const saved = localStorage.getItem('module3Progress');
                if (saved) {
                    const progress = JSON.parse(saved);
                    
                    // Restaurar edad
                    if (progress.selectedAge) {
                        selectedAge = progress.selectedAge;
                        setTimeout(() => {
                            const ageBtn = document.querySelector(`.age-btn[onclick*="${selectedAge}"]`);
                            if (ageBtn) {
                                ageBtn.click();
                            }
                        }, 500);
                    }
                    
                    // Restaurar actividades completadas
                    if (progress.completedActivities && Array.isArray(progress.completedActivities)) {
                        progress.completedActivities.forEach(activity => {
                            completedActivities.add(activity);
                            const card = document.querySelector(`[data-activity="${activity}"]`);
                            if (card) {
                                card.classList.add('completed');
                            }
                        });
                    }
                    
                    // Restaurar logros
                    if (progress.achievements && Array.isArray(progress.achievements)) {
                        progress.achievements.forEach(achievement => {
                            achievements.add(achievement);
                        });
                        
                        // Actualizar badges visualmente
                        achievements.forEach(ach => {
                            const badgeMap = {
                                'first': 'badge1',
                                'games': 'badge2',
                                'music': 'badge3',
                                'stories': 'badge4',
                                'complete': 'badge5'
                            };
                            
                            if (badgeMap[ach]) {
                                const badge = document.getElementById(badgeMap[ach]);
                                if (badge) {
                                    badge.classList.add('unlocked');
                                }
                            }
                        });
                    }
                    
                    // Restaurar puntuaci√≥n
                    if (progress.currentScore) {
                        currentScore = progress.currentScore;
                    }
                    
                    // Actualizar interfaz
                    updateProgress();
                    
                    // Mostrar botones si est√° completo
                    if (completedActivities.size >= totalActivities) {
                        document.getElementById('certificateBtn').style.display = 'inline-block';
                        document.getElementById('nextModuleBtn').style.display = 'inline-block';
                    }
                }
            } catch (error) {
                console.error('Error cargando progreso:', error);
            }
        }

        function logout() {
            if (confirm('¬øEst√°s seguro que quieres salir? Tu progreso se guardar√° autom√°ticamente.')) {
                saveProgress();
                window.location.href = '../index.html';
            }
        }

        function showNotification(message, type = 'info') {
            // Remover notificaciones existentes
            const existingNotifications = document.querySelectorAll('.notification-custom');
            existingNotifications.forEach(notif => notif.remove());
            
            // Crear nueva notificaci√≥n
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} notification-custom`;
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                max-width: 400px;
                animation: slideInNotification 0.3s ease;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            `;
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            // Auto-ocultar despu√©s de 3 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOutNotification 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }

        // Agregar estilos de animaci√≥n
        if (!document.getElementById('notification-styles')) {
            const style = document.createElement('style');
            style.id = 'notification-styles';
            style.textContent = `
                @keyframes slideInNotification {
                    from { 
                        transform: translateX(100%); 
                        opacity: 0; 
                    }
                    to { 
                        transform: translateX(0); 
                        opacity: 1; 
                    }
                }
                @keyframes slideOutNotification {
                    from { 
                        transform: translateX(0); 
                        opacity: 1; 
                    }
                    to { 
                        transform: translateX(100%); 
                        opacity: 0; 
                    }
                }
                .notification-custom {
                    transition: all 0.3s ease;
                }
            `;
            document.head.appendChild(style);
        }

        // Funci√≥n adicional para juegos de analog√≠as (5 a√±os)
        function startAnalogiesGame5() {
            if (!checkAgeSelected()) return;
            
            const analogies = [
                {
                    text: "P√°jaro es a volar como pez es a ___",
                    answer: "nadar",
                    options: ["caminar", "nadar", "correr", "saltar"]
                },
                {
                    text: "D√≠a es a sol como noche es a ___",
                    answer: "luna",
                    options: ["estrella", "sol", "luna", "nube"]
                },
                {
                    text: "Fr√≠o es a invierno como calor es a ___",
                    answer: "verano",
                    options: ["primavera", "verano", "oto√±o", "lluvia"]
                }
            ];
            
            const current = analogies[Math.floor(Math.random() * analogies.length)];
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üîó Analog√≠as Simples</h3>
                    <div class="game-area">
                        <p style="font-size: 1.3rem; text-align: center; margin: 2rem 0;">
                            ${current.text}
                        </p>
                        <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                            ${current.options.map(opt => `
                                <button class="interactive-element" onclick="checkAnalogy('${opt}', '${current.answer}')">
                                    ${opt}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="feedback-box" id="analogyFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('analogies-5')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="analogies-5"]').parentElement.appendChild(container.firstElementChild);
        }

        function checkAnalogy(selected, correct) {
            const feedback = document.getElementById('analogyFeedback');
            
            if (selected === correct) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = '‚úÖ ¬°Correcto! Entiendes las relaciones l√≥gicas';
                updateScore(20);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = '‚ùå Piensa en la relaci√≥n entre las primeras palabras';
            }
        }

        // Funciones para juegos de roles y emociones (5 a√±os)
        function startRolePlay5() {
            if (!checkAgeSelected()) return;
            
            const roles = [
                { emoji: 'üë®‚Äç‚öïÔ∏è', role: 'Doctor', action: 'Examinar pacientes' },
                { emoji: 'üë©‚Äçüè´', role: 'Profesor', action: 'Ense√±ar la clase' },
                { emoji: 'üë®‚Äçüç≥', role: 'Chef', action: 'Cocinar comida' },
                { emoji: 'üëÆ', role: 'Polic√≠a', action: 'Ayudar a la gente' }
            ];
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üë®‚Äçüë©‚Äçüëß Juego de Roles</h3>
                    <div class="game-area">
                        <p style="font-size: 1.2rem; text-align: center;">Elige un personaje y act√∫a su rol:</p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 2rem 0;">
                            ${roles.map(r => `
                                <div class="interactive-element" onclick="playRole('${r.role}', '${r.action}')">
                                    <div style="font-size: 3rem;">${r.emoji}</div>
                                    <div>${r.role}</div>
                                    <div style="font-size: 0.9rem; opacity: 0.8;">${r.action}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div id="rolePlayArea" style="display: none;">
                            <!-- √Årea de rol -->
                        </div>
                    </div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('roleplay-5')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="roleplay-5"]').parentElement.appendChild(container.firstElementChild);
        }

        function playRole(role, action) {
            const area = document.getElementById('rolePlayArea');
            area.style.display = 'block';
            
            const prompts = {
                'Doctor': [
                    "Di: '¬øD√≥nde te duele?'",
                    "Di: 'Voy a revisar tu temperatura'",
                    "Di: 'Toma esta medicina'"
                ],
                'Profesor': [
                    "Di: 'Buenos d√≠as, clase'",
                    "Di: '¬øQui√©n sabe la respuesta?'",
                    "Di: 'Muy bien, excelente trabajo'"
                ],
                'Chef': [
                    "Di: '¬øQu√© quieres comer?'",
                    "Di: 'Voy a cocinar algo delicioso'",
                    "Di: 'La comida est√° lista'"
                ],
                'Polic√≠a': [
                    "Di: '¬øNecesita ayuda?'",
                    "Di: 'Voy a protegerlos'",
                    "Di: 'Todo est√° seguro'"
                ]
            };
            
            area.innerHTML = `
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; text-align: center;">
                    <h4>Eres un ${role}</h4>
                    <p>Practica estas frases:</p>
                    ${prompts[role].map(prompt => `
                        <div style="margin: 1rem; padding: 1rem; background: white; border-radius: 10px;">
                            ${prompt}
                        </div>
                    `).join('')}
                    <button class="btn btn-success" onclick="completeRole()">
                        ‚úÖ Practiqu√© mi Rol
                    </button>
                </div>
            `;
        }

        function completeRole() {
            updateScore(15);
            showNotification('üé≠ ¬°Excelente actuaci√≥n!', 'success');
        }

        function startEmotionsGame5() {
            if (!checkAgeSelected()) return;
            
            const emotions = [
                { emoji: 'üòä', name: 'feliz', situation: 'cuando recibes un regalo' },
                { emoji: 'üò¢', name: 'triste', situation: 'cuando pierdes algo' },
                { emoji: 'üò°', name: 'enojado', situation: 'cuando algo no sale bien' },
                { emoji: 'üò®', name: 'asustado', situation: 'cuando hay truenos' },
                { emoji: 'üò≤', name: 'sorprendido', situation: 'cuando pasa algo inesperado' },
                { emoji: 'ü§ó', name: 'emocionado', situation: 'cuando vas de paseo' }
            ];
            
            const gameHTML = `
                <div class="game-container">
                    <h3>üòä Expresando Emociones</h3>
                    <div class="game-area">
                        <p style="font-size: 1.2rem; text-align: center;">¬øC√≥mo te sientes...?</p>
                        <div id="emotionScenario" style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin: 2rem 0; text-align: center;">
                            <p style="font-size: 1.3rem;">${emotions[0].situation}</p>
                        </div>
                        <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                            ${emotions.map(e => `
                                <button class="interactive-element" onclick="selectEmotion('${e.name}', '${emotions[0].name}')">
                                    <div style="font-size: 2rem;">${e.emoji}</div>
                                    <div>${e.name}</div>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="feedback-box" id="emotionFeedback"></div>
                    <button class="btn" onclick="this.parentElement.remove(); markActivityComplete('emotions-5')">Cerrar</button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.innerHTML = gameHTML;
            document.querySelector('[data-activity="emotions-5"]').parentElement.appendChild(container.firstElementChild);
        }

        function selectEmotion(selected, correct) {
            const feedback = document.getElementById('emotionFeedback');
            
            if (selected === correct) {
                feedback.className = 'feedback-box feedback-correct show';
                feedback.innerHTML = `‚úÖ ¬°Correcto! Te sientes ${selected} en esa situaci√≥n`;
                updateScore(10);
                
                // Cargar siguiente emoci√≥n despu√©s de 2 segundos
                setTimeout(() => {
                    nextEmotionScenario();
                }, 2000);
            } else {
                feedback.className = 'feedback-box feedback-incorrect show';
                feedback.innerHTML = `‚ùå Piensa: ¬øc√≥mo te sentir√≠as t√∫ en esa situaci√≥n?`;
            }
        }

        function nextEmotionScenario() {
            const emotions = [
                { emoji: 'üòä', name: 'feliz', situation: 'cuando recibes un regalo' },
                { emoji: 'üò¢', name: 'triste', situation: 'cuando pierdes algo' },
                { emoji: 'üò°', name: 'enojado', situation: 'cuando algo no sale bien' },
                { emoji: 'üò®', name: 'asustado', situation: 'cuando hay truenos' },
                { emoji: 'üò≤', name: 'sorprendido', situation: 'cuando pasa algo inesperado' },
                { emoji: 'ü§ó', name: 'emocionado', situation: 'cuando vas de paseo' }
            ];
            
            // Seleccionar una emoci√≥n aleatoria
            const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
            
            const scenarioDiv = document.getElementById('emotionScenario');
            if (scenarioDiv) {
                scenarioDiv.innerHTML = `<p style="font-size: 1.3rem;">${randomEmotion.situation}</p>`;
            }
            
            // Actualizar la respuesta correcta para el pr√≥ximo intento
            const buttons = document.querySelectorAll('.interactive-element');
            buttons.forEach(btn => {
                const emotionName = btn.querySelector('div:last-child').textContent;
                btn.onclick = () => selectEmotion(emotionName, randomEmotion.name);
            });
            
            // Limpiar feedback
            const feedback = document.getElementById('emotionFeedback');
            if (feedback) {
                feedback.className = 'feedback-box';
            }
        }

        // Auto-guardado peri√≥dico
        setInterval(() => {
            if (completedActivities.size > 0) {
                saveProgress();
            }
        }, 30000); // Guardar cada 30 segundos

        // Guardar al cerrar/recargar la p√°gina
        window.addEventListener('beforeunload', () => {
            saveProgress();
        });

        // Funci√≥n de depuraci√≥n (solo para desarrollo)
        function debugReset() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar todo el progreso del m√≥dulo?')) {
                localStorage.removeItem('module3Progress');
                location.reload();
            }
        }

        // Log de inicio
        console.log('üéÆ M√≥dulo 3: Actividades y Juegos - Cargado correctamente');
        console.log('üìö Base cient√≠fica integrada para cada edad');
        console.log('üéØ Total de actividades disponibles:', totalActivities);
        console.log('üí° Selecciona la edad de tu hijo para comenzar');

        // Verificar si hay progreso guardado al cargar
        if (localStorage.getItem('module3Progress')) {
            console.log('üì• Progreso anterior detectado y cargado');
        }

        // Easter egg: c√≥digo secreto para desbloquear todas las actividades (solo desarrollo)
        let secretCode = [];
        document.addEventListener('keydown', (e) => {
            secretCode.push(e.key);
            secretCode = secretCode.slice(-6);
            if (secretCode.join('') === 'unlock') {
                if (confirm('üîì ¬øDesbloquear todas las actividades? (Modo desarrollo)')) {
                    document.querySelectorAll('.activity-card').forEach(card => {
                        card.classList.add('completed');
                        completedActivities.add(card.dataset.activity);
                    });
                    updateProgress();
                    showNotification('üîì Todas las actividades desbloqueadas', 'success');
                }
            }
        });

        // Funci√≥n de ayuda contextual
        function showHelp() {
            const helpMessage = `
üìñ GU√çA DEL M√ìDULO 3

üéØ OBJETIVO:
Practicar actividades l√∫dicas dise√±adas cient√≠ficamente para estimular el lenguaje seg√∫n la edad.

üìã INSTRUCCIONES:
1. Selecciona la edad de tu hijo (3, 4 o 5 a√±os)
2. Explora las actividades adaptadas a esa edad
3. Completa al menos 8 actividades para desbloquear la evaluaci√≥n final
4. Obt√©n los 5 logros disponibles

üéÆ TIPOS DE ACTIVIDADES:
- Juegos de vocabulario
- Cuentos interactivos
- Canciones educativas
- Construcci√≥n de frases
- Ejercicios de comprensi√≥n
- Actividades creativas

üí° CONSEJOS:
- Practica diariamente por 15-20 minutos
- Repite las actividades que m√°s le gusten a tu hijo
- Celebra cada peque√±o logro
- Adapta el ritmo seg√∫n el inter√©s del ni√±o

üèÜ LOGROS DISPONIBLES:
- Primera Actividad
- 5 Juegos Completados
- Maestro Musical
- Contador de Cuentos
- M√≥dulo Completo

¬øNecesitas m√°s ayuda? Contacta al instructor del curso.
            `;
            
            alert(helpMessage);
        }

        // Agregar bot√≥n de ayuda al header (opcional)
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelector('.nav-links');
            if (navLinks) {
                const helpLink = document.createElement('a');
                helpLink.href = '#';
                helpLink.textContent = 'Ayuda';
                helpLink.onclick = (e) => {
                    e.preventDefault();
                    showHelp();
                };
                navLinks.appendChild(helpLink);
            }
        });

        // Validaci√≥n de edad m√≠nima para continuar
        function validateProgress() {
            if (!selectedAge) {
                showNotification('‚ö†Ô∏è Debes seleccionar una edad para continuar', 'warning');
                return false;
            }
            
            if (completedActivities.size < 3) {
                showNotification('‚ö†Ô∏è Completa al menos 3 actividades antes de continuar', 'warning');
                return false;
            }
            
            return true;
        }

        // Funci√≥n para exportar progreso (√∫til para padres)
        function exportProgress() {
            const data = {
                module: 'M√≥dulo 3 - Actividades y Juegos',
                age: selectedAge,
                completedActivities: Array.from(completedActivities),
                score: currentScore,
                achievements: Array.from(achievements),
                date: new Date().toISOString()
            };
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `progreso_modulo3_${selectedAge}a√±os.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üì• Progreso exportado exitosamente', 'success');
        }

        // Funci√≥n para imprimir actividades recomendadas
        function printActivities() {
            if (!selectedAge) {
                showNotification('‚ö†Ô∏è Selecciona primero la edad de tu hijo', 'warning');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            const activities = {
                3: [
                    'Juego Veo-Veo de Colores: 10 minutos diarios',
                    'Sonidos de Animales: 5 minutos',
                    'Canciones con n√∫meros: 10 minutos',
                    'Cuento antes de dormir: 15 minutos'
                ],
                4: [
                    'Constructor de Oraciones: 15 minutos',
                    'Juego de secuencias: 10 minutos',
                    'Rimas y trabalenguas: 10 minutos',
                    'Cuentos con preguntas: 15 minutos'
                ],
                5: [
                    'Crear historias propias: 20 minutos',
                    'Juego de categor√≠as: 15 minutos',
                    'Teatro y roles: 20 minutos',
                    'Analog√≠as y opuestos: 15 minutos'
                ]
            };
            
            const content = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Plan de Actividades - ${selectedAge} a√±os</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #667eea; }
                        h2 { color: #764ba2; }
                        ul { line-height: 2; }
                        .footer { margin-top: 30px; padding-top: 20px; border-top: 2px solid #ccc; }
                    </style>
                </head>
                <body>
                    <h1>Plan de Actividades de Lenguaje</h1>
                    <h2>Edad: ${selectedAge} a√±os</h2>
                    
                    <h3>Actividades Diarias Recomendadas:</h3>
                    <ul>
                        ${activities[selectedAge].map(act => `<li>‚òê ${act}</li>`).join('')}
                    </ul>
                    
                    <h3>Horario Sugerido:</h3>
                    <ul>
                        <li>‚òê Ma√±ana (10 min): Juego de vocabulario</li>
                        <li>‚òê Tarde (15 min): Actividad creativa</li>
                        <li>‚òê Noche (10 min): Cuento o canci√≥n</li>
                    </ul>
                    
                    <h3>Registro Semanal:</h3>
                    <table border="1" style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <th>D√≠a</th>
                            <th>Actividad Realizada</th>
                            <th>Tiempo</th>
                            <th>Observaciones</th>
                        </tr>
                        ${['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'].map(dia => `
                            <tr>
                                <td style="padding: 10px;">${dia}</td>
                                <td style="padding: 10px;"></td>
                                <td style="padding: 10px;"></td>
                                <td style="padding: 10px;"></td>
                            </tr>
                        `).join('')}
                    </table>
                    
                    <div class="footer">
                        <p><strong>Fecha de impresi√≥n:</strong> ${new Date().toLocaleDateString('es-ES')}</p>
                        <p><strong>M√≥dulo:</strong> 3 - Actividades y Juegos</p>
                        <p><strong>Progreso actual:</strong> ${completedActivities.size} actividades completadas</p>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(content);
            printWindow.document.close();
            printWindow.print();
        }

        // Funci√≥n para compartir progreso (simulado)
        function shareProgress() {
            const shareText = `
üéâ ¬°Mi hijo de ${selectedAge} a√±os est√° progresando en el M√≥dulo 3 de Estimulaci√≥n del Lenguaje!

üìä Progreso:
- Actividades completadas: ${completedActivities.size}/${totalActivities}
- Puntuaci√≥n: ${currentScore} puntos
- Logros: ${achievements.size}/5

#Estimulaci√≥nDelLenguaje #DesarrolloInfantil #Aprendizaje
            `;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Mi progreso en Estimulaci√≥n del Lenguaje',
                    text: shareText
                }).then(() => {
                    showNotification('‚úÖ Compartido exitosamente', 'success');
                }).catch((error) => {
                    console.log('Error al compartir:', error);
                });
            } else {
                // Copiar al portapapeles como alternativa
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('üìã Texto copiado al portapapeles', 'success');
                });
            }
        }

        // Mensajes motivacionales aleatorios
        const motivationalMessages = [
            "¬°Excelente trabajo! Cada actividad cuenta üåü",
            "¬°Sigue as√≠! Tu hijo est√° aprendiendo mucho üìö",
            "¬°Incre√≠ble progreso! La constancia es clave üí™",
            "¬°Muy bien! El juego es la mejor forma de aprender üéÆ",
            "¬°Genial! Cada palabra nueva es un logro üéØ"
        ];

        function showRandomMotivation() {
            if (completedActivities.size > 0 && completedActivities.size % 3 === 0) {
                const message = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
                showNotification(message, 'success');
            }
        }

        // Llamar a motivaci√≥n despu√©s de completar actividades
        const originalMarkComplete = markActivityComplete;
        markActivityComplete = function(activityId) {
            originalMarkComplete(activityId);
            showRandomMotivation();
        };

        // Fin del script
        console.log('‚úÖ M√≥dulo 3 completamente cargado y funcional');
    </script>
</body>
</html>
